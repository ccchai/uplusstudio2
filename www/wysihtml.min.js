var wysihtml={version:"0.6.0-beta1",commands:{},dom:{},quirks:{},toolbar:{},lang:{},selection:{},views:{},editorExtenders:[],extendEditor:function(n){this.editorExtenders.push(n)},INVISIBLE_SPACE:"﻿",INVISIBLE_SPACE_REG_EXP:/\uFEFF/g,VOID_ELEMENTS:"area, base, br, col, embed, hr, img, input, keygen, link, meta, param, source, track, wbr",PERMITTED_PHRASING_CONTENT_ONLY:"h1, h2, h3, h4, h5, h6, p, pre",EMPTY_FUNCTION:function(){},ELEMENT_NODE:1,TEXT_NODE:3,BACKSPACE_KEY:8,ENTER_KEY:13,ESCAPE_KEY:27,SPACE_KEY:32,TAB_KEY:9,DELETE_KEY:46},Base,rangy,wysihtmlParserRulesDefaults,wysihtmlParserRules;wysihtml.polyfills=function(n,t){var i={normalizeHasCaretError:function(){if("createRange"in t&&"getSelection"in n){var i,o=window.pageYOffset,s=window.pageXOffset,u=t.createElement("div"),c=t.createTextNode("a"),e=t.createTextNode("a"),l=t.createTextNode("a"),f=t.createRange(),r,h;return document.activeElement&&(document.activeElement.nodeType===1&&["INPUT","TEXTAREA","SELECT","BUTTON"].indexOf(document.activeElement.nodeName)>-1?i={type:"form",node:document.activeElement,start:document.activeElement.selectionStart,end:document.activeElement.selectionEnd}:(r=n.getSelection(),r&&r.anchorNode&&(i={type:"range",anchorNode:r.anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset}))),u.setAttribute("contenteditable","true"),u.appendChild(c),u.appendChild(e),u.appendChild(l),t.body.appendChild(u),f.setStart(e,1),f.setEnd(e,1),r=n.getSelection(),r.removeAllRanges(),r.addRange(f),u.normalize(),r=n.getSelection(),h=u.childNodes.length!==1||r.anchorNode!==u.firstChild||r.anchorOffset!==2,u.parentNode.removeChild(u),r.removeAllRanges(),i&&(i.type==="form"?(typeof i.start!="undefined"&&typeof i.end!="undefined"&&i.node.setSelectionRange(i.start,i.end),i.node.focus()):i.type==="range"&&(f=t.createRange(),f.setStart(i.anchorNode,i.anchorOffset),f.setEnd(i.focusNode,i.focusOffset),r.addRange(f))),(o!==window.pageYOffset||s!==window.pageXOffset)&&n.scrollTo(s,o),h}},apply:function(){function o(){try{var t=new n.CustomEvent("cat",{detail:{foo:"bar"}});return"cat"===t.type&&"bar"===t.detail.foo}catch(i){}return!1}(function(n){n.matches=n.matches||n.mozMatchesSelector||n.msMatchesSelector||n.oMatchesSelector||n.webkitMatchesSelector||function(n){for(var i=this,r=(i.document||i.ownerDocument).querySelectorAll(n),t=0;r[t]&&r[t]!==i;)++t;return r[t]?!0:!1};n.closest=n.closest||function(n){for(var t=this;t;){if(t.matches(n))break;t=t.parentElement}return t};n.remove=n.remove||function(){this.parentNode&&this.parentNode.removeChild(this)}})(n.Element.prototype);"classList"in t.documentElement||!n.Object.defineProperty||typeof n.HTMLElement=="undefined"||n.Object.defineProperty(n.HTMLElement.prototype,"classList",{get:function(){function i(n){return function(i){var r=t.className.split(/\s+/),u=r.indexOf(i);n(r,u,i);t.className=r.join(" ")}}var t=this,r={add:i(function(n,t,i){~t||n.push(i)}),remove:i(function(n,t){~t&&n.splice(t,1)}),toggle:i(function(n,t,i){~t?n.splice(t,1):n.push(i)}),contains:function(n){return!!~t.className.split(/\s+/).indexOf(n)},item:function(n){return t.className.split(/\s+/)[n]||null}};return n.Object.defineProperty(r,"length",{get:function(){return t.className.split(/\s+/).length}}),r}});var u=function(n){var t=[];for(n=n.firstChild;n;n=n.nextSibling)n.nodeType==3?t.push(n):t=t.concat(u(n));return t},f=function(n){var i=n.ownerDocument,t=n;do{if(t===i)return!0;t=t.parentNode}while(t);return!1},e=function(){var i=n.Node.prototype.normalize,t=function(){var a=u(this),l=this.ownerDocument.defaultView.getSelection(),t=l.anchorNode,s=l.anchorOffset,c=t&&t.nodeType===1&&t.childNodes.length>0?t.childNodes[s]:undefined,i=l.focusNode,e=l.focusOffset,h=i&&i.nodeType===1&&e>0?i.childNodes[e-1]:undefined,v=this.ownerDocument.createRange(),o=a.shift(),r=o?a.shift():null;for(h&&h.nodeType===3&&(i=h,e=h.nodeValue.length,h=undefined),c&&c.nodeType===3&&(t=c,s=0,c=undefined),(t===i&&e<s||t!==i&&t.compareDocumentPosition(i)&n.Node.DOCUMENT_POSITION_PRECEDING&&!(t.compareDocumentPosition(i)&n.Node.DOCUMENT_POSITION_CONTAINS))&&(i=[t,t=i][0],e=[s,s=e][0]);o&&r;)r.previousSibling&&r.previousSibling===o?(t===r&&(t=o,s=o.nodeValue.length+s),i===r&&(i=o,e=o.nodeValue.length+e),o.nodeValue=o.nodeValue+r.nodeValue,r.parentNode.removeChild(r),r=a.shift()):(o=r,r=a.shift());h&&(e=Array.prototype.indexOf.call(h.parentNode.childNodes,h)+1);c&&(s=Array.prototype.indexOf.call(c.parentNode.childNodes,c));f(this)&&t&&t.parentNode&&i&&i.parentNode&&(v.setStart(t,s),v.setEnd(i,e),l.removeAllRanges(),l.addRange(v))};n.Node.prototype.normalize=t},r=function(){n.removeEventListener("load",r);"Node"in n&&"normalize"in n.Node.prototype&&i.normalizeHasCaretError()&&e()};t.readyState!=="complete"?n.addEventListener("load",r):r(),function(){if(!o()&&"CustomEvent"in n){function i(n,i){i=i||{bubbles:!1,cancelable:!1,detail:undefined};var r=t.createEvent("CustomEvent");return r.initCustomEvent(n,i.bubbles,i.cancelable,i.detail),r}i.prototype=n.Event.prototype;n.CustomEvent=i}}()}};return i};wysihtml.polyfills(window,document).apply();Base=function(){};Base.extend=function(n,t){var u=Base.prototype.extend,r,f,i;return Base._prototyping=!0,r=new this,u.call(r,n),r.base=function(){},delete Base._prototyping,f=r.constructor,i=r.constructor=function(){if(!Base._prototyping)if(this._constructing||this.constructor==i)this._constructing=!0,f.apply(this,arguments),delete this._constructing;else if(arguments[0]!=null)return(arguments[0].extend||u).call(arguments[0],r)},i.ancestor=this,i.extend=this.extend,i.forEach=this.forEach,i.implement=this.implement,i.prototype=r,i.toString=this.toString,i.valueOf=function(n){return n=="object"?i:f.valueOf()},u.call(i,t),typeof i.init=="function"&&i.init(),i};Base.prototype={extend:function(n,t){var r,f,u,i;if(arguments.length>1)r=this[n],r&&typeof t=="function"&&(!r.valueOf||r.valueOf()!=t.valueOf())&&/\bbase\b/.test(t)&&(f=t.valueOf(),t=function(){var t=this.base||Base.prototype.base,n;return this.base=r,n=f.apply(this,arguments),this.base=t,n},t.valueOf=function(n){return n=="object"?t:f},t.toString=Base.toString),this[n]=t;else if(n){u=Base.prototype.extend;Base._prototyping||typeof this=="function"||(u=this.extend||u);for(var e={toSource:null},o=["constructor","toString","valueOf"],s=Base._prototyping?0:1;i=o[s++];)n[i]!=e[i]&&u.call(this,i,n[i]);for(i in n)e[i]||u.call(this,i,n[i])}return this}};Base=Base.extend({constructor:function(){this.extend(arguments[0])}},{ancestor:Object,version:"1.1",forEach:function(n,t,i){for(var r in n)this.prototype[r]===undefined&&t.call(i,n[r],r,n)},implement:function(){for(var n=0;n<arguments.length;n++)typeof arguments[n]=="function"?arguments[n](this.prototype):this.prototype.extend(arguments[n]);return this},toString:function(){return String(this.valueOf())}}),function(){function t(n,t){var i=typeof n[t];return i==ht||!!(i==g&&n[t])||i=="unknown"}function y(n,t){return!!(typeof n[t]==g&&n[t])}function nt(n,t){return typeof n[t]!=f}function p(n){return function(t,i){for(var r=i.length;r--;)if(!n(t,i[r]))return!1;return!0}}function tt(n){return n&&w(n,vt)&&b(n,at)}function it(n){return y(n,"body")?n.body:n.getElementsByTagName("body")[0]}function o(n){typeof console!=f&&t(console,"log")&&console.log(n)}function rt(n,t){i&&t?alert(n):o(n)}function u(t){n.initialized=!0;n.supported=!1;rt("Rangy is not supported in this environment. Reason: "+t,n.config.alertOnFail)}function wt(t){rt("Rangy warning: "+t,n.config.alertOnWarn)}function ut(n){return n.message||n.description||String(n)}function k(){var f,s,h,r,v,y,p,l,k;if(i&&!n.initialized){if(s=!1,h=!1,t(document,"createRange")&&(f=document.createRange(),w(f,lt)&&b(f,ct)&&(s=!0)),r=it(document),!r||r.nodeName.toLowerCase()!="body"){u("No body element found");return}if(r&&t(r,"createTextRange")&&(f=r.createTextRange(),tt(f)&&(h=!0)),!s&&!h){u("Neither Range nor TextRange are available");return}n.initialized=!0;n.features={implementsDomRange:s,implementsTextRange:h};for(p in e)(v=e[p])instanceof a&&v.init(v,n);for(l=0,k=c.length;l<k;++l)try{c[l](n)}catch(d){y="Rangy init listener threw an exception. Continuing. Detail: "+ut(d);o(y)}}}function ft(t,i,r){r&&(t+=" in module "+r.name);n.warn("DEPRECATED: "+t+" is deprecated. Please use "+i+" instead.")}function et(n,t,i,u){n[t]=function(){return ft(t,i,u),n[i].apply(n,r.toArray(arguments))}}function bt(n){n=n||window;k();for(var t=0,i=l.length;t<i;++t)l[t](n)}function a(n,t,i){this.name=n;this.dependencies=t;this.initialized=!1;this.supported=!1;this.initializer=i}function ot(t,i,r){var u=new a(t,i,function(i){if(!i.initialized){i.initialized=!0;try{r(n,i);i.supported=!0}catch(u){var f="Module '"+t+"' failed to load: "+ut(u);o(f);u.stack&&o(u.stack)}}});return e[t]=u,u}function st(){}function kt(){}var g="object",ht="function",f="undefined",ct=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestorContainer"],lt=["setStart","setStartBefore","setStartAfter","setEnd","setEndBefore","setEndAfter","collapse","selectNode","selectNodeContents","compareBoundaryPoints","deleteContents","extractContents","cloneContents","insertNode","surroundContents","cloneRange","toString","detach"],at=["boundingHeight","boundingLeft","boundingTop","boundingWidth","htmlText","text"],vt=["collapse","compareEndPoints","duplicate","moveToElementText","parentElement","select","setEndPoint","getBoundingClientRect"],w=p(t),yt=p(y),b=p(nt),pt=[].forEach?function(n,t){n.forEach(t)}:function(n,t){for(var i=0,r=n.length;i<r;++i)t(n[i],i)},e={},i=typeof window!=f&&typeof document!=f,r={isHostMethod:t,isHostObject:y,isHostProperty:nt,areHostMethods:w,areHostObjects:yt,areHostProperties:b,isTextRange:tt,getBody:it,forEach:pt},n={version:"1.3.1-dev",initialized:!1,isBrowser:i,supported:!0,util:r,features:{},modules:e,config:{alertOnFail:!1,alertOnWarn:!1,preferTextRange:!1,autoInitialize:typeof rangyAutoInitialize==f?!0:rangyAutoInitialize}},s,h,c,l,d,v;n.fail=u;n.warn=wt,{}.hasOwnProperty?(r.extend=s=function(n,t,i){var u,r;for(var f in t)t.hasOwnProperty(f)&&(u=n[f],r=t[f],i&&u!==null&&typeof u=="object"&&r!==null&&typeof r=="object"&&s(u,r,!0),n[f]=r);return t.hasOwnProperty("toString")&&(n.toString=t.toString),n},r.createOptions=function(n,t){var i={};return s(i,t),n&&s(i,n),i}):u("hasOwnProperty not supported");i||u("Rangy can only run in a browser"),function(){var n,t,u;if(i){t=document.createElement("div");t.appendChild(document.createElement("span"));u=[].slice;try{u.call(t.childNodes,0)[0].nodeType==1&&(n=function(n){return u.call(n,0)})}catch(f){}}n||(n=function(n){for(var i=[],t=0,r=n.length;t<r;++t)i[t]=n[t];return i});r.toArray=n}();i&&(t(document,"addEventListener")?h=function(n,t,i){n.addEventListener(t,i,!1)}:t(document,"attachEvent")?h=function(n,t,i){n.attachEvent("on"+t,i)}:u("Document does not have required addEventListener or attachEvent method"),r.addListener=h);c=[];r.deprecationNotice=ft;r.createAliasForDeprecatedMethod=et;n.init=k;n.addInitListener=function(t){n.initialized?t(n):c.push(t)};l=[];n.addShimListener=function(n){l.push(n)};i&&(n.shim=n.createMissingNativeApi=bt,et(n,"createMissingNativeApi","shim"));a.prototype={init:function(){for(var r=this.dependencies||[],i=0,u=r.length,n,t;i<u;++i){if(t=r[i],n=e[t],!n||!(n instanceof a))throw new Error("required module '"+t+"' not found");if(n.init(),!n.supported)throw new Error("required module '"+t+"' not supported");}this.initializer(this)},fail:function(n){this.initialized=!0;this.supported=!1;throw new Error(n);},warn:function(t){n.warn("Module "+this.name+": "+t)},deprecationNotice:function(t,i){n.warn("DEPRECATED: "+t+" in module "+this.name+" is deprecated. Please use "+i+" instead")},createError:function(n){return new Error("Error in Rangy "+this.name+" module: "+n)}};n.createModule=function(t){var i,r,u;arguments.length==2?(i=arguments[1],r=[]):(i=arguments[2],r=arguments[1]);u=ot(t,r,i);n.initialized&&n.supported&&u.init()};n.createCoreModule=function(n,t,i){ot(n,t,i)};n.RangePrototype=st;n.rangePrototype=new st;n.selectionPrototype=new kt;n.createCoreModule("DomUtil",[],function(n,t){function ut(n){var t;return typeof n.namespaceURI==r||(t=n.namespaceURI)===null||t=="http://www.w3.org/1999/xhtml"}function ft(n){var t=n.parentNode;return t.nodeType==1?t:null}function f(n){for(var t=0;n=n.previousSibling;)++t;return t}function et(n){switch(n.nodeType){case 7:case 10:return 0;case 3:case 8:return n.length;default:return n.childNodes.length}}function p(n,t){for(var r=[],i=n;i;i=i.parentNode)r.push(i);for(i=t;i;i=i.parentNode)if(c(r,i))return i;return null}function w(n,t,i){for(var r=i?t:t.parentNode;r;){if(r===n)return!0;r=r.parentNode}return!1}function ot(n,t){return w(n,t,!0)}function e(n,t,i){for(var u,r=i?n:n.parentNode;r;){if(u=r.parentNode,u===t)return r;r=u}return null}function b(n){var t=n.nodeType;return t==3||t==4||t==8}function st(n){if(!n)return!1;var t=n.nodeType;return t==3||t==8}function k(n,t){var i=t.nextSibling,r=t.parentNode;return i?r.insertBefore(n,i):r.appendChild(n),n}function ht(n,t,i){var u=n.cloneNode(!1),e,r;if(u.deleteData(0,t),n.deleteData(t,n.length-t),k(u,n),i)for(e=0;r=i[e++];)r.node==n&&r.offset>t?(r.node=u,r.offset-=t):r.node==n.parentNode&&r.offset>f(n)&&++r.offset;return u}function o(n){if(n.nodeType==9)return n;if(typeof n.ownerDocument!=r)return n.ownerDocument;if(typeof n.document!=r)return n.document;if(n.parentNode)return o(n.parentNode);throw t.createError("getDocument: no document found for node");}function d(n){var i=o(n);if(typeof i.defaultView!=r)return i.defaultView;if(typeof i.parentWindow!=r)return i.parentWindow;throw t.createError("Cannot get a window object for node");}function g(n){if(typeof n.contentDocument!=r)return n.contentDocument;if(typeof n.contentWindow!=r)return n.contentWindow.document;throw t.createError("getIframeDocument: No Document object found for iframe element");}function ct(n){if(typeof n.contentWindow!=r)return n.contentWindow;if(typeof n.contentDocument!=r)return n.contentDocument.defaultView;throw t.createError("getIframeWindow: No Window object found for iframe element");}function nt(n){return n&&i.isHostMethod(n,"setTimeout")&&i.isHostObject(n,"document")}function lt(n,t,r){var u;if(n?i.isHostProperty(n,"nodeType")?u=n.nodeType==1&&n.tagName.toLowerCase()=="iframe"?g(n):o(n):nt(n)&&(u=n.document):u=document,!u)throw t.createError(r+"(): Parameter must be a Window object or DOM node");return u}function at(n){for(var t;t=n.parentNode;)n=t;return n}function vt(n,i,r,u){var h,o,c,l,s;if(n==r)return i===u?0:i<u?-1:1;if(h=e(r,n,!0))return i<=f(h)?-1:1;if(h=e(n,r,!0))return f(h)<u?-1:1;if(o=p(n,r),!o)throw new Error("comparePoints error: nodes have no common ancestor");if(c=n===o?o:e(n,o,!0),l=r===o?o:e(r,o,!0),c===l)throw t.createError("comparePoints got to case 4 and childA and childB are the same!");else for(s=o.firstChild;s;){if(s===c)return-1;if(s===l)return 1;s=s.nextSibling}}function l(n){var t;try{return t=n.parentNode,!1}catch(i){return!0}}function tt(n){if(!n)return"[No node]";if(s&&l(n))return"[Broken node]";if(b(n))return'"'+n.data+'"';if(n.nodeType==1){var t=n.id?' id="'+n.id+'"':"";return"<"+n.nodeName+t+">[index:"+f(n)+",length:"+n.childNodes.length+"]["+(n.innerHTML||"[innerHTML not supported]").slice(0,25)+"]"}return n.nodeName}function yt(n){for(var t=o(n).createDocumentFragment(),i;i=n.firstChild;)t.appendChild(i);return t}function pt(n,t,i){var u=y(n),r=n.createElement("div"),f;return r.contentEditable=""+!!i,t&&(r.innerHTML=t),f=u.firstChild,f?u.insertBefore(r,f):u.appendChild(r),r}function wt(n){return n.parentNode.removeChild(n)}function it(n){this.root=n;this._next=n}function bt(n){return new it(n)}function rt(n,t){this.node=n;this.offset=t}function v(n){this.code=this[n];this.codeName=n;this.message="DOMException: "+this.codeName}var r="undefined",i=n.util,y=i.getBody,u,h,c,s,a;i.areHostMethods(document,["createDocumentFragment","createElement","createTextNode"])||t.fail("document missing a Node creation method");i.isHostMethod(document,"getElementsByTagName")||t.fail("document missing getElementsByTagName method");u=document.createElement("div");i.areHostMethods(u,["insertBefore","appendChild","cloneNode"]||!i.areHostObjects(u,["previousSibling","nextSibling","childNodes","parentNode"]))||t.fail("Incomplete Element implementation");i.isHostProperty(u,"innerHTML")||t.fail("Element is missing innerHTML property");h=document.createTextNode("test");i.areHostMethods(h,["splitText","deleteData","insertData","appendData","cloneNode"]||!i.areHostObjects(u,["previousSibling","nextSibling","childNodes","parentNode"])||!i.areHostProperties(h,["data"]))||t.fail("Incomplete Text Node implementation");c=function(n,t){for(var i=n.length;i--;)if(n[i]===t)return!0;return!1};s=!1,function(){var t=document.createElement("b"),i;t.innerHTML="1";i=t.firstChild;t.innerHTML="<br />";s=l(i);n.features.crashyTextNodes=s}();typeof getComputedStyle!=r?a=function(n,t){return d(n).getComputedStyle(n,null)[t]}:typeof document.documentElement.currentStyle!=r?a=function(n,t){return n.currentStyle?n.currentStyle[t]:""}:t.fail("No means of obtaining computed style properties found");it.prototype={_current:null,hasNext:function(){return!!this._next},next:function(){var n=this._current=this._next,t,i;if(this._current)if(t=n.firstChild,t)this._next=t;else{for(i=null;n!==this.root&&!(i=n.nextSibling);)n=n.parentNode;this._next=i}return this._current},detach:function(){this._current=this._next=this.root=null}};rt.prototype={equals:function(n){return!!n&&this.node===n.node&&this.offset==n.offset},inspect:function(){return"[DomPosition("+tt(this.node)+":"+this.offset+")]"},toString:function(){return this.inspect()}};v.prototype={INDEX_SIZE_ERR:1,HIERARCHY_REQUEST_ERR:3,WRONG_DOCUMENT_ERR:4,NO_MODIFICATION_ALLOWED_ERR:7,NOT_FOUND_ERR:8,NOT_SUPPORTED_ERR:9,INVALID_STATE_ERR:11,INVALID_NODE_TYPE_ERR:24};v.prototype.toString=function(){return this.message};n.dom={arrayContains:c,isHtmlNamespace:ut,parentElement:ft,getNodeIndex:f,getNodeLength:et,getCommonAncestor:p,isAncestorOf:w,isOrIsAncestorOf:ot,getClosestAncestorIn:e,isCharacterDataNode:b,isTextOrCommentNode:st,insertAfter:k,splitDataNode:ht,getDocument:o,getWindow:d,getIframeWindow:ct,getIframeDocument:g,getBody:y,isWindow:nt,getContentDocument:lt,getRootContainer:at,comparePoints:vt,isBrokenNode:l,inspectNode:tt,getComputedStyleProperty:a,createTestElement:pt,removeNode:wt,fragmentFromNodeChildren:yt,createIterator:bt,DomPosition:rt};n.DOMException=v});n.createCoreModule("DomRange",["DomUtil"],function(n){function y(n,t){return n.nodeType!=3&&(a(n,t.startContainer)||a(n,t.endContainer))}function e(n){return n.document||g(n.startContainer)}function di(n){return o(n.startContainer)}function vt(n){return new lt(n.parentNode,h(n))}function rt(n){return new lt(n.parentNode,h(n)+1)}function yt(n,r,u){var f=n.nodeType==11?n.firstChild:n;return i(r)?u==r.length?t.insertAfter(n,r):r.parentNode.insertBefore(n,u==0?r:nt(r,u)):u>=r.childNodes.length?r.appendChild(n):r.insertBefore(n,r.childNodes[u]),f}function pt(n,t,i){if(r(n),r(t),e(t)!=e(n))throw new f("WRONG_DOCUMENT_ERR");var o=u(n.startContainer,n.startOffset,t.endContainer,t.endOffset),s=u(n.endContainer,n.endOffset,t.startContainer,t.startOffset);return i?o<=0&&s>=0:o<0&&s>0}function wt(n){for(var i,t,u=e(n.range).createDocumentFragment(),r;t=n.next();){if(i=n.isPartiallySelectedSubtree(),t=t.cloneNode(!i),i&&(r=n.getSubtreeIterator(),t.appendChild(wt(r)),r.detach()),t.nodeType==10)throw new f("HIERARCHY_REQUEST_ERR");u.appendChild(t)}return u}function b(n,i,r){var e,o,u,f;for(r=r||{stop:!1};u=n.next();)if(n.isPartiallySelectedSubtree()){if(i(u)===!1){r.stop=!0;return}if(f=n.getSubtreeIterator(),b(f,i,r),f.detach(),r.stop)return}else for(e=t.createIterator(u);o=e.next();)if(i(o)===!1){r.stop=!0;return}}function bt(n){for(var t;n.next();)n.isPartiallySelectedSubtree()?(t=n.getSubtreeIterator(),bt(t),t.detach()):n.remove()}function kt(n){for(var t,r=e(n.range).createDocumentFragment(),i;t=n.next();){if(n.isPartiallySelectedSubtree()?(t=t.cloneNode(!1),i=n.getSubtreeIterator(),t.appendChild(kt(i)),i.detach()):n.remove(),t.nodeType==10)throw new f("HIERARCHY_REQUEST_ERR");r.appendChild(t)}return r}function gi(n,t,r){var f=!!(t&&t.length),e,o=!!r,u;return f&&(e=new RegExp("^("+t.join("|")+")$")),u=[],b(new s(n,!1),function(t){var s,h;(!f||e.test(t.nodeType))&&(!o||r(t))&&((s=n.startContainer,t==s&&i(s)&&n.startOffset==s.length)||(h=n.endContainer,t==h&&i(h)&&n.endOffset==0)||u.push(t))}),u}function dt(n){var i=typeof n.getName=="undefined"?"Range":n.getName();return"["+i+"("+t.inspectNode(n.startContainer)+":"+n.startOffset+", "+t.inspectNode(n.endContainer)+":"+n.endOffset+")]"}function s(n,t){if(this.range=n,this.clonePartiallySelectedTextNodes=t,!n.collapsed){this.sc=n.startContainer;this.so=n.startOffset;this.ec=n.endContainer;this.eo=n.endOffset;var r=n.commonAncestorContainer;this.sc===this.ec&&i(this.sc)?(this.isSingleCharacterDataNode=!0,this._first=this._last=this._next=this.sc):(this._first=this._next=this.sc===r&&!i(this.sc)?this.sc.childNodes[this.so]:tt(this.sc,r,!0),this._last=this.ec===r&&!i(this.ec)?this.ec.childNodes[this.eo-1]:tt(this.ec,r,!0))}}function ut(n){return function(t,i){for(var u,r=i?t:t.parentNode;r;){if(u=r.nodeType,at(n,u))return r;r=r.parentNode}return null}}function p(n,t){if(ur(n,t))throw new f("INVALID_NODE_TYPE_ERR");}function w(n,t){if(!at(t,n.nodeType))throw new f("INVALID_NODE_TYPE_ERR");}function ft(n,t){if(t<0||t>(i(n)?n.length:n.childNodes.length))throw new f("INDEX_SIZE_ERR");}function et(n,t){if(ni(n,!0)!==ni(t,!0))throw new f("WRONG_DOCUMENT_ERR");}function c(n){if(rr(n,!0))throw new f("NO_MODIFICATION_ALLOWED_ERR");}function ti(n,t){if(!n)throw new f(t);}function ii(n,t){return t<=(i(n)?n.length:n.childNodes.length)}function ri(n){return!!n.startContainer&&!!n.endContainer&&!(ki&&(t.isBrokenNode(n.startContainer)||t.isBrokenNode(n.endContainer)))&&o(n.startContainer)==o(n.endContainer)&&ii(n.startContainer,n.startOffset)&&ii(n.endContainer,n.endOffset)}function r(n){if(!ri(n))throw new Error("Range error: Range is not valid. This usually happens after DOM mutation. Range: ("+n.inspect()+")");}function fi(n,t){r(n);var u=n.startContainer,o=n.startOffset,f=n.endContainer,e=n.endOffset,s=u===f;i(f)&&e>0&&e<f.length&&nt(f,e,t);i(u)&&o>0&&o<u.length&&(u=nt(u,o,t),s?(e-=o,f=u):f==u.parentNode&&e>=h(u)&&e++,o=0);n.setStartAndEnd(u,o,f,e)}function ei(n){r(n);var t=n.commonAncestorContainer.parentNode.cloneNode(!1);return t.appendChild(n.cloneContents()),t.innerHTML}function ai(n){n.START_TO_START=ht;n.START_TO_END=oi;n.END_TO_END=fr;n.END_TO_START=si;n.NODE_BEFORE=hi;n.NODE_AFTER=ci;n.NODE_BEFORE_AND_AFTER=li;n.NODE_INSIDE=ct}function vi(n){ai(n);ai(n.prototype)}function yi(n,t){return function(){var l;r(this);var i=this.startContainer,f=this.startOffset,o=this.commonAncestorContainer,u=new s(this,!0),h,e;return i!==o&&(h=tt(i,o,!0),e=rt(h),i=e.node,f=e.offset),b(u,c),u.reset(),l=n(u),u.detach(),t(this,i,f,i,f),l}}function pi(t,f){function e(n,t){return function(i){w(i,gt);w(o(i),nr);var r=(n?vt:rt)(i);(t?l:a)(this,r.node,r.offset)}}function l(n,t,i){var r=n.endContainer,e=n.endOffset;(t!==n.startContainer||i!==n.startOffset)&&((o(t)!=o(r)||u(t,i,r,e)==1)&&(r=t,e=i),f(n,t,i,r,e))}function a(n,t,i){var r=n.startContainer,e=n.startOffset;(t!==n.endContainer||i!==n.endOffset)&&((o(t)!=o(r)||u(t,i,r,e)==-1)&&(r=t,e=i),f(n,r,e,t,i))}var b=function(){};b.prototype=n.rangePrototype;t.prototype=new b;d.extend(t.prototype,{setStart:function(n,t){p(n,!0);ft(n,t);l(this,n,t)},setEnd:function(n,t){p(n,!0);ft(n,t);a(this,n,t)},setStartAndEnd:function(){var n=arguments,i=n[0],r=n[1],u=i,t=r;switch(n.length){case 3:t=n[2];break;case 4:u=n[2];t=n[3]}f(this,i,r,u,t)},setBoundary:function(n,t,i){this["set"+(i?"Start":"End")](n,t)},setStartBefore:e(!0,!0),setStartAfter:e(!1,!0),setEndBefore:e(!0,!1),setEndAfter:e(!1,!1),collapse:function(n){r(this);n?f(this,this.startContainer,this.startOffset,this.startContainer,this.startOffset):f(this,this.endContainer,this.endOffset,this.endContainer,this.endOffset)},selectNodeContents:function(n){p(n,!0);f(this,n,0,n,it(n))},selectNode:function(n){p(n,!1);w(n,gt);var t=vt(n),i=rt(n);f(this,t.node,t.offset,i.node,i.offset)},extractContents:yi(kt,f),deleteContents:yi(bt,f),canSurroundContents:function(){r(this);c(this.startContainer);c(this.endContainer);var n=new s(this,!0),t=n._first&&y(n._first,this)||n._last&&y(n._last,this);return n.detach(),!t},splitBoundaries:function(){fi(this)},splitBoundariesPreservingPositions:function(n){fi(this,n)},normalizeBoundaries:function(){var s,c;r(this);var t=this.startContainer,o=this.startOffset,n=this.endContainer,u=this.endOffset,a=function(t){var i=t.nextSibling;i&&i.nodeType==t.nodeType&&(n=t,u=t.length,t.appendData(i.data),v(i))},y=function(i){var r=i.previousSibling,e,f;r&&r.nodeType==i.nodeType&&(t=i,e=i.length,o=r.length,i.insertData(0,r.data),v(r),t==n?(u+=o,n=t):n==i.parentNode&&(f=h(i),u==f?(n=i,u=e):u>f&&u--))},l=!0,e;i(n)?u==n.length?a(n):u==0&&(e=n.previousSibling,e&&e.nodeType==n.nodeType&&(u=e.length,t==n&&(l=!1),e.appendData(n.data),v(n),n=e)):(u>0&&(s=n.childNodes[u-1],s&&i(s)&&a(s)),l=!this.collapsed);l?i(t)?o==0?y(t):o==t.length&&(e=t.nextSibling,e&&e.nodeType==t.nodeType&&(n==e&&(n=t,u+=t.length),t.appendData(e.data),v(e))):o<t.childNodes.length&&(c=t.childNodes[o],c&&i(c)&&y(c)):(t=n,o=u);f(this,t,o,n,u)},collapseToPoint:function(n,t){p(n,!0);ft(n,t);this.setStartAndEnd(n,t)}});vi(t)}function wi(n){n.collapsed=n.startContainer===n.endContainer&&n.startOffset===n.endOffset;n.commonAncestorContainer=n.collapsed?n.startContainer:t.getCommonAncestor(n.startContainer,n.endContainer)}function bi(n,i,r,u,f){n.startContainer=i;n.startOffset=r;n.endContainer=u;n.endOffset=f;n.document=t.getDocument(i);wi(n)}function l(n){this.startContainer=n;this.startOffset=0;this.endContainer=n;this.endOffset=0;this.document=n;wi(this)}var t=n.dom,d=n.util,lt=t.DomPosition,f=n.DOMException,i=t.isCharacterDataNode,h=t.getNodeIndex,a=t.isOrIsAncestorOf,g=t.getDocument,u=t.comparePoints,nt=t.splitDataNode,tt=t.getClosestAncestorIn,it=t.getNodeLength,at=t.arrayContains,o=t.getRootContainer,ki=n.features.crashyTextNodes,v=t.removeNode,ot,k,ui;s.prototype={_current:null,_next:null,_first:null,_last:null,isSingleCharacterDataNode:!1,reset:function(){this._current=null;this._next=this._first},hasNext:function(){return!!this._next},next:function(){var n=this._current=this._next;return n&&(this._next=n!==this._last?n.nextSibling:null,i(n)&&this.clonePartiallySelectedTextNodes&&(n===this.ec&&(n=n.cloneNode(!0)).deleteData(this.eo,n.length-this.eo),this._current===this.sc&&(n=n.cloneNode(!0)).deleteData(0,this.so))),n},remove:function(){var n=this._current,t,r;i(n)&&(n===this.sc||n===this.ec)?(t=n===this.sc?this.so:0,r=n===this.ec?this.eo:n.length,t!=r&&n.deleteData(t,r-t)):n.parentNode&&v(n)},isPartiallySelectedSubtree:function(){var n=this._current;return y(n,this.range)},getSubtreeIterator:function(){var n;if(this.isSingleCharacterDataNode)n=this.range.cloneRange(),n.collapse(!1);else{n=new l(e(this.range));var t=this._current,i=t,r=0,u=t,f=it(t);a(t,this.sc)&&(i=this.sc,r=this.so);a(t,this.ec)&&(u=this.ec,f=this.eo);bi(n,i,r,u,f)}return new s(n,this.clonePartiallySelectedTextNodes)},detach:function(){this.range=this._current=this._next=this._first=this._last=this.sc=this.so=this.ec=this.eo=null}};var gt=[1,3,4,5,7,8,10],nr=[2,9,11],tr=[1,3,4,5,7,8,10,11],ir=[1,3,4,5,7,8];var ni=ut([9,11]),rr=ut([5,6,10,12]),ur=ut([6,10,12]);ot=document.createElement("style");k=!1;try{ot.innerHTML="<b>x<\/b>";k=ot.firstChild.nodeType==3}catch(er){}n.features.htmlParsingConforms=k;ui=k?function(n){var u=this.startContainer,e=g(u),r;if(!u)throw new f("INVALID_STATE_ERR");return r=null,u.nodeType==1?r=u:i(u)&&(r=t.parentElement(u)),r=r===null||r.nodeName=="HTML"&&t.isHtmlNamespace(g(r).documentElement)&&t.isHtmlNamespace(r)?e.createElement("body"):r.cloneNode(!1),r.innerHTML=n,t.fragmentFromNodeChildren(r)}:function(n){var r=e(this),i=r.createElement("body");return i.innerHTML=n,t.fragmentFromNodeChildren(i)};var st=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestorContainer"],ht=0,oi=1,fr=2,si=3,hi=0,ci=1,li=2,ct=3;d.extend(n.rangePrototype,{compareBoundaryPoints:function(n,t){r(this);et(this.startContainer,t.startContainer);var i,f,e,o,s=n==si||n==ht?"start":"end",h=n==oi||n==ht?"start":"end";return i=this[s+"Container"],f=this[s+"Offset"],e=t[h+"Container"],o=t[h+"Offset"],u(i,f,e,o)},insertNode:function(n){if(r(this),w(n,tr),c(this.startContainer),a(n,this.startContainer))throw new f("HIERARCHY_REQUEST_ERR");var t=yt(n,this.startContainer,this.startOffset);this.setStartBefore(t)},cloneContents:function(){var n,t,u;return r(this),this.collapsed?e(this).createDocumentFragment():this.startContainer===this.endContainer&&i(this.startContainer)?(n=this.startContainer.cloneNode(!0),n.data=n.data.slice(this.startOffset,this.endOffset),t=e(this).createDocumentFragment(),t.appendChild(n),t):(u=new s(this,!0),n=wt(u),u.detach(),n)},canSurroundContents:function(){r(this);c(this.startContainer);c(this.endContainer);var n=new s(this,!0),t=n._first&&y(n._first,this)||n._last&&y(n._last,this);return n.detach(),!t},surroundContents:function(n){if(w(n,ir),!this.canSurroundContents())throw new f("INVALID_STATE_ERR");var t=this.extractContents();if(n.hasChildNodes())while(n.lastChild)n.removeChild(n.lastChild);yt(n,this.startContainer,this.startOffset);n.appendChild(t);this.selectNode(n)},cloneRange:function(){r(this);for(var t=new l(e(this)),i=st.length,n;i--;)n=st[i],t[n]=this[n];return t},toString:function(){var n,t,u;return r(this),n=this.startContainer,n===this.endContainer&&i(n)?n.nodeType==3||n.nodeType==4?n.data.slice(this.startOffset,this.endOffset):"":(t=[],u=new s(this,!0),b(u,function(n){(n.nodeType==3||n.nodeType==4)&&t.push(n.data)}),u.detach(),t.join(""))},compareNode:function(n){var t,i,e,u;if(r(this),t=n.parentNode,i=h(n),!t)throw new f("NOT_FOUND_ERR");return e=this.comparePoint(t,i),u=this.comparePoint(t,i+1),e<0?u>0?li:hi:u>0?ci:ct},comparePoint:function(n,t){return(r(this),ti(n,"HIERARCHY_REQUEST_ERR"),et(n,this.startContainer),u(n,t,this.startContainer,this.startOffset)<0)?-1:u(n,t,this.endContainer,this.endOffset)>0?1:0},createContextualFragment:ui,toHtml:function(){return ei(this)},intersectsNode:function(n,t){var i,f,e,s;return(r(this),o(n)!=di(this))?!1:(i=n.parentNode,f=h(n),!i)?!0:(e=u(i,f,this.endContainer,this.endOffset),s=u(i,f+1,this.startContainer,this.startOffset),t?e<=0&&s>=0:e<0&&s>0)},isPointInRange:function(n,t){return r(this),ti(n,"HIERARCHY_REQUEST_ERR"),et(n,this.startContainer),u(n,t,this.startContainer,this.startOffset)>=0&&u(n,t,this.endContainer,this.endOffset)<=0},intersectsRange:function(n){return pt(this,n,!1)},intersectsOrTouchesRange:function(n){return pt(this,n,!0)},intersection:function(n){if(this.intersectsRange(n)){var i=u(this.startContainer,this.startOffset,n.startContainer,n.startOffset),r=u(this.endContainer,this.endOffset,n.endContainer,n.endOffset),t=this.cloneRange();return i==-1&&t.setStart(n.startContainer,n.startOffset),r==1&&t.setEnd(n.endContainer,n.endOffset),t}return null},union:function(n){if(this.intersectsOrTouchesRange(n)){var t=this.cloneRange();return u(n.startContainer,n.startOffset,this.startContainer,this.startOffset)==-1&&t.setStart(n.startContainer,n.startOffset),u(n.endContainer,n.endOffset,this.endContainer,this.endOffset)==1&&t.setEnd(n.endContainer,n.endOffset),t}throw new f("Ranges do not intersect");},containsNode:function(n,t){return t?this.intersectsNode(n,!1):this.compareNode(n)==ct},containsNodeContents:function(n){return this.comparePoint(n,0)>=0&&this.comparePoint(n,it(n))<=0},containsRange:function(n){var t=this.intersection(n);return t!==null&&n.equals(t)},containsNodeText:function(n){var t=this.cloneRange(),i,r;return t.selectNode(n),i=t.getNodes([3]),i.length>0?(t.setStart(i[0],0),r=i.pop(),t.setEnd(r,r.length),this.containsRange(t)):this.containsNodeContents(n)},getNodes:function(n,t){return r(this),gi(this,n,t)},getDocument:function(){return e(this)},collapseBefore:function(n){this.setEndBefore(n);this.collapse(!1)},collapseAfter:function(n){this.setStartAfter(n);this.collapse(!0)},getBookmark:function(i){var o=e(this),r=n.createRange(o);i=i||t.getBody(o);r.selectNodeContents(i);var u=this.intersection(r),f=0,s=0;return u&&(r.setEnd(u.startContainer,u.startOffset),f=r.toString().length,s=f+u.toString().length),{start:f,end:s,containerNode:i}},moveToBookmark:function(n){var o=n.containerNode,t=0;this.setStart(o,0);this.collapse(!0);for(var s=[o],i,u=!1,h=!1,r,f,e;!h&&(i=s.pop());)if(i.nodeType==3)r=t+i.length,!u&&n.start>=t&&n.start<=r&&(this.setStart(i,n.start-t),u=!0),u&&n.end>=t&&n.end<=r&&(this.setEnd(i,n.end-t),h=!0),t=r;else for(e=i.childNodes,f=e.length;f--;)s.push(e[f])},getName:function(){return"DomRange"},equals:function(n){return l.rangesEqual(this,n)},isValid:function(){return ri(this)},inspect:function(){return dt(this)},detach:function(){}});pi(l,bi);d.extend(l,{rangeProperties:st,RangeIterator:s,copyComparisonConstants:vi,createPrototypeRange:pi,inspect:dt,toHtml:ei,getRangeDocument:e,rangesEqual:function(n,t){return n.startContainer===t.startContainer&&n.startOffset===t.startOffset&&n.endContainer===t.endContainer&&n.endOffset===t.endOffset}});n.DomRange=l});n.createCoreModule("WrappedRange",["DomRange"],function(n,t){var o,r,i=n.dom,c=n.util,u=i.DomPosition,f=n.DomRange,e=i.getBody,s=i.getContentDocument,h=i.isCharacterDataNode,v,y;if(n.features.implementsDomRange&&function(){function h(n){for(var i=b.length,t;i--;)t=b[i],n[t]=n.nativeRange[t];n.collapsed=n.startContainer===n.endContainer&&n.startOffset===n.endOffset}function k(n,t,i,r,u){var f=n.startContainer!==t||n.startOffset!=i,e=n.endContainer!==r||n.endOffset!=u,o=!n.equals(n.nativeRange);(f||e||o)&&(n.setEnd(r,u),n.setStart(t,i))}var r,b=f.rangeProperties,a,l,u,v,y,p,w;o=function(n){if(!n)throw t.createError("WrappedRange: Range must be specified");this.nativeRange=n;h(this)};f.createPrototypeRange(o,k);r=o.prototype;r.selectNode=function(n){this.nativeRange.selectNode(n);h(this)};r.cloneContents=function(){return this.nativeRange.cloneContents()};r.surroundContents=function(n){this.nativeRange.surroundContents(n);h(this)};r.collapse=function(n){this.nativeRange.collapse(n);h(this)};r.cloneRange=function(){return new o(this.nativeRange.cloneRange())};r.refresh=function(){h(this)};r.toString=function(){return this.nativeRange.toString()};l=document.createTextNode("test");e(document).appendChild(l);u=document.createRange();u.setStart(l,0);u.setEnd(l,0);try{u.setStart(l,1);r.setStart=function(n,t){this.nativeRange.setStart(n,t);h(this)};r.setEnd=function(n,t){this.nativeRange.setEnd(n,t);h(this)};a=function(n){return function(t){this.nativeRange[n](t);h(this)}}}catch(d){r.setStart=function(n,t){try{this.nativeRange.setStart(n,t)}catch(i){this.nativeRange.setEnd(n,t);this.nativeRange.setStart(n,t)}h(this)};r.setEnd=function(n,t){try{this.nativeRange.setEnd(n,t)}catch(i){this.nativeRange.setStart(n,t);this.nativeRange.setEnd(n,t)}h(this)};a=function(n,t){return function(i){try{this.nativeRange[n](i)}catch(r){this.nativeRange[t](i);this.nativeRange[n](i)}h(this)}}}r.setStartBefore=a("setStartBefore","setEndBefore");r.setStartAfter=a("setStartAfter","setEndAfter");r.setEndBefore=a("setEndBefore","setStartBefore");r.setEndAfter=a("setEndAfter","setStartAfter");r.selectNodeContents=function(n){this.setStartAndEnd(n,0,i.getNodeLength(n))};u.selectNodeContents(l);u.setEnd(l,3);v=document.createRange();v.selectNodeContents(l);v.setEnd(l,4);v.setStart(l,2);r.compareBoundaryPoints=u.compareBoundaryPoints(u.START_TO_END,v)==-1&&u.compareBoundaryPoints(u.END_TO_START,v)==1?function(n,t){return t=t.nativeRange||t,n==t.START_TO_END?n=t.END_TO_START:n==t.END_TO_START&&(n=t.START_TO_END),this.nativeRange.compareBoundaryPoints(n,t)}:function(n,t){return this.nativeRange.compareBoundaryPoints(n,t.nativeRange||t)};y=document.createElement("div");y.innerHTML="123";p=y.firstChild;w=e(document);w.appendChild(y);u.setStart(p,1);u.setEnd(p,2);u.deleteContents();p.data=="13"&&(r.deleteContents=function(){this.nativeRange.deleteContents();h(this)},r.extractContents=function(){var n=this.nativeRange.extractContents();return h(this),n});w.removeChild(y);w=null;c.isHostMethod(u,"createContextualFragment")&&(r.createContextualFragment=function(n){return this.nativeRange.createContextualFragment(n)});e(document).removeChild(l);r.getName=function(){return"WrappedRange"};n.WrappedRange=o;n.createNativeRange=function(n){return n=s(n,t,"createNativeRange"),n.createRange()}}(),n.features.implementsTextRange){var p=function(n){var e=n.parentElement(),t=n.duplicate(),r,f,u;return t.collapse(!0),r=t.parentElement(),t=n.duplicate(),t.collapse(!1),f=t.parentElement(),u=r==f?r:i.getCommonAncestor(r,f),u==e?u:i.getCommonAncestor(e,u)},w=function(n){return n.compareEndPoints("StartToEnd",n)==0},l=function(n,t,r,f,e){var c=n.duplicate(),o,k,s,g,y,it;if(c.collapse(r),o=c.parentElement(),i.isOrIsAncestorOf(t,o)||(o=t),!o.canHaveHTML)return k=new u(o.parentNode,i.getNodeIndex(o)),{boundaryPosition:k,nodeInfo:{nodeIndex:k.offset,containerElement:k.node}};s=i.getDocument(o).createElement("span");s.parentNode&&i.removeNode(s);for(var p,rt=r?"StartToStart":"StartToEnd",w,d,nt,b,l=e&&e.containerElement==o?e.nodeIndex:0,tt=o.childNodes.length,a=tt,v=a;;){if(v==tt?o.appendChild(s):o.insertBefore(s,o.childNodes[v]),c.moveToElementText(s),p=c.compareEndPoints(rt,n),p==0||l==a)break;else if(p==-1)if(a==l+1)break;else l=v;else a=a==l+1?l:v;v=Math.floor((l+a)/2);o.removeChild(s)}if(b=s.nextSibling,p==-1&&b&&h(b)){if(c.setEndPoint(r?"EndToStart":"EndToEnd",n),/[\r\n]/.test(b.data))for(y=c.duplicate(),it=y.text.replace(/\r\n/g,"\r").length,g=y.moveStart("character",it);(p=y.compareEndPoints("StartToEnd",y))==-1;)g++,y.moveStart("character",1);else g=c.text.length;nt=new u(b,g)}else w=(f||!r)&&s.previousSibling,d=(f||r)&&s.nextSibling,nt=d&&h(d)?new u(d,0):w&&h(w)?new u(w,w.data.length):new u(o,i.getNodeIndex(s));return i.removeNode(s),{boundaryPosition:nt,nodeInfo:{nodeIndex:v,containerElement:o}}},a=function(n,t){var u,f,s=n.offset,l=i.getDocument(n.node),r,c,o=e(l).createTextRange(),a=h(n.node);return a?(u=n.node,f=u.parentNode):(c=n.node.childNodes,u=s<c.length?c[s]:null,f=n.node),r=l.createElement("span"),r.innerHTML="&#feff;",u?f.insertBefore(r,u):f.appendChild(r),o.moveToElementText(r),o.collapse(!t),f.removeChild(r),a&&o[t?"moveStart":"moveEnd"]("character",s),o};r=function(n){this.textRange=n;this.refresh()};r.prototype=new f(document);r.prototype.refresh=function(){var n,t,i,r=p(this.textRange);w(this.textRange)?t=n=l(this.textRange,r,!0,!0).boundaryPosition:(i=l(this.textRange,r,!0,!1),n=i.boundaryPosition,t=l(this.textRange,r,!1,!1,i.nodeInfo).boundaryPosition);this.setStart(n.node,n.offset);this.setEnd(t.node,t.offset)};r.prototype.getName=function(){return"WrappedTextRange"};f.copyComparisonConstants(r);v=function(n){if(n.collapsed)return a(new u(n.startContainer,n.startOffset),!0);var i=a(new u(n.startContainer,n.startOffset),!0),r=a(new u(n.endContainer,n.endOffset),!1),t=e(f.getRangeDocument(n)).createTextRange();return t.setEndPoint("StartToStart",i),t.setEndPoint("EndToEnd",r),t};r.rangeToTextRange=v;r.prototype.toTextRange=function(){return v(this)};n.WrappedTextRange=r;(!n.features.implementsDomRange||n.config.preferTextRange)&&(y=function(n){return n("return this;")()}(Function),typeof y.Range=="undefined"&&(y.Range=r),n.createNativeRange=function(n){return n=s(n,t,"createNativeRange"),e(n).createTextRange()},n.WrappedRange=r)}n.createRange=function(i){return i=s(i,t,"createRange"),new n.WrappedRange(n.createNativeRange(i))};n.createRangyRange=function(n){return n=s(n,t,"createRangyRange"),new f(n)};c.createAliasForDeprecatedMethod(n,"createIframeRange","createRange");c.createAliasForDeprecatedMethod(n,"createIframeRangyRange","createRangyRange");n.addShimListener(function(t){var i=t.document;typeof i.createRange=="undefined"&&(i.createRange=function(){return n.createRange(i)});i=t=null})});n.createCoreModule("WrappedSelection",["DomRange","WrappedRange"],function(n,t){function yt(n){return typeof n=="string"?/^backward(s)?$/i.test(n):!!n}function ft(n,i){if(n){if(f.isWindow(n))return n;if(n instanceof h)return n.win;var r=f.getContentDocument(n,t,i);return f.getWindow(r)}return window}function bi(n){return ft(n,"getWinSelection").getSelection()}function fi(n){return ft(n,"getDocSelection").document.selection}function ei(n){var t=!1;return n.anchorNode&&(t=f.comparePoints(n.anchorNode,n.anchorOffset,n.focusNode,n.focusOffset)==1),t}function nt(n,t,i){var r=i?"end":"start",u=i?"start":"end";n.anchorNode=t[r+"Container"];n.anchorOffset=t[r+"Offset"];n.focusNode=t[u+"Container"];n.focusOffset=t[u+"Offset"]}function ki(n){var t=n.nativeSelection;n.anchorNode=t.anchorNode;n.anchorOffset=t.anchorOffset;n.focusNode=t.focusNode;n.focusOffset=t.focusOffset}function v(n){n.anchorNode=n.focusNode=null;n.anchorOffset=n.focusOffset=0;n.rangeCount=0;n.isCollapsed=!0;n._ranges.length=0}function kt(t){var i;return t instanceof k?(i=n.createNativeRange(t.getDocument()),i.setEnd(t.endContainer,t.endOffset),i.setStart(t.startContainer,t.startOffset)):t instanceof at?i=t.nativeRange:r.implementsDomRange&&t instanceof f.getWindow(t.startContainer).Range&&(i=t),i}function di(n){if(!n.length||n[0].nodeType!=1)return!1;for(var t=1,i=n.length;t<i;++t)if(!f.isAncestorOf(n[0],n[t]))return!1;return!0}function dt(n){var i=n.getNodes();if(!di(i))throw t.createError("getSingleElementFromRange: range "+n.inspect()+" did not consist of a single element");return i[0]}function gt(n){return!!n&&typeof n.text!="undefined"}function ci(n,t){var i=new at(t);n._ranges=[i];nt(n,i,!1);n.rangeCount=1;n.isCollapsed=i.collapsed}function tt(t){var i,u,f,r;if(t._ranges.length=0,t.docSelection.type=="None")v(t);else if(i=t.docSelection.createRange(),gt(i))ci(t,i);else{for(t.rangeCount=i.length,f=e(i.item(0)),r=0;r<t.rangeCount;++r)u=n.createRange(f),u.selectNode(i.item(r)),t._ranges.push(u);t.isCollapsed=t.rangeCount==1&&t._ranges[0].collapsed;nt(t,t._ranges[t.rangeCount-1],!1)}}function li(n,i){for(var r=n.docSelection.createRange(),o=dt(i),s=e(r.item(0)),u=y(s).createControlRange(),f=0,h=r.length;f<h;++f)u.add(r.item(f));try{u.add(o)}catch(c){throw t.createError("addRange(): Element within the specified Range could not be added to control selection (does it have layout?)");}u.select();tt(n)}function h(n,t,i){this.nativeSelection=n;this.docSelection=t;this._ranges=[];this.win=i;this.refresh()}function ai(n){n.win=n.anchorNode=n.focusNode=n._ranges=null;n.rangeCount=n.anchorOffset=n.focusOffset=0;n.detached=!0}function ni(n,t){for(var i=b.length,r,u;i--;)if(r=b[i],u=r.selection,t=="deleteAll")ai(u);else if(r.win==n)return t=="delete"?(b.splice(i,1),!0):u;return t=="deleteAll"&&(b.length=0),null}function vi(n,i){for(var o=e(i[0].startContainer),u=y(o).createControlRange(),r=0,f,s=i.length;r<s;++r){f=dt(i[r]);try{u.add(f)}catch(h){throw t.createError("setRanges(): Element within one of the specified Ranges could not be added to control selection (does it have layout?)");}}u.select();tt(n)}function yi(n,t){if(n.win.document!=e(t))throw new rt("WRONG_DOCUMENT_ERR");}function pi(t){return function(i,r){var u;this.rangeCount?(u=this.getRangeAt(0),u["set"+(t?"Start":"End")](i,r)):(u=n.createRange(this.win.document),u.setStartAndEnd(i,r));this.setSingleRange(u,this.isBackward())}}function wi(n){var i=[],u=new ui(n.anchorNode,n.anchorOffset),f=new ui(n.focusNode,n.focusOffset),e=typeof n.getName=="function"?n.getName():"Selection",t,r;if(typeof n.rangeCount!="undefined")for(t=0,r=n.rangeCount;t<r;++t)i[t]=k.inspect(n.getRangeAt(t));return"["+e+"(Ranges: "+i.join(", ")+")(anchor: "+u.inspect()+", focus: "+f.inspect()+"]"}var et,o,p,u,g,wt,s,hi,st,b,ht,i,ti,ct,ii,it;n.config.checkSelectionRanges=!0;var ri="boolean",lt="number",f=n.dom,c=n.util,l=c.isHostMethod,k=n.DomRange,at=n.WrappedRange,rt=n.DOMException,ui=f.DomPosition,d,ut,r=n.features,a="Control",e=f.getDocument,y=f.getBody,vt=k.rangesEqual;if(et=l(window,"getSelection"),o=c.isHostObject(document,"selection"),r.implementsWinGetSelection=et,r.implementsDocSelection=o,p=o&&(!et||n.config.preferTextRange),p)d=fi,n.isSelectionValid=function(n){var t=ft(n,"isSelectionValid").document,i=t.selection;return i.type!="None"||e(i.createRange().parentElement())==t};else if(et)d=bi,n.isSelectionValid=function(){return!0};else return t.fail("Neither document.selection or window.getSelection() detected."),!1;if(n.getNativeSelection=d,u=d(),!u)return t.fail("Native selection was null (possibly issue 138?)"),!1;var oi=n.createNativeRange(document),pt=y(document),w=c.areHostProperties(u,["anchorNode","focusNode","anchorOffset","focusOffset"]);r.selectionHasAnchorAndFocus=w;g=l(u,"extend");r.selectionHasExtend=g;wt=typeof u.rangeCount==lt;r.selectionHasRangeCount=wt;var ot=!1,si=!0,bt=g?function(t,i){var u=k.getRangeDocument(i),r=n.createRange(u);r.collapseToPoint(i.endContainer,i.endOffset);t.addRange(kt(r));t.extend(i.startContainer,i.startOffset)}:null;if(c.areHostMethods(u,["addRange","getRangeAt","removeAllRanges"])&&typeof u.rangeCount==lt&&r.implementsDomRange&&function(){var t=window.getSelection(),i,h,o;if(t){var s=t.rangeCount,l=s>1,u=[],a=ei(t);for(i=0;i<s;++i)u[i]=t.getRangeAt(i);var c=f.createTestElement(document,"",!1),e=c.appendChild(document.createTextNode("   ")),r=document.createRange();for(r.setStart(e,1),r.collapse(!0),t.removeAllRanges(),t.addRange(r),si=t.rangeCount==1,t.removeAllRanges(),l||(h=window.navigator.appVersion.match(/Chrome\/(.*?) /),h&&parseInt(h[1])>=36?ot=!1:(o=r.cloneRange(),r.setStart(e,0),o.setEnd(e,3),o.setStart(e,2),t.addRange(r),t.addRange(o),ot=t.rangeCount==2)),f.removeNode(c),t.removeAllRanges(),i=0;i<s;++i)i==0&&a?bt?bt(t,u[i]):(n.warn("Rangy initialization: original selection was backwards but selection has been restored forwards because the browser does not support Selection.extend"),t.addRange(u[i])):t.addRange(u[i])}}(),r.selectionSupportsMultipleRanges=ot,r.collapsedNonEditableSelectionsSupported=si,s=!1,pt&&l(pt,"createControlRange")&&(hi=pt.createControlRange(),c.areHostProperties(hi,["item","add"])&&(s=!0)),r.implementsControlRange=s,ut=w?function(n){return n.anchorNode===n.focusNode&&n.anchorOffset===n.focusOffset}:function(n){return n.rangeCount?n.getRangeAt(n.rangeCount-1).collapsed:!1},l(u,"getRangeAt")?st=function(n,t){try{return n.getRangeAt(t)}catch(i){return null}}:w&&(st=function(t){var r=e(t.anchorNode),i=n.createRange(r);return i.setStartAndEnd(t.anchorNode,t.anchorOffset,t.focusNode,t.focusOffset),i.collapsed!==this.isCollapsed&&i.setStartAndEnd(t.focusNode,t.focusOffset,t.anchorNode,t.anchorOffset),i}),h.prototype=n.selectionPrototype,b=[],ht=function(n){if(n&&n instanceof h)return n.refresh(),n;n=ft(n,"getNativeSelection");var t=ni(n),i=d(n),r=o?fi(n):null;return t?(t.nativeSelection=i,t.docSelection=r,t.refresh()):(t=new h(i,r,n),b.push({win:n,selection:t})),t},n.getSelection=ht,c.createAliasForDeprecatedMethod(n,"getIframeSelection","getSelection"),i=h.prototype,!p&&w&&c.areHostMethods(u,["removeAllRanges","addRange"]))i.removeAllRanges=function(){this.nativeSelection.removeAllRanges();v(this)},ti=function(n,t){bt(n.nativeSelection,t);n.refresh()},i.addRange=wt?function(t,i){var u,f,r;if(s&&o&&this.docSelection.type==a)li(this,t);else if(yt(i)&&g)ti(this,t);else{ot?u=this.rangeCount:(this.removeAllRanges(),u=0);f=kt(t).cloneRange();try{this.nativeSelection.addRange(f)}catch(e){}this.rangeCount=this.nativeSelection.rangeCount;this.rangeCount==u+1?(n.config.checkSelectionRanges&&(r=st(this.nativeSelection,this.rangeCount-1),r&&!vt(r,t)&&(t=new at(r))),this._ranges[this.rangeCount-1]=t,nt(this,t,it(this.nativeSelection)),this.isCollapsed=ut(this)):this.refresh()}}:function(n,t){yt(t)&&g?ti(this,n):(this.nativeSelection.addRange(kt(n)),this.refresh())},i.setRanges=function(n){if(s&&o&&n.length>1)vi(this,n);else{this.removeAllRanges();for(var t=0,i=n.length;t<i;++t)this.addRange(n[t])}};else if(l(u,"empty")&&l(oi,"select")&&s&&p)i.removeAllRanges=function(){var n,t,i;try{this.docSelection.empty();this.docSelection.type!="None"&&(this.anchorNode?n=e(this.anchorNode):this.docSelection.type==a&&(t=this.docSelection.createRange(),t.length&&(n=e(t.item(0)))),n&&(i=y(n).createTextRange(),i.select(),this.docSelection.empty()))}catch(r){}v(this)},i.addRange=function(t){this.docSelection.type==a?li(this,t):(n.WrappedTextRange.rangeToTextRange(t).select(),this._ranges[0]=t,this.rangeCount=1,this.isCollapsed=this._ranges[0].collapsed,nt(this,t,!1))},i.setRanges=function(n){this.removeAllRanges();var t=n.length;t>1?vi(this,n):t&&this.addRange(n[0])};else return t.fail("No means of selecting a Range or TextRange was found"),!1;if(i.getRangeAt=function(n){if(n<0||n>=this.rangeCount)throw new rt("INDEX_SIZE_ERR");else return this._ranges[n].cloneRange()},p)ct=function(t){var i;n.isSelectionValid(t.win)?i=t.docSelection.createRange():(i=y(t.win.document).createTextRange(),i.collapse(!0));t.docSelection.type==a?tt(t):gt(i)?ci(t,i):v(t)};else if(l(u,"getRangeAt")&&typeof u.rangeCount==lt)ct=function(t){if(s&&o&&t.docSelection.type==a)tt(t);else if(t._ranges.length=t.rangeCount=t.nativeSelection.rangeCount,t.rangeCount){for(var i=0,r=t.rangeCount;i<r;++i)t._ranges[i]=new n.WrappedRange(t.nativeSelection.getRangeAt(i));nt(t,t._ranges[t.rangeCount-1],it(t.nativeSelection));t.isCollapsed=ut(t)}else v(t)};else if(w&&typeof u.isCollapsed==ri&&typeof oi.collapsed==ri&&r.implementsDomRange)ct=function(n){var t,i=n.nativeSelection;i.anchorNode?(t=st(i,0),n._ranges=[t],n.rangeCount=1,ki(n),n.isCollapsed=ut(n)):v(n)};else return t.fail("No means of obtaining a Range or TextRange from the user's selection was found"),!1;i.refresh=function(n){var i=n?this._ranges.slice(0):null,r=this.anchorNode,u=this.anchorOffset,t;if(ct(this),n){if((t=i.length,t!=this._ranges.length)||this.anchorNode!=r||this.anchorOffset!=u)return!0;while(t--)if(!vt(i[t],this._ranges[t]))return!0;return!1}};ii=function(n,t){var r=n.getAllRanges(),i,u;for(n.removeAllRanges(),i=0,u=r.length;i<u;++i)vt(t,r[i])||n.addRange(r[i]);n.rangeCount||v(n)};i.removeRange=s&&o?function(n){var t,o;if(this.docSelection.type==a){var i=this.docSelection.createRange(),s=dt(n),h=e(i.item(0)),r=y(h).createControlRange(),u,f=!1;for(t=0,o=i.length;t<o;++t)u=i.item(t),u!==s||f?r.add(i.item(t)):f=!0;r.select();tt(this)}else ii(this,n)}:function(n){ii(this,n)};!p&&w&&r.implementsDomRange?(it=ei,i.isBackward=function(){return it(this)}):it=i.isBackward=function(){return!1};i.isBackwards=i.isBackward;i.toString=function(){for(var t=[],n=0,i=this.rangeCount;n<i;++n)t[n]=""+this._ranges[n];return t.join("")};i.collapse=function(t,i){yi(this,t);var r=n.createRange(t);r.collapseToPoint(t,i);this.setSingleRange(r);this.isCollapsed=!0};i.collapseToStart=function(){if(this.rangeCount){var n=this._ranges[0];this.collapse(n.startContainer,n.startOffset)}else throw new rt("INVALID_STATE_ERR");};i.collapseToEnd=function(){if(this.rangeCount){var n=this._ranges[this.rangeCount-1];this.collapse(n.endContainer,n.endOffset)}else throw new rt("INVALID_STATE_ERR");};i.selectAllChildren=function(t){yi(this,t);var i=n.createRange(t);i.selectNodeContents(t);this.setSingleRange(i)};i.deleteFromDocument=function(){var t,r,n,i,u;if(s&&o&&this.docSelection.type==a){for(t=this.docSelection.createRange();t.length;)r=t.item(0),t.remove(r),f.removeNode(r);this.refresh()}else if(this.rangeCount&&(n=this.getAllRanges(),n.length)){for(this.removeAllRanges(),i=0,u=n.length;i<u;++i)n[i].deleteContents();this.addRange(n[u-1])}};i.eachRange=function(n,t){for(var i=0,r=this._ranges.length;i<r;++i)if(n(this.getRangeAt(i)))return t};i.getAllRanges=function(){var n=[];return this.eachRange(function(t){n.push(t)}),n};i.setSingleRange=function(n,t){this.removeAllRanges();this.addRange(n,t)};i.callMethodOnEachRange=function(n,t){var i=[];return this.eachRange(function(r){i.push(r[n].apply(r,t||[]))}),i};i.setStart=pi(!0);i.setEnd=pi(!1);n.rangePrototype.select=function(n){ht(this.getDocument()).setSingleRange(this,n)};i.changeEachRange=function(n){var t=[],i=this.isBackward();this.eachRange(function(i){n(i);t.push(i)});this.removeAllRanges();i&&t.length==1?this.addRange(t[0],"backward"):this.setRanges(t)};i.containsNode=function(n,t){return this.eachRange(function(i){return i.containsNode(n,t)},!0)||!1};i.getBookmark=function(n){return{backward:this.isBackward(),rangeBookmarks:this.callMethodOnEachRange("getBookmark",[n])}};i.moveToBookmark=function(t){for(var i=[],f=0,u,r;u=t.rangeBookmarks[f++];)r=n.createRange(this.win),r.moveToBookmark(u),i.push(r);t.backward?this.setSingleRange(i[0],"backward"):this.setRanges(i)};i.saveRanges=function(){return{backward:this.isBackward(),ranges:this.callMethodOnEachRange("cloneRange")}};i.restoreRanges=function(n){this.removeAllRanges();for(var t=0,i;i=n.ranges[t];++t)this.addRange(i,n.backward&&t==0)};i.toHtml=function(){var n=[];return this.eachRange(function(t){n.push(k.toHtml(t))}),n.join("")};r.implementsTextRange&&(i.getNativeTextRange=function(){var r,i;if(r=this.docSelection){if(i=r.createRange(),gt(i))return i;throw t.createError("getNativeTextRange: selection is a control selection");}else{if(this.rangeCount>0)return n.WrappedTextRange.rangeToTextRange(this.getRangeAt(0));throw t.createError("getNativeTextRange: selection contains no range");}});i.getName=function(){return"WrappedSelection"};i.inspect=function(){return wi(this)};i.detach=function(){ni(this.win,"delete");ai(this)};h.detachAll=function(){ni(null,"deleteAll")};h.inspect=wi;h.isDirectionBackward=yt;n.Selection=h;n.selectionPrototype=i;n.addShimListener(function(n){typeof n.getSelection=="undefined"&&(n.getSelection=function(){return ht(n)});n=null})});d=!1;v=function(){d||(d=!0,!n.initialized&&n.config.autoInitialize&&k())};i&&(document.readyState=="complete"?v():(t(document,"addEventListener")&&document.addEventListener("DOMContentLoaded",v,!1),h(window,"load",v)));rangy=n}();rangy.createModule("SaveRestore",["WrappedRange"],function(n,t){function i(n,t){return(t||document).getElementById(n)}function f(n,t){var f="selectionBoundary_"+ +new Date+"_"+(""+Math.random()).slice(2),i,r=e.getDocument(n.startContainer),u=n.cloneRange();return u.collapse(t),i=r.createElement("span"),i.id=f,i.style.lineHeight="0",i.style.display="none",i.className="rangySelectionBoundary",i.appendChild(r.createTextNode(v)),u.insertNode(i),i}function s(n,u,f,e){var o=i(f,n);o?(u[e?"setStartBefore":"setEndBefore"](o),r(o)):t.warn("Marker element has been removed. Cannot restore selection.")}function y(n,t){return t.compareBoundaryPoints(n.START_TO_START,n)}function h(t,i){var u,r,e=n.DomRange.getRangeDocument(t),s=t.toString(),h=o(i);return t.collapsed?(r=f(t,!1),{document:e,markerId:r.id,collapsed:!0}):(r=f(t,!1),u=f(t,!0),{document:e,startMarkerId:u.id,endMarkerId:r.id,collapsed:!1,backward:h,toString:function(){return"original text: '"+s+"', new text: '"+t.toString()+"'"}})}function c(u,f){var c=u.document,e,o,h;return typeof f=="undefined"&&(f=!0),e=n.createRange(c),u.collapsed?(o=i(u.markerId,c),o?(o.style.display="inline",h=o.previousSibling,h&&h.nodeType==3?(r(o),e.collapseToPoint(h,h.length)):(e.collapseBefore(o),r(o))):t.warn("Marker element has been removed. Cannot restore selection.")):(s(c,e,u.startMarkerId,!0),s(c,e,u.endMarkerId,!1)),f&&e.normalizeBoundaries(),e}function l(t,r){var e=[],f,s,l=o(r),u,c;for(t=t.slice(0),t.sort(y),u=0,c=t.length;u<c;++u)e[u]=h(t[u],l);for(u=c-1;u>=0;--u)f=t[u],s=n.DomRange.getRangeDocument(f),f.collapsed?f.collapseAfter(i(e[u].markerId,s)):(f.setEndBefore(i(e[u].endMarkerId,s)),f.setStartAfter(i(e[u].startMarkerId,s)));return e}function p(i){if(!n.isSelectionValid(i))return t.warn("Cannot save selection. This usually happens when the selection is collapsed and the selection document has lost focus."),null;var r=n.getSelection(i),u=r.getAllRanges(),f=u.length==1&&r.isBackward(),e=l(u,f);return f?r.setSingleRange(u[0],f):r.setRanges(u),{win:i,rangeInfos:e,restored:!1}}function a(n){for(var i=[],r=n.length,t=r-1;t>=0;t--)i[t]=c(n[t],!0);return i}function w(t,i){if(!t.restored){var r=t.rangeInfos,u=n.getSelection(t.win),f=a(r),e=r.length;e==1&&i&&n.features.selectionHasExtend&&r[0].backward?(u.removeAllRanges(),u.addRange(f[0],!0)):u.setRanges(f);t.restored=!0}}function u(n,t){var u=i(t,n);u&&r(u)}function b(n){for(var r=n.rangeInfos,i=0,f=r.length,t;i<f;++i)t=r[i],t.collapsed?u(n.doc,t.markerId):(u(n.doc,t.startMarkerId),u(n.doc,t.endMarkerId))}var e=n.dom,r=e.removeNode,o=n.Selection.isDirectionBackward,v="﻿";n.util.extend(n,{saveRange:h,restoreRange:c,saveRanges:l,restoreRanges:a,saveSelection:p,restoreSelection:w,removeMarkerElement:u,removeMarkers:b})});rangy.createModule("TextRange",["WrappedSelection"],function(n,t){function nr(n,t){function e(n,t,i){o.push({start:n,end:t,isWord:i})}for(var s=n.join(""),f,o=[],i=0,r,u;f=t.wordRegex.exec(s);){if(r=f.index,u=r+f[0].length,r>i&&e(i,r,!1),t.includeTrailingSpace)while(di.test(n[u]))++u;e(r,u,!0);i=u}return i<n.length&&e(i,n.length,!1),o}function tr(n,t){for(var i=n.slice(t.start,t.end),u={isWord:t.isWord,chars:i,toString:function(){return i.join("")}},r=0,f=i.length;r<f;++r)i[r].token=u;return u}function it(n,t,i){for(var f=i(n,t),r=[],e=0,u;u=f[e++];)r.push(tr(n,u));return r}function ir(n){var t=n||"",i=typeof t=="string"?t.split(""):t;return i.sort(function(n,t){return n.charCodeAt(0)-t.charCodeAt(0)}),i.join("").replace(/(.)\1+/g,"$1")}function sr(n){var i,t;return n?(i=n.language||nt,t={},f(t,rt[i]||rt[nt]),f(t,n),t):rt[nt]}function w(n,t){var i=a(n,t);return t.hasOwnProperty("wordOptions")&&(i.wordOptions=sr(i.wordOptions)),t.hasOwnProperty("characterOptions")&&(i.characterOptions=a(i.characterOptions,p)),i}function b(n,t){var i=o(n,"display",t),r=n.tagName.toLowerCase();return i=="block"&&bt&&ut.hasOwnProperty(r)?ut[r]:i}function kt(n){for(var i=yr(n),t=0,r=i.length;t<r;++t)if(i[t].nodeType==1&&b(i[t])=="none")return!0;return!1}function hr(n){var t;return n.nodeType==3&&(t=n.parentNode)&&o(t,"visibility")=="hidden"}function cr(n){return n&&(n.nodeType==1&&!/^(inline(-block|-table)?|none)$/.test(b(n))||n.nodeType==9||n.nodeType==11)}function ar(n){return u.isCharacterDataNode(n)||!/^(area|base|basefont|br|col|frame|hr|img|input|isindex|link|meta|param)$/i.test(n.nodeName)}function vr(n){for(var t=[];n.parentNode;)t.unshift(n.parentNode),n=n.parentNode;return t}function yr(n){return vr(n).concat([n])}function pr(n){while(n&&!n.nextSibling)n=n.parentNode;return n?n.nextSibling:null}function dt(n,t){return!t&&n.hasChildNodes()?n.firstChild:pr(n)}function gt(n){var i=n.previousSibling,t;if(i){for(n=i;n.hasChildNodes();)n=n.lastChild;return n}return(t=n.parentNode,t&&t.nodeType==1)?t:null}function ni(n){var t,i,r;return!n||n.nodeType!=3?!1:(t=n.data,t==="")?!0:(i=n.parentNode,!i||i.nodeType!=1)?!1:(r=o(n.parentNode,"whiteSpace"),/^[\t\n\r ]+$/.test(t)&&/^(normal|nowrap)$/.test(r)||/^[\t\r ]+$/.test(t)&&r=="pre-line")}function ft(n){if(n.data==="")return!0;if(!ni(n))return!1;var t=n.parentNode;return t?kt(n)?!0:!1:!0}function s(n){var t=n.nodeType;return t==7||t==8||kt(n)||/^(script|style)$/i.test(n.nodeName)||hr(n)||ft(n)}function ti(n,t){var i=n.nodeType;return i==7||i==8||i==1&&b(n,t)=="none"}function h(){this.store={}}function i(n,t,i){return function(r){var u=this.cache,f;return u.hasOwnProperty(n)?(ii++,u[n]):(ri++,f=t.call(this,i?this[i]:this,r),u[n]=f,f)}}function ui(n,t){this.node=n;this.session=t;this.cache=new h;this.positions=new h}function ai(n,t){this.offset=t;this.nodeWrapper=n;this.node=n.node;this.session=n.session;this.cache=new h}function br(){return"[Position("+u.inspectNode(this.node)+":"+this.offset+")]"}function kr(){return ct(),e=new vi}function ht(){return e||kr()}function ct(){e&&e.detach();e=null}function l(n,i,r,u){function c(){var n=null;return i?(n=f,e||(f=f.previousVisible(),e=!f||r&&f.equals(r))):e||(n=f=f.nextVisible(),e=!f||r&&f.equals(r)),e&&(f=null),n}var f,e,h,o;return r&&(i?s(r.node)&&(r=n.previousVisible()):s(r.node)&&(r=r.nextVisible())),f=n,e=!1,o=!1,{next:function(){if(o)return o=!1,h;for(var n,t;n=c();)if(t=n.getCharacter(u),t)return h=n,n;return null},rewind:function(){if(h)o=!0;else throw t.createError("createCharacterIterator: cannot rewind. Only one position can be rewound.");},dispose:function(){n=r=null}}}function k(n,t,i){function f(n){for(var t,r,u=[],f=n?c:a,e=!1,i=!1;t=f.next();){if(r=t.character,yt.test(r))i&&(i=!1,e=!0);else if(e){f.rewind();break}else i=!0;u.push(t)}return u}var c=l(n,!1,null,t),a=l(n,!0,null,t),o=i.tokenizer,s=f(!0),h=f(!1).reverse(),e=it(h.concat(s),i,o),r=s.length?e.slice(lt(e,s[0].token)):[],u=h.length?e.slice(0,lt(e,h.pop().token)+1):[];return{nextEndToken:function(){for(var n,t;r.length==1&&!(n=r[0]).isWord&&(t=f(!0)).length>0;)r=it(n.chars.concat(t),i,o);return r.shift()},previousStartToken:function(){for(var n,t;u.length==1&&!(n=u[0]).isWord&&(t=f(!1)).length>0;)u=it(t.reverse().concat(n.chars),i,o);return u.pop()},dispose:function(){c.dispose();a.dispose();r=u=null}}}function dr(n,t,i,r,u){var e=0,a,f=n,o,c,p=Math.abs(i),s,h,y,w;if(i!==0){h=i<0;switch(t){case v:for(o=l(n,h,null,r);(a=o.next())&&e<p;)++e,f=a;c=a;o.dispose();break;case d:for(y=k(n,r,u),w=h?y.previousStartToken:y.nextEndToken;(s=w())&&e<p;)s.isWord&&(++e,f=h?s.chars[0]:s.chars[s.chars.length-1]);break;default:throw new Error("movePositionBy: unit '"+t+"' not implemented");}h?(f=f.previousVisible(),e=-e):f&&f.isLeadingSpace&&!f.isTrailingSpace&&(t==d&&(o=l(n,!1,null,r),c=o.next(),o.dispose()),c&&(f=c.previousVisible()))}return{position:f,unitsMoved:e}}function yi(n,t,i,r){var u=n.getRangeBoundaryPosition(t,!0),f=n.getRangeBoundaryPosition(t,!1),e=r?f:u,o=r?u:f;return l(e,!!r,o,i)}function gr(n,t,i){for(var r=[],u=yi(n,t,i),f;f=u.next();)r.push(f);return u.dispose(),r}function nu(t,i,r){var u=n.createRange(t.node);return u.setStartAndEnd(t.node,t.offset,i.node,i.offset),!u.expand("word",{wordOptions:r})}function tu(n,t,i,r,u){function w(n,t){var i=h[n].previousVisible(),r=h[t-1],f=!u.wholeWordsOnly||nu(i,r,u.wordOptions);return{startPos:i,endPos:r,valid:f}}for(var o=tt(u.direction),b=l(n,o,n.session.getRangeBoundaryPosition(r,o),u.characterOptions),e="",h=[],c,s,f,a,v,p,y=null;c=b.next();)if(s=c.character,i||u.caseSensitive||(s=s.toLowerCase()),o?(h.unshift(c),e=s+e):(h.push(c),e+=s),i){if(v=t.exec(e),v)if(f=v.index,a=f+v[0].length,p){if(!o&&a<e.length||o&&f>0){y=w(f,a);break}}else p=!0}else if((f=e.indexOf(t))!=-1){y=w(f,f+t.length);break}return p&&(y=w(f,a)),b.dispose(),y}function r(n){return function(){var t=!!e,i=ht(),r=[i].concat(y.toArray(arguments)),u=n.apply(this,r);return t||ct(),u}}function at(n,t){return r(function(i,r,u,f){var e,o,s;return typeof u==wi&&(u=r,r=v),f=w(f,fr),e=n,t&&(e=u>=0,this.collapse(!e)),o=dr(i.getRangeBoundaryPosition(this,e),r,u,f.characterOptions,f.wordOptions),s=o.position,this[e?"setStart":"setEnd"](s.node,s.offset),o.unitsMoved})}function pi(n){return r(function(t,i){var e,u,r,f;for(i=a(i,p),u=yi(t,this,i,!n),r=0;(e=u.next())&&yt.test(e.character);)++r;return u.dispose(),f=r>0,f&&this[n?"moveStart":"moveEnd"]("character",n?r:-r,{characterOptions:i}),f})}function vt(n){return r(function(t,i){var r=!1;return this.changeEachRange(function(t){r=t[n](i)||r}),r})}var wi="undefined",v="character",d="word",u=n.dom,y=n.util,f=y.extend,a=y.createOptions,g=u.getBody,bi=/^[ \t\f\r\n]+$/,ki=/^[ \t\f\r]+$/,yt=/^[\t-\r \u0085\u00A0\u1680\u180E\u2000-\u200B\u2028\u2029\u202F\u205F\u3000]+$/,di=/^[\t \u00A0\u1680\u180E\u2000-\u200B\u202F\u205F\u3000]+$/,nt="en",tt=n.Selection.isDirectionBackward,gi=!1,pt=!1,wt=!1,p,o,bt,ut,ii,ri,et,st,e,vi,lt;(function(){var i=u.createTestElement(document,"<p>1 <\/p><p><\/p>",!0),r=i.firstChild,t=n.getSelection();t.collapse(r.lastChild,2);t.setStart(r.firstChild,0);gi=(""+t).length==1;i.innerHTML="1 <br />";t.collapse(i,2);t.setStart(i.firstChild,0);pt=(""+t).length==1;i.innerHTML="1 <p>1<\/p>";t.collapse(i,2);t.setStart(i.firstChild,0);wt=(""+t).length==1;u.removeNode(i);t.removeAllRanges()})();p={includeBlockContentTrailingSpace:!0,includeSpaceBeforeBr:!0,includeSpaceBeforeBlock:!0,includePreLineTrailingSpace:!0,ignoreCharacters:""};var rr={includeBlockContentTrailingSpace:!1,includeSpaceBeforeBr:!pt,includeSpaceBeforeBlock:!wt,includePreLineTrailingSpace:!0},rt={en:{wordRegex:/[a-z0-9]+('[a-z0-9]+)*/gi,includeTrailingSpace:!1,tokenizer:nr}},ur={caseSensitive:!1,withinRange:null,wholeWordsOnly:!1,wrap:!1,direction:"forward",wordOptions:null,characterOptions:null},fr={wordOptions:null,characterOptions:null},er={wordOptions:null,characterOptions:null,trim:!1,trimStart:!0,trimEnd:!0},or={wordOptions:null,characterOptions:null,direction:"forward"};o=u.getComputedStyleProperty,function(){var n=document.createElement("table"),t=g(document);t.appendChild(n);bt=o(n,"display")=="block";t.removeChild(n)}();ut={table:"table",caption:"table-caption",colgroup:"table-column-group",col:"table-column",thead:"table-header-group",tbody:"table-row-group",tfoot:"table-footer-group",tr:"table-row",td:"table-cell",th:"table-cell"};h.prototype={get:function(n){return this.store.hasOwnProperty(n)?this.store[n]:null},set:function(n,t){return this.store[n]=t}};ii=0;ri=0;et={getPosition:function(n){var t=this.positions;return t.get(n)||t.set(n,new ai(this,n))},toString:function(){return"[NodeWrapper("+u.inspectNode(this.node)+")]"}};ui.prototype=et;var fi="EMPTY",ot="NON_SPACE",ei="UNCOLLAPSIBLE_SPACE",c="COLLAPSIBLE_SPACE",oi="TRAILING_SPACE_BEFORE_BLOCK",si="TRAILING_SPACE_IN_BLOCK",hi="TRAILING_SPACE_BEFORE_BR",ci="PRE_LINE_TRAILING_SPACE_BEFORE_LINE_BREAK",wr="TRAILING_LINE_BREAK_AFTER_BR",li="INCLUDED_TRAILING_LINE_BREAK_AFTER_BR";f(et,{isCharacterDataNode:i("isCharacterDataNode",u.isCharacterDataNode,"node"),getNodeIndex:i("nodeIndex",u.getNodeIndex,"node"),getLength:i("nodeLength",u.getNodeLength,"node"),containsPositions:i("containsPositions",ar,"node"),isWhitespace:i("isWhitespace",ni,"node"),isCollapsedWhitespace:i("isCollapsedWhitespace",ft,"node"),getComputedDisplay:i("computedDisplay",b,"node"),isCollapsed:i("collapsed",s,"node"),isIgnored:i("ignored",ti,"node"),next:i("nextPos",dt,"node"),previous:i("previous",gt,"node"),getTextNodeInfo:i("textNodeInfo",function(n){var t=null,i=!1,r=o(n.parentNode,"whiteSpace"),u=r=="pre-line";return u?(t=ki,i=!0):(r=="normal"||r=="nowrap")&&(t=bi,i=!0),{node:n,text:n.data,spaceRegex:t,collapseSpaces:i,preLine:u}},"node"),hasInnerText:i("hasInnerText",function(n,t){for(var r=this.session,u=r.getPosition(n.parentNode,this.getNodeIndex()+1),f=r.getPosition(n,0),i=t?u:f,e=t?f:u;i!==e;){if(i.prepopulateChar(),i.isDefinitelyNonEmpty())return!0;i=t?i.previousVisible():i.nextVisible()}return!1},"node"),isRenderedBlock:i("isRenderedBlock",function(n){for(var i=n.getElementsByTagName("br"),t=0,r=i.length;t<r;++t)if(!s(i[t]))return!0;return this.hasInnerText()},"node"),getTrailingSpace:i("trailingSpace",function(n){if(n.tagName.toLowerCase()=="br")return"";switch(this.getComputedDisplay()){case"inline":for(var t=n.lastChild;t;){if(!ti(t))return t.nodeType==1?this.session.getNodeWrapper(t).getTrailingSpace():"";t=t.previousSibling}break;case"inline-block":case"inline-table":case"none":case"table-column":case"table-column-group":break;case"table-cell":return"\t";default:return this.isRenderedBlock(!0)?"\n":""}return""},"node"),getLeadingSpace:i("leadingSpace",function(){switch(this.getComputedDisplay()){case"inline":case"inline-block":case"inline-table":case"none":case"table-column":case"table-column-group":case"table-cell":break;default:return this.isRenderedBlock(!1)?"\n":""}return""},"node")});st={character:"",characterType:fi,isBr:!1,prepopulateChar:function(){var n=this,u,o;if(!n.prepopulatedChar){var f=n.node,t=n.offset,i="",r=fi,e=!1;if(t>0)if(f.nodeType==3){var h=f.data,l=h.charAt(t-1),a=n.nodeWrapper.getTextNodeInfo(),v=a.spaceRegex;a.collapseSpaces?v.test(l)?t>1&&v.test(h.charAt(t-2))||(a.preLine&&h.charAt(t)==="\n"?(i=" ",r=ci):(i=" ",r=c)):(i=l,r=ot,e=!0):(i=l,r=ei,e=!0)}else u=f.childNodes[t-1],u&&u.nodeType==1&&!s(u)&&(u.tagName.toLowerCase()=="br"?(i="\n",n.isBr=!0,r=c,e=!1):n.checkForTrailingSpace=!0),i||(o=f.childNodes[t],o&&o.nodeType==1&&!s(o)&&(n.checkForLeadingSpace=!0));n.prepopulatedChar=!0;n.character=i;n.characterType=r;n.isCharInvariant=e}},isDefinitelyNonEmpty:function(){var n=this.characterType;return n==ot||n==ei},resolveLeadingAndTrailingSpaces:function(){var n,t;this.prepopulatedChar||this.prepopulateChar();this.checkForTrailingSpace&&(n=this.session.getNodeWrapper(this.node.childNodes[this.offset-1]).getTrailingSpace(),n&&(this.isTrailingSpace=!0,this.character=n,this.characterType=c),this.checkForTrailingSpace=!1);this.checkForLeadingSpace&&(t=this.session.getNodeWrapper(this.node.childNodes[this.offset]).getLeadingSpace(),t&&(this.isLeadingSpace=!0,this.character=t,this.characterType=c),this.checkForLeadingSpace=!1)},getPrecedingUncollapsedPosition:function(n){for(var t=this,i;t=t.previousVisible();)if(i=t.getCharacter(n),i!=="")return t;return null},getCharacter:function(n){function s(){return h||(i=v.getPrecedingUncollapsedPosition(n),h=!0),i}var e,o;this.resolveLeadingAndTrailingSpaces();var u=this.character,f=ir(n.ignoreCharacters),l=u!==""&&f.indexOf(u)>-1;if(this.isCharInvariant)return l?"":u;if(e=["character",n.includeSpaceBeforeBr,n.includeBlockContentTrailingSpace,n.includePreLineTrailingSpace,f].join("_"),o=this.cache.get(e),o!==null)return o;var r="",a=this.characterType==c,t,i,h=!1,v=this;return a&&(this.type==li?r="\n":u==" "&&(!s()||i.isTrailingSpace||i.character=="\n"||i.character==" "&&i.characterType==c)||(u=="\n"&&this.isLeadingSpace?s()&&i.character!="\n"&&(r="\n"):(t=this.nextUncollapsed(),t&&(t.isBr?this.type=hi:t.isTrailingSpace&&t.character=="\n"?this.type=si:t.isLeadingSpace&&t.character=="\n"&&(this.type=oi),t.character=="\n"?(this.type!=hi||n.includeSpaceBeforeBr)&&(this.type!=oi||n.includeSpaceBeforeBlock)&&(this.type==si&&t.isTrailingSpace&&!n.includeBlockContentTrailingSpace||(this.type!=ci||t.type!=ot||n.includePreLineTrailingSpace)&&(u=="\n"?t.isTrailingSpace?this.isTrailingSpace||this.isBr&&(t.type=wr,s()&&i.isLeadingSpace&&!i.isTrailingSpace&&i.character=="\n"?t.character="":t.type=li):r="\n":u==" "&&(r=" "))):r=u)))),f.indexOf(r)>-1&&(r=""),this.cache.set(e,r),r},equals:function(n){return!!n&&this.node===n.node&&this.offset===n.offset},inspect:br,toString:function(){return this.character}};ai.prototype=st;f(st,{next:i("nextPos",function(n){var u=n.nodeWrapper,i=n.node,f=n.offset,o=u.session,t,r,e;return i?(f==u.getLength()?(t=i.parentNode,r=t?u.getNodeIndex()+1:0):u.isCharacterDataNode()?(t=i,r=f+1):(e=i.childNodes[f],o.getNodeWrapper(e).containsPositions()?(t=e,r=0):(t=i,r=f+1)),t?o.getPosition(t,r):null):null}),previous:i("previous",function(n){var o=n.nodeWrapper,r=n.node,f=n.offset,s=o.session,t,i,e;return f==0?(t=r.parentNode,i=t?o.getNodeIndex():0):o.isCharacterDataNode()?(t=r,i=f-1):(e=r.childNodes[f-1],s.getNodeWrapper(e).containsPositions()?(t=e,i=u.getNodeLength(e)):(t=r,i=f-1)),t?s.getPosition(t,i):null}),nextVisible:i("nextVisible",function(n){var t=n.next();if(!t)return null;var i=t.nodeWrapper,u=t.node,r=t;return i.isCollapsed()&&(r=i.session.getPosition(u.parentNode,i.getNodeIndex()+1)),r}),nextUncollapsed:i("nextUncollapsed",function(n){for(var t=n;t=t.nextVisible();)if(t.resolveLeadingAndTrailingSpaces(),t.character!=="")return t;return null}),previousVisible:i("previousVisible",function(n){var t=n.previous();if(!t)return null;var i=t.nodeWrapper,u=t.node,r=t;return i.isCollapsed()&&(r=i.session.getPosition(u.parentNode,i.getNodeIndex())),r})});e=null;vi=function(){function n(n){var t=new h;return{get:function(i){var u=t.get(i[n]),f,r;if(u)for(f=0;r=u[f++];)if(r.node===i)return r;return null},set:function(i){var r=i.node[n],u=t.get(r)||t.set(r,[]);u.push(i)}}}function t(){this.initCaches()}var i=y.isHostProperty(document.documentElement,"uniqueID");return t.prototype={initCaches:function(){this.elementCache=i?function(){var n=new h;return{get:function(t){return n.get(t.uniqueID)},set:function(t){n.set(t.node.uniqueID,t)}}}():n("tagName");this.textNodeCache=n("data");this.otherNodeCache=n("nodeName")},getNodeWrapper:function(n){var t,i;switch(n.nodeType){case 1:t=this.elementCache;break;case 3:t=this.textNodeCache;break;default:t=this.otherNodeCache}return i=t.get(n),i||(i=new ui(n,this),t.set(i)),i},getPosition:function(n,t){return this.getNodeWrapper(n).getPosition(t)},getRangeBoundaryPosition:function(n,t){var i=t?"start":"end";return this.getPosition(n[i+"Container"],n[i+"Offset"])},detach:function(){this.elementCache=this.textNodeCache=this.otherNodeCache=null}},t}();f(u,{nextNode:dt,previousNode:gt});lt=Array.prototype.indexOf?function(n,t){return n.indexOf(t)}:function(n,t){for(var i=0,r=n.length;i<r;++i)if(n[i]===t)return i;return-1};f(n.rangePrototype,{moveStart:at(!0,!1),moveEnd:at(!1,!1),move:at(!0,!0),trimStart:pi(!0),trimEnd:pi(!1),trim:r(function(n,t){var i=this.trimStart(t),r=this.trimEnd(t);return i||r}),expand:r(function(n,t,i){var r=!1,u,a;if(i=w(i,er),u=i.characterOptions,t||(t=v),t==d){var s=i.wordOptions,h=n.getRangeBoundaryPosition(this,!0),c=n.getRangeBoundaryPosition(this,!1),y=k(h,u,s),l=y.nextEndToken(),o=l.chars[0].previousVisible(),e,f;return this.collapsed?e=l:(a=k(c,u,s),e=a.previousStartToken()),f=e.chars[e.chars.length-1],o.equals(h)||(this.setStart(o.node,o.offset),r=!0),f&&!f.equals(c)&&(this.setEnd(f.node,f.offset),r=!0),i.trim&&(i.trimStart&&(r=this.trimStart(u)||r),i.trimEnd&&(r=this.trimEnd(u)||r)),r}return this.moveEnd(v,1,i)}),text:r(function(n,t){return this.collapsed?"":gr(n,this,a(t,p)).join("")}),selectCharacters:r(function(n,t,i,r,u){var f={characterOptions:u};t||(t=g(this.getDocument()));this.selectNodeContents(t);this.collapse(!0);this.moveStart("character",i,f);this.collapse(!0);this.moveEnd("character",r-i,f)}),toCharacterRange:r(function(n,t,i){t||(t=g(this.getDocument()));var e=t.parentNode,o=u.getNodeIndex(t),h=u.comparePoints(this.startContainer,this.endContainer,e,o)==-1,r=this.cloneRange(),f,s;return h?(r.setStartAndEnd(this.startContainer,this.startOffset,e,o),f=-r.text(i).length):(r.setStartAndEnd(e,o,this.startContainer,this.startOffset),f=r.text(i).length),s=f+this.text(i).length,{start:f,end:s}}),findText:r(function(t,i,r){var o,u,s,c,e,l,h,a,f;for(r=w(r,ur),r.wholeWordsOnly&&(r.wordOptions.includeTrailingSpace=!1),o=tt(r.direction),u=r.withinRange,u||(u=n.createRange(),u.selectNodeContents(this.getDocument())),s=i,c=!1,typeof s=="string"?r.caseSensitive||(s=s.toLowerCase()):c=!0,e=t.getRangeBoundaryPosition(this,!o),l=u.comparePoint(e.node,e.offset),l===-1?e=t.getRangeBoundaryPosition(u,!0):l===1&&(e=t.getRangeBoundaryPosition(u,!1)),h=e,a=!1;;)if(f=tu(h,s,c,u,r),f){if(f.valid)return this.setStartAndEnd(f.startPos.node,f.startPos.offset,f.endPos.node,f.endPos.offset),!0;h=o?f.startPos:f.endPos}else if(r.wrap&&!a)u=u.cloneRange(),h=t.getRangeBoundaryPosition(u,!o),u.setBoundary(e.node,e.offset,o),a=!0;else return!1}),pasteHtml:function(n){if(this.deleteContents(),n){var t=this.createContextualFragment(n),i=t.lastChild;this.insertNode(t);this.collapseAfter(i)}}});f(n.selectionPrototype,{expand:r(function(n,t,i){this.changeEachRange(function(n){n.expand(t,i)})}),move:r(function(n,t,i,r){var f=0,u;return this.focusNode&&(this.collapse(this.focusNode,this.focusOffset),u=this.getRangeAt(0),r||(r={}),r.characterOptions=a(r.characterOptions,rr),f=u.move(t,i,r),this.setSingleRange(u)),f}),trimStart:vt("trimStart"),trimEnd:vt("trimEnd"),trim:vt("trim"),selectCharacters:r(function(t,i,r,u,f,e){var o=n.createRange(i);o.selectCharacters(i,r,u,e);this.setSingleRange(o,f)}),saveCharacterRanges:r(function(n,t,i){for(var u=this.getAllRanges(),e=u.length,f=[],o=e==1&&this.isBackward(),r=0,s=u.length;r<s;++r)f[r]={characterRange:u[r].toCharacterRange(t,i),backward:o,characterOptions:i};return f}),restoreCharacterRanges:r(function(t,i,r){this.removeAllRanges();for(var f=0,s=r.length,e,u,o;f<s;++f)u=r[f],o=u.characterRange,e=n.createRange(i),e.selectCharacters(i,o.start,o.end,u.characterOptions),this.addRange(e,u.backward)}),text:r(function(n,t){for(var r=[],i=0,u=this.rangeCount;i<u;++i)r[i]=this.getRangeAt(i).text(t);return r.join("")})});n.innerText=function(t,i){var r=n.createRange(t);return r.selectNodeContents(t),r.text(i)};n.createWordIterator=function(n,t,i){var u=ht();i=w(i,or);var f=u.getPosition(n,t),r=k(f,i.characterOptions,i.wordOptions),e=tt(i.direction);return{next:function(){return e?r.previousStartToken():r.nextEndToken()},dispose:function(){r.dispose();this.next=function(){}}}};n.noMutation=function(n){var t=ht();n(t);ct()};n.noMutation.createEntryPointFunction=r;n.textRange={isBlockNode:cr,isCollapsedWhitespaceNode:ft,createPosition:r(function(n,t,i){return n.getPosition(t,i)})}});wysihtml.browser=function(){function o(n){return+(/ipad|iphone|ipod/.test(n)&&n.match(/ os (\d+).+? like mac os x/)||[undefined,0])[1]}function s(n){return+(n.match(/android (\d+)/)||[undefined,0])[1]}function n(n,t){var i=-1,r;return(navigator.appName=="Microsoft Internet Explorer"?r=new RegExp("MSIE ([0-9]{1,}[.0-9]{0,})"):navigator.appName=="Netscape"&&(navigator.userAgent.indexOf("Trident")>-1?r=new RegExp("Trident/.*rv:([0-9]{1,}[.0-9]{0,})"):/Edge\/(\d+)./i.test(navigator.userAgent)&&(r=/Edge\/(\d+)./i)),r&&r.exec(navigator.userAgent)!=null&&(i=parseFloat(RegExp.$1)),i===-1)?!1:n?t?t==="<"?n<i:t===">"?n>i:t==="<="?n<=i:t===">="?n>=i:void 0:n===i:!0}var t=navigator.userAgent,i=document.createElement("div"),u=t.indexOf("Gecko")!==-1&&t.indexOf("KHTML")===-1&&!n(),f=t.indexOf("AppleWebKit/")!==-1&&!n(),e=t.indexOf("Chrome/")!==-1&&!n(),r=t.indexOf("Opera/")!==-1&&!n();return{USER_AGENT:t,supported:function(){var n=this.USER_AGENT.toLowerCase(),t="contentEditable"in i,r=document.execCommand&&document.queryCommandSupported&&document.queryCommandState,u=document.querySelector&&document.querySelectorAll,f=this.isIos()&&o(n)<5||this.isAndroid()&&s(n)<4||n.indexOf("opera mobi")!==-1||n.indexOf("hpwos/")!==-1;return t&&r&&u&&!f},isTouchDevice:function(){return this.supportsEvent("touchmove")},isIos:function(){return/ipad|iphone|ipod/i.test(this.USER_AGENT)},isAndroid:function(){return this.USER_AGENT.indexOf("Android")!==-1},supportsSandboxedIframes:function(){return n()},throwsMixedContentWarningWhenIframeSrcIsEmpty:function(){return!("querySelector"in document)},displaysCaretInEmptyContentEditableCorrectly:function(){return n(12,">")},hasCurrentStyleProperty:function(){return"currentStyle"in i},insertsLineBreaksOnReturn:function(){return u},supportsPlaceholderAttributeOn:function(n){return"placeholder"in n},supportsEvent:function(n){return"on"+n in i||function(){return i.setAttribute("on"+n,"return;"),typeof i["on"+n]=="function"}()},supportsEventsInIframeCorrectly:function(){return!r},supportsHTML5Tags:function(n){var t=n.createElement("div"),i="<article>foo<\/article>";return t.innerHTML=i,t.innerHTML.toLowerCase()===i},supportsCommand:function(){var t={formatBlock:n(10,"<="),insertUnorderedList:n(),insertOrderedList:n()},i={insertHTML:u};return function(n,r){var u=t[r];if(!u){try{return n.queryCommandSupported(r)}catch(f){}try{return n.queryCommandEnabled(r)}catch(e){return!!i[r]}}return!1}}(),doesAutoLinkingInContentEditable:function(){return n()},canDisableAutoLinking:function(){return this.supportsCommand(document,"AutoUrlDetect")},clearsContentEditableCorrectly:function(){return u||r||f},supportsGetAttributeCorrectly:function(){var n=document.createElement("td");return n.getAttribute("rowspan")!="1"},canSelectImagesInContentEditable:function(){return u||n()||r},autoScrollsToCaret:function(){return!f},autoClosesUnclosedTags:function(){var r=i.cloneNode(!1),n,t;return r.innerHTML="<p><div><\/div>",t=r.innerHTML.toLowerCase(),n=t==="<p><\/p><div><\/div>"||t==="<p><div><\/div><\/p>",this.autoClosesUnclosedTags=function(){return n},n},supportsNativeGetElementsByClassName:function(){return String(document.getElementsByClassName).indexOf("[native code]")!==-1},supportsSelectionModify:function(){return"getSelection"in window&&"modify"in window.getSelection()},needsSpaceAfterLineBreak:function(){return r},supportsSpeechApiOn:function(n){var i=t.match(/Chrome\/(\d+)/)||[undefined,0];return i[1]>=11&&("onwebkitspeechchange"in n||"speech"in n)},crashesWhenDefineProperty:function(t){return n(9)&&(t==="XMLHttpRequest"||t==="XDomainRequest")},doesAsyncFocus:function(){return n(12,">")},hasProblemsSettingCaretAfterImg:function(){return n()},hasLiDeletingProblem:function(){return n()},hasUndoInContextMenu:function(){return u||e||r},hasInsertNodeIssue:function(){return r},hasIframeFocusIssue:function(){return n()},createsNestedInvalidMarkupAfterPaste:function(){return f},hasCaretBlockElementIssue:function(){return f},supportsMutationEvents:function(){return"MutationEvent"in window},supportsModernPaste:function(){return!n()},fixStyleKey:function(n){return n==="cssFloat"?"styleFloat"in document.createElement("div").style?"styleFloat":"cssFloat":n},usesControlRanges:function(){return document.body&&"createControlRange"in document.body},hasCaretAtLinkEndInsertionProblems:function(){return f}}}();wysihtml.lang.array=function(n){return{contains:function(t){if(Array.isArray(t)){for(var i=t.length;i--;)if(wysihtml.lang.array(n).indexOf(t[i])!==-1)return!0;return!1}return wysihtml.lang.array(n).indexOf(t)!==-1},indexOf:function(t){if(n.indexOf)return n.indexOf(t);for(var i=0,r=n.length;i<r;i++)if(n[i]===t)return i;return-1},without:function(t){t=wysihtml.lang.array(t);for(var r=[],i=0,u=n.length;i<u;i++)t.contains(n[i])||r.push(n[i]);return r},get:function(){for(var t=0,r=n.length,i=[];t<r;t++)i.push(n[t]);return i},map:function(t,i){if(Array.prototype.map)return n.map(t,i);for(var u=n.length>>>0,f=new Array(u),r=0;r<u;r++)f[r]=t.call(i,n[r],r,n);return f},unique:function(){for(var i=[],r=n.length,t=0;t<r;)wysihtml.lang.array(i).contains(n[t])||i.push(n[t]),t++;return i}}};wysihtml.lang.Dispatcher=Base.extend({on:function(n,t){return this.events=this.events||{},this.events[n]=this.events[n]||[],this.events[n].push(t),this},off:function(n,t){this.events=this.events||{};var i=0,r,u;if(n){for(r=this.events[n]||[],u=[];i<r.length;i++)r[i]!==t&&t&&u.push(r[i]);this.events[n]=u}else this.events={};return this},fire:function(n,t){this.events=this.events||{};for(var r=this.events[n]||[],i=0;i<r.length;i++)r[i].call(this,t);return this},observe:function(){return this.on.apply(this,arguments)},stopObserving:function(){return this.off.apply(this,arguments)}});wysihtml.lang.object=function(n){return{merge:function(t,i){for(var r in t)i&&wysihtml.lang.object(t[r]).isPlainObject()&&(typeof n[r]=="undefined"||wysihtml.lang.object(n[r]).isPlainObject())?typeof n[r]=="undefined"?n[r]=wysihtml.lang.object(t[r]).clone(!0):wysihtml.lang.object(n[r]).merge(wysihtml.lang.object(t[r]).clone(!0)):n[r]=wysihtml.lang.object(t[r]).isPlainObject()?wysihtml.lang.object(t[r]).clone(!0):t[r];return this},difference:function(t){var u={},i,r;for(i in n)n.hasOwnProperty(i)&&(t.hasOwnProperty(i)||(u[i]=n[i]));for(r in t)t.hasOwnProperty(r)&&(n.hasOwnProperty(r)&&n[r]===t[r]||(u[0]=n[0]));return u},get:function(){return n},clone:function(t){var r={},i;if(n===null||!wysihtml.lang.object(n).isPlainObject())return n;for(i in n)n.hasOwnProperty(i)&&(r[i]=t?wysihtml.lang.object(n[i]).clone(t):n[i]);return r},isArray:function(){return Object.prototype.toString.call(n)==="[object Array]"},isFunction:function(){return Object.prototype.toString.call(n)==="[object Function]"},isPlainObject:function(){return n&&Object.prototype.toString.call(n)==="[object Object]"&&!("Node"in window?n instanceof Node:n instanceof Element||n instanceof Text)},isEmpty:function(){for(var t in n)if(n.hasOwnProperty(t))return!1;return!0}}},function(){var n=/^\s+/,t=/\s+$/,i=/[&<>\t"]/g,r={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","\t":"&nbsp; "};wysihtml.lang.string=function(u){return u=String(u),{trim:function(){return u.replace(n,"").replace(t,"")},interpolate:function(n){for(var t in n)u=this.replace("#{"+t+"}").by(n[t]);return u},replace:function(n){return{by:function(t){return u.split(n).join(t)}}},escapeHTML:function(n,t){var f=u.replace(i,function(n){return r[n]});return n&&(f=f.replace(/(?:\r\n|\r|\n)/g,"<br />")),t&&(f=f.replace(/  /gi,"&nbsp; ")),f}}}}(),function(n){function o(n,t){return l(n,t)?n:(n===n.ownerDocument.documentElement&&(n=n.ownerDocument.body),f(n,t))}function s(n){return n.replace(t,function(n,t){var i=(t.match(r)||[])[1]||"",s=e[i],f,o;return t=t.replace(r,""),t.split(s).length>t.split(i).length&&(t=t+i,i=""),f=t,o=t,t.length>u&&(o=o.substr(0,u)+"..."),f.substr(0,4)==="www."&&(f="http://"+f),'<a href="'+f+'">'+o+"<\/a>"+i})}function h(n){var t=n._wysihtml_tempElement;return t||(t=n._wysihtml_tempElement=n.createElement("div")),t}function c(t){var r=t.parentNode,u=n.lang.string(t.data).escapeHTML(),i=h(r.ownerDocument);for(i.innerHTML="<span><\/span>"+s(u),i.removeChild(i.firstChild);i.firstChild;)r.insertBefore(i.firstChild,t);r.removeChild(t)}function l(t,r){for(var u;t.parentNode;){if((t=t.parentNode,u=t.nodeName,t.className&&n.lang.array(t.className.split(" ")).contains(r))||i.contains(u))return!0;if(u==="body")return!1}return!1}function f(r,u){if(!i.contains(r.nodeName)&&(!r.className||!n.lang.array(r.className.split(" ")).contains(u))){if(r.nodeType===n.TEXT_NODE&&r.data.match(t)){c(r);return}for(var o=n.lang.array(r.childNodes).get(),s=o.length,e=0;e<s;e++)f(o[e],u);return r}}var i=n.lang.array(["CODE","PRE","A","SCRIPT","HEAD","TITLE","STYLE"]),t=/((https?:\/\/|www\.)[^\s<]{3,})/gi,r=/([^\w\/\-](,?))$/i,u=100,e={")":"(","]":"[","}":"{"};n.dom.autoLink=o;n.dom.autoLink.URL_REG_EXP=t}(wysihtml),function(n){var t=n.dom;t.addClass=function(n,i){var r=n.classList;if(r)return r.add(i);t.hasClass(n,i)||(n.className+=" "+i)};t.removeClass=function(n,t){var i=n.classList;if(i)return i.remove(t);n.className=n.className.replace(new RegExp("(^|\\s+)"+t+"(\\s+|$)")," ")};t.hasClass=function(n,t){var r=n.classList,i;return r?r.contains(t):(i=n.className,i.length>0&&(i==t||new RegExp("(^|\\s)"+t+"(\\s|$)").test(i)))}}(wysihtml);wysihtml.dom.compareDocumentPosition=function(){var n=document.documentElement;return n.compareDocumentPosition?function(n,t){return n.compareDocumentPosition(t)}:function(n,t){var e,o,u;if(e=n.nodeType===9?n:n.ownerDocument,o=t.nodeType===9?t:t.ownerDocument,n===t)return 0;if(n===t.ownerDocument)return 20;if(n.ownerDocument===t)return 10;if(e!==o)return 1;if(n.nodeType===2&&n.childNodes&&wysihtml.lang.array(n.childNodes).indexOf(t)!==-1)return 20;if(t.nodeType===2&&t.childNodes&&wysihtml.lang.array(t.childNodes).indexOf(n)!==-1)return 10;for(var i=n,r=[],f=null;i;){if(i==t)return 10;r.push(i);i=i.parentNode}for(i=t,f=null;i;){if(i==n)return 20;if(u=wysihtml.lang.array(r).indexOf(i),u!==-1){var s=r[u],h=wysihtml.lang.array(s.childNodes).indexOf(r[u-1]),c=wysihtml.lang.array(s.childNodes).indexOf(f);return h>c?2:4}f=i;i=i.parentNode}return 1}}();wysihtml.dom.contains=function(){var n=document.documentElement;return n.contains?function(n,t){if(t.nodeType!==wysihtml.ELEMENT_NODE){if(t.parentNode===n)return!0;t=t.parentNode}return n!==t&&n.contains(t)}:n.compareDocumentPosition?function(n,t){return!!(n.compareDocumentPosition(t)&16)}:void 0}(),function(n){var t=document;n.dom.ContentEditableArea=Base.extend({getContentEditable:function(){return this.element},getWindow:function(){return this.element.ownerDocument.defaultView||this.element.ownerDocument.parentWindow},getDocument:function(){return this.element.ownerDocument},constructor:function(t,i,r){this.callback=t||n.EMPTY_FUNCTION;this.config=n.lang.object({}).merge(i).get();this.config.className||(this.config.className="wysihtml-sandbox");this.element=r?this._bindElement(r):this._createElement()},destroy:function(){},_createElement:function(){var n=t.createElement("div");return n.className=this.config.className,this._loadElement(n),n},_bindElement:function(n){return n.className=n.className?n.className+" wysihtml-sandbox":"wysihtml-sandbox",this._loadElement(n,!0),n},_loadElement:function(n,t){var i=this,r;t||(r=this._getHtml(),n.innerHTML=r);this.loaded=!0;setTimeout(function(){i.callback(i)},0)},_getHtml:function(){return""}})}(wysihtml);wysihtml.dom.convertToList=function(){function n(n,t){var i=n.createElement("li");return t.appendChild(i),i}function t(n,t){return n.createElement(t)}function i(i,r,u){if(i.nodeName==="UL"||i.nodeName==="OL"||i.nodeName==="MENU")return i;for(var l=i.ownerDocument,h=t(l,r),v=i.querySelectorAll("br"),b=v.length,a,y,o,s,c,p,w,f,e=0;e<b;e++)for(s=v[e];(c=s.parentNode)&&c!==i&&c.lastChild===s;){if(wysihtml.dom.getStyle("display").from(c)==="block"){c.removeChild(s);break}wysihtml.dom.insert(s).after(s.parentNode)}for(a=wysihtml.lang.array(i.childNodes).get(),y=a.length,e=0;e<y;e++){if(f=f||n(l,h),o=a[e],p=wysihtml.dom.getStyle("display").from(o)==="block",w=o.nodeName==="BR",p&&(!u||!wysihtml.dom.hasClass(o,u))){f=f.firstChild?n(l,h):f;f.appendChild(o);f=null;continue}if(w){f=f.firstChild?null:f;continue}f.appendChild(o)}return a.length===0&&n(l,h),i.parentNode.replaceChild(h,i),h}return i}();wysihtml.dom.copyAttributes=function(n){return{from:function(t){return{to:function i(r){for(var u,f=0,e=n.length;f<e;f++)u=n[f],typeof t[u]!="undefined"&&t[u]!==""&&(r[u]=t[u]);return{andTo:i}}}}}},function(n){var t=["-webkit-box-sizing","-moz-box-sizing","-ms-box-sizing","box-sizing"],i=function(t){return r(t)?parseInt(n.getStyle("width").from(t),10)<t.offsetWidth:!1},r=function(i){for(var r=0,u=t.length;r<u;r++)if(n.getStyle(t[r]).from(i)==="border-box")return t[r]};n.copyStyles=function(r){return{from:function(u){i(u)&&(r=wysihtml.lang.array(r).without(t));for(var o="",s=r.length,f=0,e;f<s;f++)e=r[f],o+=e+":"+n.getStyle(e).from(u)+";";return{to:function h(t){n.setStyles(o).on(t);return{andTo:h}}}}}}}(wysihtml.dom),function(n){n.dom.delegate=function(n,t,i,r){var u=function(i){for(var f=i.target,o=f.nodeType===3?f.parentNode:f,e=n.querySelectorAll(t),u=0,s=e.length;u<s;u++)e[u].contains(o)&&r.call(e[u],i)};return n.addEventListener(i,u,!1),{stop:function(){n.removeEventListener(i,u,!1)}}}}(wysihtml),function(n){function t(n,t){for(var r=[n],i=n;t&&i&&i!==t||!t&&i;)r.unshift(i),i=i.parentNode;return r}n.dom.domNode=function(i){var r=[n.ELEMENT_NODE,n.TEXT_NODE];return{is:{emptyTextNode:function(t){var r=t?/^\s*$/g:/^[\r\n]*$/g;return i&&i.nodeType===n.TEXT_NODE&&r.test(i.data)},rangyBookmark:function(){return i&&i.nodeType===1&&i.classList.contains("rangySelectionBoundary")},visible:function(){var t=!/^\s*$/g.test(n.dom.getTextContent(i));return t||i.nodeType===1&&i.querySelector("img, br, hr, object, embed, canvas, input, textarea")&&(t=!0),t},lineBreak:function(){return i&&i.nodeType===1&&i.nodeName==="BR"},block:function(){return i&&i.nodeType===1&&i.ownerDocument.defaultView.getComputedStyle(i).display==="block"},voidElement:function(){return n.dom.domNode(i).test({query:n.VOID_ELEMENTS})}},prev:function(t){var u=i.previousSibling,f=t&&t.nodeTypes?t.nodeTypes:r;return u?n.dom.domNode(u).is.rangyBookmark()||!n.lang.array(f).contains(u.nodeType)||t&&t.ignoreBlankTexts&&n.dom.domNode(u).is.emptyTextNode(!0)?n.dom.domNode(u).prev(t):u:null},next:function(t){var u=i.nextSibling,f=t&&t.nodeTypes?t.nodeTypes:r;return u?n.dom.domNode(u).is.rangyBookmark()||!n.lang.array(f).contains(u.nodeType)||t&&t.ignoreBlankTexts&&n.dom.domNode(u).is.emptyTextNode(!0)?n.dom.domNode(u).next(t):u:null},commonAncestor:function(n,r){var f=t(i,r),e=t(n,r),u;if(f[0]!=e[0])return null;for(u=0;u<f.length;u++)if(f[u]!=e[u])return f[u-1];return null},lastLeafNode:function(t){var r,u;if(i.nodeType!==1||(r=i.lastChild,!r))return i;if(t&&t.leafClasses)for(u=t.leafClasses.length;u--;)if(n.dom.hasClass(i,t.leafClasses[u]))return i;return n.dom.domNode(r).lastLeafNode(t)},escapeParent:function(t,r){var u,e,o,f=i;if(!n.dom.contains(t,i))throw new Error("Child is not a descendant of node.");do{for(u=f.parentNode,e=u.cloneNode(!1);u.lastChild&&u.lastChild!==f;)e.insertBefore(u.lastChild,e.firstChild);if(u!==t&&(o=u.cloneNode(!1),o.appendChild(f),f=o),u.parentNode.insertBefore(f,u.nextSibling),e.innerHTML!=="")if(/^\s+$/.test(e.innerHTML))while(e.lastChild)u.parentNode.insertBefore(e.lastChild,f.nextSibling);else u.parentNode.insertBefore(e,f.nextSibling);if(u.innerHTML==="")u.parentNode.removeChild(u);else if(/^\s+$/.test(u.innerHTML)){while(u.firstChild)u.parentNode.insertBefore(u.firstChild,u);u.parentNode.removeChild(u)}}while(u&&u!==t);r&&f&&(f.parentNode.insertBefore(r,f),r.appendChild(f))},transferContentTo:function(t,r){if(i.nodeType===1){if(n.dom.domNode(t).is.voidElement()||t.nodeType===3)while(i.lastChild)t.parentNode.insertBefore(i.lastChild,t.nextSibling);else while(i.firstChild)t.appendChild(i.firstChild);r&&i.parentNode.removeChild(i)}else(i.nodeType===3||i.nodeType===8)&&(n.dom.domNode(t).is.voidElement()?t.parentNode.insertBefore(i,t.nextSibling):t.appendChild(i))},test:function(t){var e,c,r,s,o,l,f;if(!t||i.nodeType!==1||t.query&&!i.matches(t.query)||t.nodeName&&i.nodeName.toLowerCase()!==t.nodeName.toLowerCase()||t.className&&!i.classList.contains(t.className)||t.classRegExp&&(c=(i.className||"").match(t.classRegExp)||[],c.length===0))return!1;if(t.styleProperty&&t.styleProperty.length>0)for(r=!1,s=Array.isArray(t.styleProperty)?t.styleProperty:[t.styleProperty],o=0,l=s.length;o<l;o++){if(e=n.browser.fixStyleKey(s[o]),i.style[e])if(t.styleValue){if(t.styleValue instanceof RegExp){if(i.style[e].trim().match(t.styleValue).length>0){r=!0;break}}else if(Array.isArray(t.styleValue)){if(t.styleValue.indexOf(i.style[e].trim())){r=!0;break}}else if(t.styleValue===i.style[e].trim().replace(/, /g,",")){r=!0;break}}else{r=!0;break}if(!r)return!1}if(t.attribute){var a=n.dom.getAttributes(i),u=[],h=!1;Array.isArray(t.attribute)?u=t.attribute:u[t.attribute]=t.attributeValue;for(f in u)if(u.hasOwnProperty(f))if(typeof u[f]=="undefined"){if(typeof a[f]!="undefined"){h=!0;break}}else if(a[f]===u[f]){h=!0;break}if(!h)return!1}return!0}}}}(wysihtml);wysihtml.dom.getAsDom=function(){var t=function(n,t){var i=t.createElement("div");i.style.display="none";t.body.appendChild(i);try{i.innerHTML=n}catch(r){}return t.body.removeChild(i),i},i=function(t){if(!t._wysihtml_supportsHTML5Tags){for(var i=0,r=n.length;i<r;i++)t.createElement(n[i]);t._wysihtml_supportsHTML5Tags=!0}},n=["abbr","article","aside","audio","bdi","canvas","command","datalist","details","figcaption","figure","footer","header","hgroup","keygen","mark","meter","nav","output","progress","rp","rt","ruby","svg","section","source","summary","time","track","video","wbr"];return function(n,r){r=r||document;var u;return typeof n=="object"&&n.nodeType?(u=r.createElement("div"),u.appendChild(n)):wysihtml.browser.supportsHTML5Tags(r)?(u=r.createElement("div"),u.innerHTML=n):(i(r),u=t(n,r)),u}}();wysihtml.dom.getAttribute=function(n,t){var f=!wysihtml.browser.supportsGetAttributeCorrectly(),i,r,u;return t=t.toLowerCase(),i=n.nodeName,i=="IMG"&&t=="src"&&wysihtml.dom.isLoadedImage(n)===!0?n.src:f&&"outerHTML"in n?(r=n.outerHTML.toLowerCase(),u=r.indexOf(" "+t+"=")!=-1,u?n.getAttribute(t):null):n.getAttribute(t)};wysihtml.dom.getAttributes=function(n){var r=!wysihtml.browser.supportsGetAttributeCorrectly(),u=n.nodeName,i=[];for(var t in n.attributes)(n.attributes.hasOwnProperty&&n.attributes.hasOwnProperty(t)||!n.attributes.hasOwnProperty&&Object.prototype.hasOwnProperty.call(n.attributes,t))&&n.attributes[t].specified&&(u=="IMG"&&n.attributes[t].name.toLowerCase()=="src"&&wysihtml.dom.isLoadedImage(n)===!0?i.src=n.src:wysihtml.lang.array(["rowspan","colspan"]).contains(n.attributes[t].name.toLowerCase())&&r?n.attributes[t].value!==1&&(i[n.attributes[t].name]=n.attributes[t].value):i[n.attributes[t].name]=n.attributes[t].value);return i};wysihtml.dom.getParentElement=function(){return function(n,t,i,r){for(i=i||50;i--&&n&&n.nodeName!=="BODY"&&(!r||n!==r);){if(wysihtml.dom.domNode(n).test(t))return n;n=n.parentNode}return null}}();wysihtml.dom.getPastedHtml=function(n){var t;return wysihtml.browser.supportsModernPaste()&&n.clipboardData&&(wysihtml.lang.array(n.clipboardData.types).contains("text/html")?t=n.clipboardData.getData("text/html"):wysihtml.lang.array(n.clipboardData.types).contains("text/plain")&&(t=wysihtml.lang.string(n.clipboardData.getData("text/plain")).escapeHTML(!0,!0))),t};wysihtml.dom.getPastedHtmlWithDiv=function(n,t){var f=n.selection.getBookmark(),r=n.element.ownerDocument,i=r.createElement("DIV"),u=n.getScrollPos();r.body.appendChild(i);i.style.width="1px";i.style.height="1px";i.style.overflow="hidden";i.style.position="absolute";i.style.top=u.y+"px";i.style.left=u.x+"px";i.setAttribute("contenteditable","true");i.focus();setTimeout(function(){var r;n.selection.setBookmark(f);r=i.innerHTML;r&&/^<br\/?>$/i.test(r.trim())&&(r=!1);t(r);i.parentNode.removeChild(i)},0)};wysihtml.dom.getStyle=function(){function i(n){return n.replace(t,function(n){return n.charAt(1).toUpperCase()})}var n={float:"styleFloat"in document.createElement("div").style?"styleFloat":"cssFloat"},t=/\-[a-z]/g;return function(t){return{from:function(r){var f,e,l,a;if(r.nodeType===wysihtml.ELEMENT_NODE){var o=r.ownerDocument,s=n[t]||i(t),u=r.style,h=r.currentStyle,c=u[s];if(c)return c;if(h)try{return h[s]}catch(v){}return f=o.defaultView||o.parentWindow,e=(t==="height"||t==="width")&&r.nodeName==="TEXTAREA",f.getComputedStyle?(e&&(l=u.overflow,u.overflow="hidden"),a=f.getComputedStyle(r,null).getPropertyValue(t),e&&(u.overflow=l||""),a):void 0}}}}}();wysihtml.dom.getTextNodes=function(n,t){var i=[];for(n=n.firstChild;n;n=n.nextSibling)n.nodeType==3?t&&/^\s*$/.test(n.innerText||n.textContent)||i.push(n):i=i.concat(wysihtml.dom.getTextNodes(n,t));return i},function(n){function r(n){return n._wysihtml_identifier||(n._wysihtml_identifier=i++)}var t={},i=1;n.dom.hasElementWithClassName=function(i,u){if(!n.browser.supportsNativeGetElementsByClassName())return!!i.querySelector("."+u);var e=r(i)+":"+u,f=t[e];return f||(f=t[e]=i.getElementsByClassName(u)),f.length>0}}(wysihtml);wysihtml.dom.hasElementWithTagName=function(){function i(n){return n._wysihtml_identifier||(n._wysihtml_identifier=t++)}var n={},t=1;return function(t,r){var f=i(t)+":"+r,u=n[f];return u||(u=n[f]=t.getElementsByTagName(r)),u.length>0}}();wysihtml.dom.insert=function(n){return{after:function(t){t.parentNode.insertBefore(n,t.nextSibling)},before:function(t){t.parentNode.insertBefore(n,t)},into:function(t){t.appendChild(n)}}};wysihtml.dom.insertCSS=function(n){return n=n.join("\n"),{into:function(t){var i=t.createElement("style"),r,u;if(i.type="text/css",i.styleSheet?i.styleSheet.cssText=n:i.appendChild(t.createTextNode(n)),r=t.querySelector("head link"),r){r.parentNode.insertBefore(i,r);return}u=t.querySelector("head");u&&u.appendChild(i)}}};wysihtml.dom.isLoadedImage=function(n){try{return n.complete&&!n.mozMatchesSelector(":-moz-broken")}catch(t){if(n.complete&&n.readyState==="complete")return!0}},function(n){n.dom.lineBreaks=function(t){function i(n){return n.nodeName==="BR"}function r(t){return i(t)?!0:n.dom.getStyle("display").from(t)==="block"?!0:!1}return{add:function(){var i=t.ownerDocument,u=n.dom.domNode(t).next({ignoreBlankTexts:!0}),f=n.dom.domNode(t).prev({ignoreBlankTexts:!0});u&&!r(u)&&n.dom.insert(i.createElement("br")).after(t);f&&!r(f)&&n.dom.insert(i.createElement("br")).before(t)},remove:function(){var r=n.dom.domNode(t).next({ignoreBlankTexts:!0}),u=n.dom.domNode(t).prev({ignoreBlankTexts:!0});r&&i(r)&&r.parentNode.removeChild(r);u&&i(u)&&u.parentNode.removeChild(u)}}}}(wysihtml);wysihtml.dom.observe=function(n,t,i){t=typeof t=="string"?[t]:t;for(var r,u,f=0,e=t.length;f<e;f++)u=t[f],n.addEventListener?n.addEventListener(u,i,!1):(r=function(t){"target"in t||(t.target=t.srcElement);t.preventDefault=t.preventDefault||function(){this.returnValue=!1};t.stopPropagation=t.stopPropagation||function(){this.cancelBubble=!0};i.call(n,t)},n.attachEvent("on"+u,r));return{stop:function(){for(var u,f=0,e=t.length;f<e;f++)u=t[f],n.removeEventListener?n.removeEventListener(u,i,!1):n.detachEvent("on"+u,r)}}};wysihtml.dom.parse=function(n,t){function a(n,t){var o,s;wysihtml.lang.object(i).merge(c).merge(t.rules).get();var l=t.context||n.ownerDocument||document,h=l.createDocumentFragment(),a=typeof n=="string",y=!1,r,u,e;for(t.clearInternals===!0&&(y=!0),r=a?wysihtml.dom.getAsDom(n,l):n,i.selectors&&v(r,i.selectors);r.firstChild;)e=r.firstChild,u=f(e,t.cleanUp,y,t.uneditableClass),u&&h.appendChild(u),e!==u&&r.removeChild(e);if(t.unjoinNbsps)for(o=wysihtml.dom.getTextNodes(h),s=o.length;s--;)o[s].nodeValue=o[s].nodeValue.replace(/([\S\u00A0])\u00A0/gi,"$1 ");return r.innerHTML="",r.appendChild(h),a?wysihtml.quirks.getCorrectInnerHTML(r):r}function f(n,t,i,u){var y=n.nodeType,a=n.childNodes,p=a.length,w=h[y],o=0,s,e,c,v;if(u&&y===1&&wysihtml.dom.hasClass(n,u))return n;if(e=w&&w(n,i),!e){if(e===!1){for(s=n.ownerDocument.createDocumentFragment(),o=p;o--;)a[o]&&(c=f(a[o],t,i,u),c&&(a[o]===c&&o--,s.insertBefore(c,s.firstChild)));return v=wysihtml.dom.getStyle("display").from(n),v===""&&(v=wysihtml.lang.array(l).contains(n.tagName)?"block":""),wysihtml.lang.array(["block","flex","table"]).contains(v)&&s.appendChild(n.ownerDocument.createElement("br")),wysihtml.lang.array(["div","pre","p","table","td","th","ul","ol","li","dd","dl","footer","header","section","h1","h2","h3","h4","h5","h6"]).contains(n.nodeName.toLowerCase())&&n.parentNode.lastChild!==n&&(n.nextSibling&&n.nextSibling.nodeType===3&&/^\s/.test(n.nextSibling.nodeValue)||s.appendChild(n.ownerDocument.createTextNode(" "))),s.normalize&&s.normalize(),s}return null}for(o=0;o<p;o++)a[o]&&(c=f(a[o],t,i,u),c&&(a[o]===c&&o--,e.appendChild(c)));if(t&&e.nodeName.toLowerCase()===r&&(!e.childNodes.length||/^\s*$/gi.test(e.innerHTML)&&(i||n.className!=="_wysihtml-temp-placeholder"&&n.className!=="rangySelectionBoundary")||!e.attributes.length)){for(s=e.ownerDocument.createDocumentFragment();e.firstChild;)s.appendChild(e.firstChild);return s.normalize&&s.normalize(),s}return e.normalize&&e.normalize(),e}function v(n,t){var i,r,u,f;for(i in t)if(t.hasOwnProperty(i))for(wysihtml.lang.object(t[i]).isFunction()?r=t[i]:typeof t[i]=="string"&&s[t[i]]&&(r=s[t[i]]),u=n.querySelectorAll(i),f=u.length;f--;)r(u[f])}function y(n,t){var u,f,s=i.tags,e=n.nodeName.toLowerCase(),o=n.scopeName,h;if(n._wysihtml||(n._wysihtml=1,n.className==="wysihtml-temp"))return null;if(o&&o!="HTML"&&(e=o+":"+e),"outerHTML"in n&&(wysihtml.browser.autoClosesUnclosedTags()||n.nodeName!=="P"||n.outerHTML.slice(-4).toLowerCase()==="<\/p>"||(e="div")),e in s){if(u=s[e],!u||u.remove)return null;if(u.unwrap)return!1;u=typeof u=="string"?{rename_tag:u}:u}else if(n.firstChild)u={rename_tag:r};else return null;if(u.one_of_type&&!p(n,i,u.one_of_type,t))if(u.remove_action){if(u.remove_action==="unwrap")return!1;if(u.remove_action==="rename")h=u.remove_action_rename_to||r;else return null}else return null;return f=n.ownerDocument.createElement(h||u.rename_tag||e),g(n,f,u,t),b(n,f,u),n=null,f.normalize&&f.normalize(),f}function p(n,t,i,r){var f,u;if(n.nodeName==="SPAN"&&!r&&(n.className==="_wysihtml-temp-placeholder"||n.className==="rangySelectionBoundary"))return!0;for(u in i)if(i.hasOwnProperty(u)&&t.type_definitions&&t.type_definitions[u]&&(f=t.type_definitions[u],w(n,f)))return!0;return!1}function w(n,t){var r=n.getAttribute("class"),f=n.getAttribute("style"),v,i,e,c,l,s,h,a;if(t.methods)for(s in t.methods)if(t.methods.hasOwnProperty(s)&&o[s]&&o[s](n))return!0;if(r&&t.classes)for(r=r.replace(/^\s+/g,"").replace(/\s+$/g,"").split(u),v=r.length,h=0;h<v;h++)if(t.classes[r[h]])return!0;if(f&&t.styles){f=f.split(";");for(i in t.styles)if(t.styles.hasOwnProperty(i))for(a=f.length;a--;)if(l=f[a].split(":"),l[0].replace(/\s/g,"").toLowerCase()===i&&(t.styles[i]===!0||t.styles[i]===1||wysihtml.lang.array(t.styles[i]).contains(l[1].replace(/\s/g,"").toLowerCase())))return!0}if(t.attrs)for(e in t.attrs)if(t.attrs.hasOwnProperty(e)&&(c=wysihtml.dom.getAttribute(n,e),typeof c=="string"&&c.search(t.attrs[e])>-1))return!0;return!1}function b(n,t,i){var r,u;if(i&&i.keep_styles)for(r in i.keep_styles)if(i.keep_styles.hasOwnProperty(r)){if(u=r==="float"?n.style.styleFloat||n.style.cssFloat:n.style[r],i.keep_styles[r]instanceof RegExp&&!i.keep_styles[r].test(u))continue;r==="float"?t.style[n.style.styleFloat?"styleFloat":"cssFloat"]=u:n.style[r]&&(t.style[r]=u)}}function k(n,t){var r=[];for(var i in t)t.hasOwnProperty(i)&&i.indexOf(n)===0&&r.push(i);return r}function e(n,t,i,r){var f=wysihtml.lang.object(i).isFunction()?i:it[i],u;return f&&(u=f(t,r),typeof u=="string")?u:!1}function d(n,t){var a=wysihtml.lang.object(i.attributes||{}).clone(),s=wysihtml.lang.object(a).merge(wysihtml.lang.object(t||{}).clone()).get(),h={},c=wysihtml.dom.getAttributes(n),r,u,o,f,l;for(r in s)if(/\*$/.test(r))for(o=k(r.slice(0,-1),c),f=0,l=o.length;f<l;f++)u=e(o[f],c[o[f]],s[r],n.nodeName),u!==!1&&(h[o[f]]=u);else u=e(r,c[r],s[r],n.nodeName),u!==!1&&(h[r]=u);return h}function g(n,t,r,f){var e={},nt=r.set_class,w=r.add_class,b=r.add_style,tt=r.set_attributes,h=i.classes,c=0,o=[],k=[],l=[],a=[],p,v,g,s,y;if(tt&&(e=wysihtml.lang.object(tt).clone()),e=wysihtml.lang.object(e).merge(d(n,r.check_attributes)).get(),nt&&o.push(nt),w)for(s in w)(y=ut[w[s]],y)&&(g=y(wysihtml.dom.getAttribute(n,s)),typeof g=="string"&&o.push(g));if(b)for(s in b)(y=rt[b[s]],y)&&(newStyle=y(wysihtml.dom.getAttribute(n,s)),typeof newStyle=="string"&&k.push(newStyle));if(typeof h=="string"&&h==="any")if(n.getAttribute("class"))if(i.classes_blacklist){for(a=n.getAttribute("class"),a&&(o=o.concat(a.split(u))),p=o.length;c<p;c++)v=o[c],i.classes_blacklist[v]||l.push(v);l.length&&(e["class"]=wysihtml.lang.array(l).unique().join(" "))}else e["class"]=n.getAttribute("class");else o&&o.length>0&&(e["class"]=wysihtml.lang.array(o).unique().join(" "));else{for(f||(h["_wysihtml-temp-placeholder"]=1,h._rangySelectionBoundary=1,h["wysiwyg-tmp-selected-cell"]=1),a=n.getAttribute("class"),a&&(o=o.concat(a.split(u))),p=o.length;c<p;c++)v=o[c],h[v]&&l.push(v);l.length&&(e["class"]=wysihtml.lang.array(l).unique().join(" "))}e["class"]&&f&&(e["class"]=e["class"].replace("wysiwyg-tmp-selected-cell",""),/^\s*$/g.test(e["class"])&&delete e["class"]);k.length&&(e.style=wysihtml.lang.array(k).unique().join(" "));for(s in e)try{t.setAttribute(s,e[s])}catch(it){}e.src&&(typeof e.width!="undefined"&&t.setAttribute("width",e.width),typeof e.height!="undefined"&&t.setAttribute("height",e.height))}function nt(n){var t=n.nextSibling,i;if(t&&t.nodeType===wysihtml.TEXT_NODE)t.data=n.data.replace(wysihtml.INVISIBLE_SPACE_REG_EXP,"")+t.data.replace(wysihtml.INVISIBLE_SPACE_REG_EXP,"");else return i=n.data.replace(wysihtml.INVISIBLE_SPACE_REG_EXP,""),n.ownerDocument.createTextNode(i)}function tt(n){if(i.comments)return n.ownerDocument.createComment(n.nodeValue)}var h={"1":y,"3":nt,"8":tt},r="span",u=/\s+/,c={tags:{},classes:{}},i={},l=["ADDRESS","BLOCKQUOTE","CENTER","DIR","DIV","DL","FIELDSET","FORM","H1","H2","H3","H4","H5","H6","ISINDEX","MENU","NOFRAMES","NOSCRIPT","OL","P","PRE","TABLE","UL"],it={url:function(){var n=/^https?:\/\//i;return function(t){return!t||!t.match(n)?null:t.replace(n,function(n){return n.toLowerCase()})}}(),src:function(){var n=/^(\/|https?:\/\/)/i;return function(t){return!t||!t.match(n)?null:t.replace(n,function(n){return n.toLowerCase()})}}(),href:function(){var n=/^(#|\/|https?:\/\/|mailto:|tel:)/i;return function(t){return!t||!t.match(n)?null:t.replace(n,function(n){return n.toLowerCase()})}}(),alt:function(){var n=/[^ a-z0-9_\-]/gi;return function(t,i){return t?t.replace(n,""):i==="IMG"?"":null}}(),numbers:function(){var n=/\D/g;return function(t){return t=(t||"").replace(n,""),t||null}}(),dimension:function(){var n=/\D*(\d+)(\.\d+)?\s?(%)?\D*/;return function(t){return t=(t||"").replace(n,"$1$2$3"),t||null}}(),any:function(){return function(n){return n?n:null}}()},rt={align_text:function(){var n={left:"text-align: left;",right:"text-align: right;",center:"text-align: center;"};return function(t){return n[String(t).toLowerCase()]}}()},ut={align_img:function(){var n={left:"wysiwyg-float-left",right:"wysiwyg-float-right"};return function(t){return n[String(t).toLowerCase()]}}(),align_text:function(){var n={left:"wysiwyg-text-align-left",right:"wysiwyg-text-align-right",center:"wysiwyg-text-align-center",justify:"wysiwyg-text-align-justify"};return function(t){return n[String(t).toLowerCase()]}}(),clear_br:function(){var n={left:"wysiwyg-clear-left",right:"wysiwyg-clear-right",both:"wysiwyg-clear-both",all:"wysiwyg-clear-both"};return function(t){return n[String(t).toLowerCase()]}}(),size_font:function(){var n={"1":"wysiwyg-font-size-xx-small","2":"wysiwyg-font-size-small","3":"wysiwyg-font-size-medium","4":"wysiwyg-font-size-large","5":"wysiwyg-font-size-x-large","6":"wysiwyg-font-size-xx-large","7":"wysiwyg-font-size-xx-large","-":"wysiwyg-font-size-smaller","+":"wysiwyg-font-size-larger"};return function(t){return n[String(t).charAt(0)]}}()},o={has_visible_contet:function(){var n,t=["img","video","picture","br","script","noscript","style","table","iframe","object","embed","audio","svg","input","button","select","textarea","canvas"];return function(i){if(n=(i.innerText||i.textContent).replace(/\s/g,""),n&&n.length>0)return!0;for(var r=t.length;r--;)if(i.querySelector(t[r]))return!0;return i.offsetWidth&&i.offsetWidth>0&&i.offsetHeight&&i.offsetHeight>0?!0:!1}}()},s={unwrap:function(n){wysihtml.dom.unwrap(n)},remove:function(n){n.parentNode.removeChild(n)}};return a(n,t)};wysihtml.dom.query=function(n,t){var f=[],i,r,e,u;for(n.nodeType&&(n=[n]),r=0,e=n.length;r<e;r++)if(i=n[r].querySelectorAll(t),i)for(u=i.length;u--;f.unshift(i[u]));return f};wysihtml.dom.removeEmptyTextNodes=function(n){for(var t,r=wysihtml.lang.array(n.childNodes).get(),u=r.length,i=0;i<u;i++)t=r[i],t.nodeType===wysihtml.TEXT_NODE&&/^[\n\r]*$/.test(t.data)&&t.parentNode.removeChild(t)};wysihtml.dom.removeInvisibleSpaces=function(n){for(var t=wysihtml.dom.getTextNodes(n),i=t.length;i--;)t[i].nodeValue=t[i].nodeValue.replace(wysihtml.INVISIBLE_SPACE_REG_EXP,"")};wysihtml.dom.renameElement=function(n,t){for(var i=n.ownerDocument.createElement(t),r;r=n.firstChild;)i.appendChild(r);return wysihtml.dom.copyAttributes(["align","className"]).from(n).to(i),n.parentNode&&n.parentNode.replaceChild(i,n),i};wysihtml.dom.replaceWithChildNodes=function(n){if(n.parentNode){while(n.firstChild)n.parentNode.insertBefore(n.firstChild,n);n.parentNode.removeChild(n)}},function(n){function t(t){return n.getStyle("display").from(t)==="block"}function i(n){return n.nodeName==="BR"}function r(n){var t=n.ownerDocument.createElement("br");n.appendChild(t)}function u(n,u){if(n.nodeName.match(/^(MENU|UL|OL)$/)){var c=n.ownerDocument,o=c.createDocumentFragment(),s=wysihtml.dom.domNode(n).prev({ignoreBlankTexts:!0}),l=wysihtml.dom.domNode(n).next({ignoreBlankTexts:!0}),e,a,v,y,h,f,w=n.lastElementChild||n.lastChild,p;if(u)for(!s||t(s)||i(s)||r(o);f=n.firstElementChild||n.firstChild;){for(a=f.lastChild,p=f===w;e=f.firstChild;)v=e===a,y=(!p||l&&!t(l))&&v&&!t(e)&&!i(e),o.appendChild(e),y&&r(o);f.parentNode.removeChild(f)}else while(f=n.firstElementChild||n.firstChild){if(f.querySelector&&f.querySelector("div, p, ul, ol, menu, blockquote, h1, h2, h3, h4, h5, h6"))while(e=f.firstChild)o.appendChild(e);else{for(h=c.createElement("p");e=f.firstChild;)h.appendChild(e);o.appendChild(h)}f.parentNode.removeChild(f)}n.parentNode.replaceChild(o,n)}}n.resolveList=u}(wysihtml.dom),function(n){var t=document,i=["parent","top","opener","frameElement","frames","localStorage","globalStorage","sessionStorage","indexedDB"],r=["open","close","openDialog","showModalDialog","alert","confirm","prompt","openDatabase","postMessage","XMLHttpRequest","XDomainRequest"],u=["referrer","write","open","close"];n.dom.Sandbox=Base.extend({constructor:function(t,i){this.callback=t||n.EMPTY_FUNCTION;this.config=n.lang.object({}).merge(i).get();this.config.className||(this.config.className="wysihtml-sandbox");this.editableArea=this._createIframe()},insertInto:function(n){typeof n=="string"&&(n=t.getElementById(n));n.appendChild(this.editableArea)},getIframe:function(){return this.editableArea},getWindow:function(){this._readyError()},getDocument:function(){this._readyError()},destroy:function(){var n=this.getIframe();n.parentNode.removeChild(n)},_readyError:function(){throw new Error("wysihtml.Sandbox: Sandbox iframe isn't loaded yet");},_createIframe:function(){var r=this,i=t.createElement("iframe");i.className=this.config.className;n.dom.setAttributes({security:"restricted",allowtransparency:"true",frameborder:0,width:0,height:0,marginwidth:0,marginheight:0}).on(i);return n.browser.throwsMixedContentWarningWhenIframeSrcIsEmpty()&&(i.src="javascript:'<html><\/html>'"),i.onload=function(){i.onreadystatechange=i.onload=null;r._onLoadIframe(i)},i.onreadystatechange=function(){/loaded|complete/.test(i.readyState)&&(i.onreadystatechange=i.onload=null,r._onLoadIframe(i))},i},_onLoadIframe:function(f){var e,s;if(n.dom.contains(t.documentElement,f)){var c=this,h=f.contentWindow,o=f.contentWindow.document,l=t.characterSet||t.charset||"utf-8",a=this._getHtml({charset:l,stylesheets:this.config.stylesheets});if(o.open("text/html","replace"),o.write(a),o.close(),this.getWindow=function(){return f.contentWindow},this.getDocument=function(){return f.contentWindow.document},h.onerror=function(n,t,i){throw new Error("wysihtml.Sandbox: "+n,t,i);},!n.browser.supportsSandboxedIframes()){for(e=0,s=i.length;e<s;e++)this._unset(h,i[e]);for(e=0,s=r.length;e<s;e++)this._unset(h,r[e],n.EMPTY_FUNCTION);for(e=0,s=u.length;e<s;e++)this._unset(o,u[e]);this._unset(o,"cookie","",!0)}n.polyfills&&n.polyfills(h,o).apply();this.loaded=!0;setTimeout(function(){c.callback(c)},0)}},_getHtml:function(t){var i=t.stylesheets,u="",r=0,f;if(i=typeof i=="string"?[i]:i,i)for(f=i.length;r<f;r++)u+='<link rel="stylesheet" href="'+i[r]+'">';return t.stylesheets=u,n.lang.string('<!DOCTYPE html><html><head><meta charset="#{charset}">#{stylesheets}<\/head><body><\/body><\/html>').interpolate(t)},_unset:function(t,i,r,u){try{t[i]=r}catch(e){}try{t.__defineGetter__(i,function(){return r})}catch(e){}if(u)try{t.__defineSetter__(i,function(){})}catch(e){}if(!n.browser.crashesWhenDefineProperty(i))try{var f={get:function(){return r}};u&&(f.set=function(){});Object.defineProperty(t,i,f)}catch(e){}}})}(wysihtml),function(){var n={className:"class"};wysihtml.dom.setAttributes=function(t){return{on:function(i){for(var r in t)i.setAttribute(n[r]||r,t[r])}}}}();wysihtml.dom.setStyles=function(n){return{on:function(t){var r=t.style,i;if(typeof n=="string"){r.cssText+=";"+n;return}for(i in n)i==="float"?(r.cssFloat=n[i],r.styleFloat=n[i]):r[i]=n[i]}}},function(n){n.simulatePlaceholder=function(t,i,r,u){var o=u||"wysihtml-placeholder",f=function(){var t=i.element.offsetWidth>0&&i.element.offsetHeight>0;i.hasPlaceholderSet()&&(i.clear(),i.element.focus(),t&&setTimeout(function(){var n=i.selection.getSelection();n.focusNode&&n.anchorNode||i.selection.selectNode(i.element.firstChild||i.element)},0));i.placeholderSet=!1;n.removeClass(i.element,o)},e=function(){i.isEmpty()&&!i.placeholderSet&&(i.placeholderSet=!0,i.setValue(r,!1),n.addClass(i.element,o))};t.on("set_placeholder",e).on("unset_placeholder",f).on("focus:composer",f).on("paste:composer",f).on("blur:composer",e);e()}}(wysihtml.dom),function(n){var t=document.documentElement;"textContent"in t?(n.setTextContent=function(n,t){n.textContent=t},n.getTextContent=function(n){return n.textContent}):"innerText"in t?(n.setTextContent=function(n,t){n.innerText=t},n.getTextContent=function(n){return n.innerText}):(n.setTextContent=function(n,t){n.nodeValue=t},n.getTextContent=function(n){return n.nodeValue})}(wysihtml.dom);wysihtml.dom.unwrap=function(n){var t=[];if(n.parentNode){while(n.lastChild)t.unshift(n.lastChild),wysihtml.dom.insert(n.lastChild).after(n);n.parentNode.removeChild(n)}return t};wysihtml.quirks.cleanPastedHTML=function(){var n=function(n){var t=wysihtml.lang.string(n).trim(),i=t.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&");return new RegExp("^((?!^"+i+"$).)*$","i")},t=function(t,i){var r=wysihtml.lang.object(t).clone(!0),u,f;for(u in r.tags)if(r.tags.hasOwnProperty(u)&&r.tags[u].keep_styles)for(f in r.tags[u].keep_styles)r.tags[u].keep_styles.hasOwnProperty(f)&&i[f]&&(r.tags[u].keep_styles[f]=n(i[f]));return r},i=function(n,t){var r,i,u;if(!n)return null;for(i=0,u=n.length;i<u;i++)if(n[i].condition||(r=n[i].set),n[i].condition&&n[i].condition.test(t))return n[i].set;return r};return function(n,r){var u={color:wysihtml.dom.getStyle("color").from(r.referenceNode),fontSize:wysihtml.dom.getStyle("font-size").from(r.referenceNode)},f=t(i(r.rules,n)||{},u);return wysihtml.dom.parse(n,{rules:f,cleanUp:!0,context:r.referenceNode.ownerDocument,uneditableClass:r.uneditableClass,clearInternals:!0,unjoinNbsps:!0})}}();wysihtml.quirks.ensureProperClearing=function(){var n=function(){var n=this;setTimeout(function(){var t=n.innerHTML.toLowerCase();(t=="<p>&nbsp;<\/p>"||t=="<p>&nbsp;<\/p><p>&nbsp;<\/p>")&&(n.innerHTML="")},0)};return function(t){wysihtml.dom.observe(t.element,["cut","keydown"],n)}}(),function(n){var t="%7E";n.quirks.getCorrectInnerHTML=function(i){var r=i.innerHTML,f,e,o,s,u;if(r.indexOf(t)===-1)return r;for(f=i.querySelectorAll("[href*='~'], [src*='~']"),u=0,s=f.length;u<s;u++)e=f[u].href||f[u].src,o=n.lang.string(e).replace("~").by(t),r=n.lang.string(r).replace(o).by(e);return r}}(wysihtml),function(n){var t="wysihtml-quirks-redraw";n.quirks.redraw=function(i){n.dom.addClass(i,t);n.dom.removeClass(i,t);try{var r=i.ownerDocument;r.execCommand("italic",!1,null);r.execCommand("italic",!1,null)}catch(u){}}}(wysihtml),function(n){function i(n){var i,r;for(i in t)if(t.hasOwnProperty(i)&&(r=t[i],r.regex.test(n)))return r}function u(n){var t=i(n);return t?t.name:undefined}var t={rgba:{regex:/^rgba\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*([\d\.]+)\s*\)/i,name:"rgba"},rgb:{regex:/^rgb\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*\)/i,name:"rgb"},hex6:{regex:/^#([0-9a-f][0-9a-f])([0-9a-f][0-9a-f])([0-9a-f][0-9a-f])/i,name:"hex",radix:16},hex3:{regex:/^#([0-9a-f])([0-9a-f])([0-9a-f])/i,name:"hex",radix:16}},r=function(n){return new RegExp("(^|\\s|;)"+n+"\\s*:\\s*[^;$]+","gi")};n.quirks.styleParser={getColorParseMethod:i,getColorFormat:u,parseColor:function(u,f){var l,s,h,e,o,c=u;if(f){if(l=r(f),!(s=u.match(l)))return!1;s=s.pop().split(":")[1];c=n.lang.string(s).trim()}return(h=i(c))?(e=c.match(h.regex))?(o=h.radix||10,h===t.hex3)?(e.shift(),e.push(1),n.lang.array(e).map(function(n,t){return t<3?parseInt(n,o)*o+parseInt(n,o):parseFloat(n)})):(e.shift(),e[3]||e.push(1),n.lang.array(e).map(function(n,t){return t<3?parseInt(n,o):parseFloat(n)})):!1:!1},unparseColor:function(n,t){var i=16;return t==="hex"?(n[0].toString(i)+n[1].toString(i)+n[2].toString(i)).toUpperCase():t==="hash"?"#"+(n[0].toString(i)+n[1].toString(i)+n[2].toString(i)).toUpperCase():t==="rgb"?"rgb("+n[0]+","+n[1]+","+n[2]+")":t==="rgba"?"rgba("+n[0]+","+n[1]+","+n[2]+","+n[3]+")":t==="csv"?n[0]+","+n[1]+","+n[2]+","+n[3]:n[3]&&n[3]!==1?"rgba("+n[0]+","+n[1]+","+n[2]+","+n[3]+")":"rgb("+n[0]+","+n[1]+","+n[2]+")"},parseFontSize:function(t){var i=t.match(r("font-size"));return i?n.lang.string(i[i.length-1].split(":")[1]).trim():!1}}}(wysihtml),function(n){function f(n){var t=0;if(n.parentNode)do t+=n.offsetTop||0,n=n.offsetParent;while(n);return t}function i(n,t){for(var i=0;t!==n;)if(i++,t=t.parentNode,!t)throw new Error("not a descendant of ancestor!");return i}function r(n,t){return n.nodeType===3?n:n.childNodes[t]||n}function u(t){var i=document.createElement("span"),r=function(){t.removeEventListener("mouseup",r);t.removeEventListener("keydown",r);t.removeEventListener("touchstart",r);t.removeEventListener("focus",r);t.removeEventListener("blur",r);t.removeEventListener("paste",u);t.removeEventListener("drop",u);t.removeEventListener("beforepaste",u);i&&i.parentNode&&i.parentNode.removeChild(i)},u=function(){i&&i.parentNode&&setTimeout(r,0)};return i.appendChild(t.ownerDocument.createTextNode(n.INVISIBLE_SPACE)),i.className="_wysihtml-temp-caret-fix",i.style.display="block",i.style.minWidth="1px",i.style.height="0px",t.addEventListener("mouseup",r),t.addEventListener("keydown",r),t.addEventListener("touchstart",r),t.addEventListener("focus",r),t.addEventListener("blur",r),t.addEventListener("paste",u),t.addEventListener("drop",u),t.addEventListener("beforepaste",u),i}function e(n){if(!n.canSurroundContents())for(var t=n.commonAncestorContainer,r=i(t,n.startContainer),u=i(t,n.endContainer);!n.canSurroundContents();)r>u?(n.setStartBefore(n.startContainer),r=i(t,n.startContainer)):(n.setEndAfter(n.endContainer),u=i(t,n.endContainer))}var t=n.dom;n.Selection=Base.extend({constructor:function(n,t,i){rangy.init();this.editor=n;this.composer=n.composer;this.doc=this.composer.doc;this.win=this.composer.win;this.contain=t;this.unselectableClass=i||!1},getBookmark:function(){var n=this.getRange();return n&&n.cloneRange()},setBookmark:function(n){n&&this.setSelection(n)},setBefore:function(n){var t=rangy.createRange(this.doc);return t.setStartBefore(n),t.setEndBefore(n),this.setSelection(t)},createTemporaryCaretSpaceAfter:function(t){var i=this.doc.createElement("span"),f=this.doc.createTextNode(n.INVISIBLE_SPACE),r=function(){var t;this.contain.removeEventListener("mouseup",r);this.contain.removeEventListener("keydown",e);this.contain.removeEventListener("touchstart",r);this.contain.removeEventListener("focus",r);this.contain.removeEventListener("blur",r);this.contain.removeEventListener("paste",u);this.contain.removeEventListener("drop",u);this.contain.removeEventListener("beforepaste",u);i&&i.parentNode&&(i.innerHTML=i.innerHTML.replace(n.INVISIBLE_SPACE_REG_EXP,""),/[^\s]+/.test(i.innerHTML)?(t=i.lastChild,n.dom.unwrap(i),this.setAfter(t)):i.parentNode.removeChild(i))}.bind(this),u=function(){i&&i.parentNode&&setTimeout(r,0)},e=function(n){n.which===8||n.which===91||n.which===17||n.which===86&&(n.ctrlKey||n.metaKey)||r()};return i.className="_wysihtml-temp-caret-fix",i.style.position="absolute",i.style.display="block",i.style.minWidth="1px",i.style.zIndex="99999",i.appendChild(f),t.parentNode.insertBefore(i,t.nextSibling),this.setBefore(f),this.contain.addEventListener("mouseup",r),this.contain.addEventListener("keydown",e),this.contain.addEventListener("touchstart",r),this.contain.addEventListener("focus",r),this.contain.addEventListener("blur",r),this.contain.addEventListener("paste",u),this.contain.addEventListener("drop",u),this.contain.addEventListener("beforepaste",u),i},setAfter:function(t,i,r){var s=this.win,f=rangy.createRange(this.doc),e=function(){var f=t.parentNode,e=f?f.childNodes[f.childNodes.length-1]:null,r;u&&(e!==t||t.nodeType!==1||s.getComputedStyle(t).display!=="block")||(i?(r=this.doc.createTextNode(n.INVISIBLE_SPACE),t.parentNode.insertBefore(r,t.nextSibling),this.selectNode(r),setTimeout(function(){r&&r.parentNode&&r.parentNode.removeChild(r)},0)):this.createTemporaryCaretSpaceAfter(t))}.bind(this),u,o;f.setStartAfter(t);f.setEndAfter(t);document.activeElement&&document.activeElement===this.composer.element?(u=this.setSelection(f),e(),r&&r(u)):(o=this.composer.getScrollPos(),this.composer.element.focus(),this.composer.setScrollPos(o),setTimeout(function(){u=this.setSelection(f);e();r&&r(u)}.bind(this),0))},selectNode:function(i,r){var u=rangy.createRange(this.doc),e=i.nodeType===n.ELEMENT_NODE,f="canHaveHTML"in i?i.canHaveHTML:i.nodeName!=="IMG",s=e?i.innerHTML:i.data,o=s===""||s===n.INVISIBLE_SPACE,h=t.getStyle("display").from(i),c=h==="block"||h==="list-item";if(o&&e&&f&&!r)try{i.innerHTML=n.INVISIBLE_SPACE}catch(l){}f?u.selectNodeContents(i):u.selectNode(i);f&&o&&e?u.collapse(c):f&&o&&(u.setStartAfter(i),u.setEndAfter(i));this.setSelection(u)},getSelectedNode:function(n){var i,t;return n&&this.doc.selection&&this.doc.selection.type==="Control"&&(t=this.doc.selection.createRange(),t&&t.length)?t.item(0):(i=this.getSelection(this.doc),i.focusNode===i.anchorNode?i.focusNode:(t=this.getRange(this.doc),t?t.commonAncestorContainer:this.doc.body))},fixSelBorders:function(){var n=this.getRange();e(n);this.setSelection(n)},getSelectedOwnNodes:function(){for(var t=this.getOwnRanges(),i=[],n=0,r=t.length;n<r;n++)i.push(t[n].commonAncestorContainer||this.doc.body);return i},findNodesInSelection:function(t){for(var u=this.getOwnRanges(),i=[],f,r=0,e=u.length;r<e;r++)f=u[r].getNodes([1],function(i){return n.lang.array(t).contains(i.nodeName)}),i=i.concat(f);return i},filterElements:function(n){for(var i=this.getOwnRanges(),r=[],u,t=0,f=i.length;t<f;t++)u=i[t].getNodes([1],function(r){return n(r,i[t])}),r=r.concat(u);return r},containsUneditable:function(){for(var t=this.getOwnUneditables(),i=this.getSelection(),n=0,r=t.length;n<r;n++)if(i.containsNode(t[n]))return!0;return!1},deleteContents:function(){var n=this.getRange();this.deleteRangeContents(n);this.setSelection(n)},deleteRangeContents:function(t){var u,f,i,e,r;if(this.unselectableClass)for((u=n.dom.getParentElement(t.startContainer,{query:"."+this.unselectableClass},!1,this.contain))&&t.setStartBefore(u),(f=n.dom.getParentElement(t.endContainer,{query:"."+this.unselectableClass},!1,this.contain))&&t.setEndAfter(f),i=t.getNodes([1],function(t){return n.dom.hasClass(t,this.unselectableClass)}.bind(this)),r=i.length;r--;)try{e=new CustomEvent("wysihtml:uneditable:delete");i[r].dispatchEvent(e)}catch(o){}t.deleteContents()},getCaretNode:function(){var n=this.getSelection();return n&&n.anchorNode?r(n.anchorNode,n.anchorOffset):null},getPreviousNode:function(t,i){var o,f,u,e;return(t||(f=this.getSelection(),t=f&&f.anchorNode?r(f.anchorNode,f.anchorOffset):null),t===this.contain)?!1:(u=t.previousSibling,u===this.contain)?!1:(u&&u.nodeType!==3&&u.nodeType!==1?u=this.getPreviousNode(u,i):u&&u.nodeType===3&&/^\s*$/.test(u.textContent)?u=this.getPreviousNode(u,i):i&&u&&u.nodeType===1?(o=n.dom.getStyle("display").from(u),n.lang.array(["BR","HR","IMG"]).contains(u.nodeName)||n.lang.array(["block","inline-block","flex","list-item","table"]).contains(o)||!/^[\s]*$/.test(u.innerHTML)||(u=this.getPreviousNode(u,i))):u||t===this.contain||(e=t.parentNode,e!==this.contain&&(u=this.getPreviousNode(e,i))),u!==this.contain?u:!1)},getNodesNearCaret:function(){if(!this.isCollapsed())throw"Selection must be caret when using selection.getNodesNearCaret()";var n=this.getOwnRanges(),t,r,i,u;return n&&n.length>0?(n[0].startContainer.nodeType===1?(t=n[0].startContainer.childNodes[n[0].startOffset-1],t||n[0].startOffset!==0?t&&(r=t.previousSibling,i=t.nextSibling):i=n[0].startContainer.childNodes[0]):(n[0].startOffset===0&&n[0].startContainer.previousSibling?(t=n[0].startContainer.previousSibling,t.nodeType===3&&(u=t.data.length)):(t=n[0].startContainer,u=n[0].startOffset),r=t.previousSibling,i=t.nextSibling),{caretNode:t,prevNode:r,nextNode:i,textOffset:u}):null},getSelectionParentsByTag:function(){for(var i=this.getSelectedOwnNodes(),r,u=[],t=0,f=i.length;t<f;t++)r=i[t].nodeName&&i[t].nodeName==="LI"?i[t]:n.dom.getParentElement(i[t],{query:"li"},!1,this.contain),r&&u.push(r);return u.length?u:null},getRangeToNodeEnd:function(){if(this.isCollapsed()){var t=this.getRange(),i,r,n;if(t)return i=t.startContainer,r=t.startOffset,n=rangy.createRange(this.doc),n.selectNodeContents(i),n.setStart(i,r),n}},getRangeToNodeBeginning:function(){if(this.isCollapsed()){var t=this.getRange(),i=t.startContainer,r=t.startOffset,n=rangy.createRange(this.doc);return n.selectNodeContents(i),n.setEnd(i,r),n}},caretIsInTheEndOfNode:function(n){var e=rangy.createRange(this.doc),o=this.getSelection(),t=this.getRangeToNodeEnd(),i,r,u,f;return t?(i=t.cloneContents(),r=i.textContent,/^\s*$/.test(r)?n?(u=this.getRangeToNodeBeginning().cloneContents(),f=u.textContent,!/[\u00A0 ][\s\uFEFF]*$/.test(f)):!0:!1):!1},caretIsFirstInSelection:function(t){var u=rangy.createRange(this.doc),e=this.getSelection(),f=this.getRange(),i=r(f.startContainer,f.startOffset),o;if(i)return i.nodeType===n.TEXT_NODE?i.parentNode?!this.isCollapsed()||i.parentNode.firstChild!==i&&!n.dom.domNode(i.previousSibling).is.block()?!1:(o=this.win.getComputedStyle(i.parentNode).whiteSpace,o==="pre"||o==="pre-wrap"?f.startOffset===0:/^\s*$/.test(i.data.substr(0,f.startOffset))):!1:t&&n.dom.domNode(i).is.lineBreak()?!0:(u.selectNodeContents(this.getRange().commonAncestorContainer),u.collapse(!0),this.isCollapsed()&&(u.startContainer===e.anchorNode||u.endContainer===e.anchorNode)&&u.startOffset===e.anchorOffset)},caretIsInTheBeginnig:function(t){var r=this.getSelection(),i=r.anchorNode,u=r.anchorOffset;return t&&i?u===0&&(i.nodeName&&i.nodeName===t.toUpperCase()||n.dom.getParentElement(i.parentNode,{query:t},1)):i?u===0&&!this.getPreviousNode(i,!0):void 0},getBeforeSelection:function(t){var f=this.getSelection(),i=f.isBackwards()?f.focusNode:f.anchorNode,r=f.isBackwards()?f.focusOffset:f.anchorOffset,u=this.createRange(),h,o,e,s;return(i&&i.nodeType===3&&/^\s*$/.test(i.data.slice(0,r))&&(r=0),o=n.dom.getParentElement(i,{query:"._wysihtml-temp-caret-fix"},1),o&&(i=o.parentNode,r=Array.prototype.indexOf.call(i.childNodes,o)),i)?r>0?i.nodeType===3?(u.setStart(i,0),u.setEnd(i,r),{type:"text",range:u,offset:r,node:i}):(u.setStartBefore(i.childNodes[0]),h=i.childNodes[r-1],u.setEndAfter(h),{type:"element",range:u,offset:r,node:h}):(u.setStartAndEnd(i,0),t&&(e=this.getPreviousNode(i,!0),s=null,e&&(s=e.nodeType===1&&n.dom.hasClass(e,this.unselectableClass)?e:n.dom.domNode(e).lastLeafNode()),s))?{type:"leafnode",range:u,offset:r,node:s}:{type:"none",range:u,offset:r,node:i}:null},executeAndRestoreRangy:function(n){var t=rangy.saveSelection(this.win);if(t)try{n()}catch(i){setTimeout(function(){throw i;},0)}else n();rangy.restoreSelection(t)},executeAndRestore:function(i,r){var e=this.doc.body,b=r&&e.scrollTop,k=r&&e.scrollLeft,l="_wysihtml-temp-placeholder",p='<span class="'+l+'">'+n.INVISIBLE_SPACE+"<\/span>",f=this.getRange(!0),u,h,a,v,w,y,s,o,c;if(!f){i(e,e);return}f.collapsed||(s=f.cloneRange(),y=s.createContextualFragment(p),s.collapse(!1),s.insertNode(y),s.detach());w=f.createContextualFragment(p);f.insertNode(w);y&&(u=this.contain.querySelectorAll("."+l),f.setStartBefore(u[0]),f.setEndAfter(u[u.length-1]));this.setSelection(f);try{i(f.startContainer,f.endContainer)}catch(d){setTimeout(function(){throw d;},0)}if(u=this.contain.querySelectorAll("."+l),u&&u.length)for(o=rangy.createRange(this.doc),a=u[0].nextSibling,u.length>1&&(v=u[u.length-1].previousSibling),v&&a?(o.setStartBefore(a),o.setEndAfter(v)):(h=this.doc.createTextNode(n.INVISIBLE_SPACE),t.insert(h).after(u[0]),o.setStartBefore(h),o.setEndAfter(h)),this.setSelection(o),c=u.length;c--;)u[c].parentNode.removeChild(u[c]);else this.contain.focus();r&&(e.scrollTop=b,e.scrollLeft=k);try{u.parentNode.removeChild(u)}catch(g){}},set:function(n,t){var i=rangy.createRange(this.doc);i.setStart(n,t||0);this.setSelection(i)},insertHTML:function(n){var u=this.getRange(),r=this.doc.createElement("DIV"),f=this.doc.createDocumentFragment(),i,t;if(u){for(u.deleteContents(),r.innerHTML=n,i=r.lastChild;r.firstChild;)f.appendChild(r.firstChild);for(u.insertNode(f),t=this.contain.lastChild;t&&t.nodeType===3&&t.previousSibling&&/^\s*$/.test(t.data);)t=t.previousSibling;i&&(t&&i===t&&i.nodeType===1&&this.contain.appendChild(this.doc.createElement("br")),this.setAfter(i))}},insertNode:function(n){var t=this.getRange();t&&(t.deleteContents(),t.insertNode(n))},canAppendChild:function(n){var t,i,r=this.getRange();return t=n||r.startContainer,t&&(i=(t.tagName||t.nodeName).toLowerCase()),["area","base","br","col","command","embed","hr","img","input","keygen","link","meta","param","source","track","wbr"].indexOf(i)===-1},splitElementAtCaret:function(t,i){var h=this.getSelection(),r,u,o,s,f,e;if(h.rangeCount>0){for(r=h.getRangeAt(0).cloneRange(),r.setEndAfter(t),u=r.extractContents(),f=u.childNodes,e=f.length;e--;)n.dom.domNode(f[e]).is.visible()||u.removeChild(f[e]);t.parentNode.insertBefore(u,t.nextSibling);i?(o=i.firstChild||i,s=i.lastChild||i,t.parentNode.insertBefore(i,t.nextSibling),o&&s&&(r.setStartBefore(o),r.setEndAfter(s),this.setSelection(r))):(r.setStartAfter(t),r.setEndAfter(t));n.dom.domNode(t).is.visible()||(n.dom.getTextContent(t)===""?t.parentNode.removeChild(t):t.parentNode.replaceChild(this.doc.createTextNode(" "),t))}},surround:function(n){var i=this.getOwnRanges(),t,u=[],r;if(i.length==0)return u;for(r=i.length;r--;){t=this.doc.createElement(n.nodeName);u.push(t);n.className&&(t.className=n.className);n.cssStyle&&t.setAttribute("style",n.cssStyle);try{i[r].surroundContents(t);this.selectNode(t)}catch(f){t.appendChild(i[r].extractContents());i[r].insertNode(t)}}return u},scrollIntoView:function(){var t=this.doc,u=t.documentElement.scrollHeight>t.documentElement.offsetHeight,i=t._wysihtmlScrollIntoViewElement=t._wysihtmlScrollIntoViewElement||function(){var i=t.createElement("span");return i.innerHTML=n.INVISIBLE_SPACE,i}(),r;u&&(this.insertNode(i),r=f(i),i.parentNode.removeChild(i),r>=t.body.scrollTop+t.documentElement.offsetHeight-5&&(t.body.scrollTop=r))},selectLine:function(){var t=rangy.createRange();n.browser.supportsSelectionModify()?this._selectLine_W3C():t.nativeRange&&t.nativeRange.getBoundingClientRect&&this._selectLineUniversal()},includeRangyRangeHelpers:function(){var n=this.getSelection(),r=n.getRangeAt(0),u=function(n){return n&&n.nodeType===1&&n.classList.contains("rangySelectionBoundary")},f=function(n){return n.nodeType===1?n.childNodes&&n.childNodes.length||0:n.data&&n.data.length||0},i=n.anchorNode.nodeType===1?n.anchorNode.childNodes[n.anchorOffset]:n.anchorNode,t=n.focusNode.nodeType===1?n.focusNode.childNodes[n.focusOffset]:n.focusNode;t&&n.focusOffset===f(t)&&t.nextSibling&&u(t.nextSibling)&&r.setEndAfter(t.nextSibling);i&&n.anchorOffset===0&&i.previousSibling&&u(i.previousSibling)&&r.setStartBefore(i.previousSibling);r.select()},_selectLine_W3C:function(){var n=this.win.getSelection(),t=[n.anchorNode,n.anchorOffset,n.focusNode,n.focusOffset];n.modify("move","left","lineboundary");n.modify("extend","right","lineboundary");n.anchorNode===t[0]&&n.anchorOffset===t[1]&&n.focusNode===t[2]&&n.focusOffset===t[3]?this._selectLineUniversal():this.includeRangyRangeHelpers()},toLineBoundary:function(t,i){if(i=typeof i=="undefined"?!1:i,n.browser.supportsSelectionModify()){var r=this.win.getSelection();r.modify("extend",t,"lineboundary");i&&(t==="left"?r.collapseToStart():t==="right"&&r.collapseToEnd())}},getRangeRect:function(n){var r=this.doc.createTextNode("i"),i=this.doc.createTextNode("i"),t;return n.collapsed?(n.insertNode(i),n.selectNode(i),t=n.nativeRange.getBoundingClientRect(),n.deleteContents()):t=n.nativeRange.getBoundingClientRect(),t},_selectLineUniversal:function(){var o=this.getSelection(),t=o.getRangeAt(0),f,s,h,r=0,e,i,u,c=this,l=function(t){return t&&t.nodeType===1&&(c.win.getComputedStyle(t).display==="block"||n.lang.array(["BR","HR"]).contains(t.nodeName))},a=function(n){var t=n;if(t)while(t&&(t.nodeType===1&&t.classList.contains("rangySelectionBoundary")||t.nodeType===3&&/^\s*$/.test(t.data)))t=t.previousSibling;return t};s=t.cloneRange();h=t.cloneRange();t.collapsed&&(t.startContainer.nodeType===3&&t.startOffset<t.startContainer.data.length?t.moveEnd("character",1):t.startContainer.nodeType===1&&t.startContainer.childNodes[t.startOffset]&&t.startContainer.childNodes[t.startOffset].nodeType===3&&t.startContainer.childNodes[t.startOffset].data.length>0?t.moveEnd("character",1):t.startOffset>0&&(t.startContainer.nodeType===3||t.startContainer.nodeType===1&&!l(a(t.startContainer.childNodes[t.startOffset-1])))&&t.moveStart("character",-1));t.collapsed||t.insertNode(this.doc.createTextNode(n.INVISIBLE_SPACE));f=t.nativeRange.getBoundingClientRect();do e=t.moveStart("character",-1),i=t.nativeRange.getBoundingClientRect(),i&&Math.floor(i.top)===Math.floor(f.top)||(t.moveStart("character",1),u=!0),r++;while(e!==0&&!u&&r<2e3);if(r=0,u=!1,f=t.nativeRange.getBoundingClientRect(),t.endContainer!==this.contain||this.contain.lastChild&&this.contain.childNodes[t.endOffset]!==this.contain.lastChild)do e=t.moveEnd("character",1),i=t.nativeRange.getBoundingClientRect(),i&&Math.floor(i.bottom)===Math.floor(f.bottom)||(t.moveEnd("character",-1),t.endContainer&&t.endContainer.nodeType===1&&t.endContainer.childNodes[t.endOffset]&&t.endContainer.childNodes[t.endOffset].nodeType===1&&t.endContainer.childNodes[t.endOffset].nodeName==="BR"&&t.endContainer.childNodes[t.endOffset].previousSibling&&(t.endContainer.childNodes[t.endOffset].previousSibling.nodeType===1?t.setEnd(t.endContainer.childNodes[t.endOffset].previousSibling,t.endContainer.childNodes[t.endOffset].previousSibling.childNodes.length):t.endContainer.childNodes[t.endOffset].previousSibling.nodeType===3&&t.setEnd(t.endContainer.childNodes[t.endOffset].previousSibling,t.endContainer.childNodes[t.endOffset].previousSibling.data.length)),u=!0),r++;while(e!==0&&!u&&r<2e3);t.select();this.includeRangyRangeHelpers()},getText:function(){var n=this.getSelection();return n?n.toString():""},getNodes:function(n,t){var i=this.getRange();return i?i.getNodes(Array.isArray(n)?n:[n],t):[]},getOwnNodes:function(n,t,i){for(var u=this.getOwnRanges(),f=[],r=0,e=u.length;r<e;r++)u[r]&&(i&&u[r].splitBoundaries(),f=f.concat(u[r].getNodes(Array.isArray(n)?n:[n],t)));return f},fixRangeOverflow:function(n){var t,i;this.contain&&this.contain.firstChild&&n&&(t=n.compareNode(this.contain),t!==2?(t===1&&n.setStartBefore(this.contain.firstChild),t===0&&n.setEndAfter(this.contain.lastChild),t===3&&(n.setStartBefore(this.contain.firstChild),n.setEndAfter(this.contain.lastChild))):this._detectInlineRangeProblems(n)&&(i=n.endContainer.previousElementSibling,i&&n.setEnd(i,this._endOffsetForNode(i))))},_endOffsetForNode:function(n){var t=document.createRange();return t.selectNodeContents(n),t.endOffset},_detectInlineRangeProblems:function(n){var i=t.compareDocumentPosition(n.startContainer,n.endContainer);return n.endOffset==0&&i&4},getRange:function(n){var t=this.getSelection(),i=t&&t.rangeCount&&t.getRangeAt(0);return n!==!0&&this.fixRangeOverflow(i),i},getOwnUneditables:function(){var i=t.query(this.contain,"."+this.unselectableClass),r=t.query(i,"."+this.unselectableClass);return n.lang.array(i).without(r)},getOwnRanges:function(){var n=[],e=this.getRange(),f,i,r,u,o,t,s;if(e&&n.push(e),this.unselectableClass&&this.contain&&e&&(i=this.getOwnUneditables(),i.length>0))for(u=0,o=i.length;u<o;u++)for(f=[],t=0,s=n.length;t<s;t++){if(n[t])switch(n[t].compareNode(i[u])){case 2:break;case 3:r=n[t].cloneRange();r.setEndBefore(i[u]);f.push(r);r=n[t].cloneRange();r.setStartAfter(i[u]);f.push(r);break;default:f.push(n[t])}n=f}return n},getSelection:function(){return rangy.getSelection(this.win)},setSelection:function(n){var t=rangy.getSelection(this.win);return t.setSingleRange(n),t&&t.anchorNode&&t.focusNode?t:null},selectAll:function(){var f=this.createRange(),e=this.composer,s=this,i=u(this.composer.element),h=u(this.composer.element),t,r=function(){f.setStart(e.element,0);f.setEnd(e.element,e.element.childNodes.length);t=s.setSelection(f)},o=function(){return!t||t.nativeSelection&&t.nativeSelection.type&&(t.nativeSelection.type==="Caret"||t.nativeSelection.type==="None")};n.dom.removeInvisibleSpaces(this.composer.element);r();this.composer.element.firstChild&&o()&&(this.composer.element.appendChild(i),r(),o()&&(i.parentNode.removeChild(i),this.composer.element.insertBefore(h,this.composer.element.firstChild),r(),o()&&(this.composer.element.appendChild(i),r())))},createRange:function(){return rangy.createRange(this.doc)},isCollapsed:function(){return this.getSelection().isCollapsed},getHtml:function(){return this.getSelection().toHtml()},getPlainText:function(){return this.getSelection().toString()},isEndToEndInNode:function(t){var f=this.getRange(),i=f.commonAncestorContainer,r=f.startContainer,u=f.endContainer;if((i.nodeType===n.TEXT_NODE&&(i=i.parentNode),r.nodeType===n.TEXT_NODE&&!/^\s*$/.test(r.data.substr(f.startOffset)))||u.nodeType===n.TEXT_NODE&&!/^\s*$/.test(u.data.substr(f.endOffset)))return!1;while(r&&r!==i){if(r.nodeType!==n.TEXT_NODE&&!n.dom.contains(i,r)||n.dom.domNode(r).prev({ignoreBlankTexts:!0}))return!1;r=r.parentNode}while(u&&u!==i){if(u.nodeType!==n.TEXT_NODE&&!n.dom.contains(i,u)||n.dom.domNode(u).next({ignoreBlankTexts:!0}))return!1;u=u.parentNode}return n.lang.array(t).contains(i.nodeName)?i:!1},isInThisEditable:function(){var r=this.getSelection(),t=r.focusNode,i=r.anchorNode;return t&&t.nodeType!==1&&(t=t.parentNode),i&&i.nodeType!==1&&(i=i.parentNode),i&&t&&(n.dom.contains(this.composer.element,t)||this.composer.element===t)&&(n.dom.contains(this.composer.element,i)||this.composer.element===i)},deselect:function(){var n=this.getSelection();n&&n.removeAllRanges()}})}(wysihtml);wysihtml.Commands=Base.extend({constructor:function(n){this.editor=n;this.composer=n.composer;this.doc=this.composer.doc},support:function(n){return wysihtml.browser.supportsCommand(this.doc,n)},exec:function(n,t){var i=wysihtml.commands[n],u=wysihtml.lang.array(arguments).get(),f=i&&i.exec,r=null;if(this.composer.hasPlaceholderSet()&&!wysihtml.lang.array(["styleWithCSS","enableObjectResizing","enableInlineTableEditing"]).contains(n)&&(this.composer.element.innerHTML="",this.composer.selection.selectNode(this.composer.element)),this.editor.fire("beforecommand:composer"),f)u.unshift(this.composer),r=f.apply(i,u);else try{r=this.doc.execCommand(n,!1,t)}catch(e){}return this.editor.fire("aftercommand:composer"),r},remove:function(n){var t=wysihtml.commands[n],i=wysihtml.lang.array(arguments).get(),r=t&&t.remove;if(r)return i.unshift(this.composer),r.apply(t,i)},state:function(n){var t=wysihtml.commands[n],i=wysihtml.lang.array(arguments).get(),r=t&&t.state;if(r)return i.unshift(this.composer),r.apply(t,i);try{return this.doc.queryCommandState(n)}catch(u){return!1}},stateValue:function(n){var t=wysihtml.commands[n],i=wysihtml.lang.array(arguments).get(),r=t&&t.stateValue;return r?(i.unshift(this.composer),r.apply(t,i)):!1}}),function(n){function i(i){var r=typeof i=="object"?i:{href:i};return n.lang.object({}).merge(t).merge({attribute:i}).get()}var t={nodeName:"A",toggle:!1};n.commands.createLink={exec:function(t,r,u){var e=i(u),f;t.selection.isCollapsed()&&!this.state(t,r)&&(f=t.doc.createTextNode(e.attribute.href),t.selection.insertNode(f),t.selection.selectNode(f));n.commands.formatInline.exec(t,r,e)},state:function(i,r){return n.commands.formatInline.state(i,r,t)}}}(wysihtml),function(n){function g(n){return{nodeName:n.nodeName||null,className:n.classRegExp?null:n.className||null,classRegExp:n.classRegExp||null,styleProperty:n.styleProperty||null}}function f(n,t){return n.nodeType===3?n:n.childNodes[t]||n}function e(n){return n&&n.nodeType===1&&n.nodeName==="BR"}function nt(n,t){return n&&n.nodeType===1&&t.win.getComputedStyle(n).display==="block"}function a(n){return n&&n.nodeType===1&&n.classList.contains("rangySelectionBoundary")}function i(n,t){return e(n)||nt(n,t)}function v(i,r){var u;n.dom.removeInvisibleSpaces(i.element);var o=i.element,s=o.querySelectorAll(t),h=i.config.classNames.uneditableContainer+[""].concat(t.split(",")).join(", "+i.config.classNames.uneditableContainer+" "),c=o.querySelectorAll(h),f=n.lang.array(s).without(c),e;for(u=f.length;u--;)f[u].innerHTML.replace(/[\uFEFF]/g,"")===""&&(r.length===0||f[u]!==r[r.length-1])&&(e=n.lang.array(r).indexOf(f[u]),e>-1&&r.splice(e,1),f[u].parentNode.removeChild(f[u]));return r}function s(n){return n.config.useLineBreaks?"DIV":"P"}function y(n,i,r){for(var f=n,e=null;f&&i&&f!==i;)f.nodeType===1&&f.matches(r?t:u)&&(e=f),f=f.parentNode;return e}function tt(n,t){for(var i=n,f,e,r=null,u;i&&t&&i!==t;)i.nodeType===1&&i.matches(d)&&(e=i,r===null?(r=i.cloneNode(!1),f=r):(u=i.cloneNode(!1),u.appendChild(r),r=u)),i=i.parentNode;return{parent:e,outerNode:r,innerNode:f}}function o(t,i,u){return t||(t=u.doc.createElement(i.nodeName||s(u)),t.appendChild(u.doc.createTextNode(n.INVISIBLE_SPACE))),i.nodeName&&t.nodeName!==i.nodeName&&(t=r.renameElement(t,i.nodeName)),i.classRegExp&&(t.className=t.className.replace(i.classRegExp,"")),i.className&&t.classList.add(i.className),i.styleProperty&&typeof i.styleValue!="undefined"&&(t.style[n.browser.fixStyleKey(i.styleProperty)]=i.styleValue),t}function it(t,i,u){var f,o=t.previousSibling,h=t.nextSibling,e=!1;i.styleProperty&&(t.style[n.browser.fixStyleKey(i.styleProperty)]="");i.className&&t.classList.remove(i.className);i.classRegExp&&(t.className=t.className.replace(i.classRegExp,""));t.getAttribute("class")!==null&&t.getAttribute("class").trim()===""&&t.removeAttribute("class");i.nodeName&&t.nodeName.toLowerCase()===i.nodeName.toLowerCase()&&(f=t.getAttribute("style"),f&&f.trim()!==""?t=r.renameElement(t,s(u)):(r.unwrap(t),e=!0));t.getAttribute("style")!==null&&t.getAttribute("style").trim()===""&&t.removeAttribute("style");e&&st(o,h,u)}function h(i){for(var r=i.querySelectorAll(t)||[],f,e,u=r.length;u--;)f=n.dom.domNode(r[u]).next({nodeTypes:[1,3],ignoreBlankTexts:!0}),e=n.dom.domNode(r[u]).prev({nodeTypes:[1,3],ignoreBlankTexts:!0}),f&&f.nodeType!==1&&f.nodeName!=="BR"&&(r[u].innerHTML||r[u].nodeValue||"").trim()!==""&&r[u].parentNode.insertBefore(r[u].ownerDocument.createElement("BR"),f),f&&f.nodeType!==1&&f.nodeName!=="BR"&&(r[u].innerHTML||r[u].nodeValue||"").trim()!==""&&r[u].parentNode.insertBefore(r[u].ownerDocument.createElement("BR"),f),n.dom.unwrap(r[u])}function rt(n,t){var u,i=n.startContainer,r=n.endContainer;if(i&&i.nodeType===1&&i===r){i.firstChild===i.lastChild&&n.endOffset===1&&i!==t.element&&i.nodeName!=="LI"&&i.nodeName!=="TD"&&(n.setStartBefore(i),n.setEndAfter(r));return}if(i&&i.nodeType===1&&r.nodeType===3){i.firstChild===r&&n.endOffset===r.data.length&&i!==t.element&&i.nodeName!=="LI"&&i.nodeName!=="TD"&&n.setEndAfter(i);return}if(r&&r.nodeType===1&&i.nodeType===3){r.firstChild===i&&n.startOffset===0&&r!==t.element&&r.nodeName!=="LI"&&r.nodeName!=="TD"&&n.setStartBefore(r);return}if(i&&i.nodeType===3&&i===r&&i.parentNode.childNodes.length===1){n.endOffset==r.data.length&&n.startOffset===0&&(u=i.parentNode,u!==t.element&&u.nodeName!=="LI"&&u.nodeName!=="TD"&&(n.setStartBefore(u),n.setEndAfter(u)));return}}function ut(t){for(var o=[],r,u,h,e,s,f,i=0,c=t.length;i<c;i++)if(t[i].startContainer.nodeType===1&&t[i].startContainer.matches("ul, ol")&&t[i].setStart(t[i].startContainer.childNodes[t[i].startOffset],0),t[i].endContainer.nodeType===1&&t[i].endContainer.matches("ul, ol")&&(f=t[i].endContainer.childNodes[Math.max(t[i].endOffset-1,0)],f.childNodes&&t[i].setEnd(f,f.childNodes.length)),r=t[i].getNodes([1],function(n){return n.nodeName==="LI"}),r.length>0){for(u=0,h=r.length;u<h;u++)s=t[i].compareNode(r[u]),(s===t[i].NODE_AFTER||s===t[i].NODE_INSIDE)&&(e=t[i].cloneRange(),f=n.dom.domNode(r[u]).prev({nodeTypes:[1]}),f?e.setEnd(f,f.childNodes.length):r[u].closest("ul, ol")?e.setEndBefore(r[u].closest("ul, ol")):e.setEndBefore(r[u]),o.push(e),t[i].setStart(r[u],0)),(s===t[i].NODE_BEFORE||s===t[i].NODE_INSIDE)&&(e=t[i].cloneRange(),e.setEnd(r[u],r[u].childNodes.length),o.push(e),f=n.dom.domNode(r[u]).next({nodeTypes:[1]}),f?t[i].setStart(f,0):r[u].closest("ul, ol")?t[i].setStartAfter(r[u].closest("ul, ol")):t[i].setStartAfter(r[u]));o.push(t[i])}else o.push(t[i]);return o}function ft(t,i,r){var u=t?n.lang.object(t).clone(!0):null;return u&&(u.nodeName=u.nodeName||i||s(r)),u}function p(t,r,u,f){var l=r.startContainer,f=f||y(l,u.element,!0),e,o,h,c,s,a,v;if(f)o=t.firstChild,h=t.lastChild,u.selection.splitElementAtCaret(f,t),s=n.dom.domNode(h).next({nodeTypes:[1,3],ignoreBlankTexts:!0}),c=n.dom.domNode(o).prev({nodeTypes:[1,3],ignoreBlankTexts:!0}),o&&!i(o,u)&&c&&!i(c,u)&&o.parentNode.insertBefore(u.doc.createElement("br"),o),h&&!i(h,u)&&s&&!i(s,u)&&s.parentNode.insertBefore(u.doc.createElement("br"),s);else if(e=tt(l,u.element),e.outerNode&&e.innerNode&&e.parent){if(t.childNodes.length===1){while(t.firstChild.firstChild)e.innerNode.appendChild(t.firstChild.firstChild);t.firstChild.appendChild(e.outerNode)}u.selection.splitElementAtCaret(e.parent,t)}else a=t.firstChild,v=t.lastChild,r.insertNode(t),r.setStartBefore(a),r.setEndAfter(v)}function et(r,u,e){for(var c=r.cloneRange(),v=f(c.startContainer,c.startOffset).previousSibling,b=f(c.endContainer,c.endOffset).nextSibling,s=c.extractContents(),o=e.doc.createDocumentFragment(),l,y,k=!0,a,w;s.firstChild;){if(s.firstChild.nodeType===1&&s.firstChild.matches(t)){for(h(s.firstChild),l=n.dom.unwrap(s.firstChild),l.length>0&&(o.lastChild&&(o.lastChild.nodeType!==1||!i(o.lastChild,e))||!o.lastChild&&v&&(v.nodeType!==1||i(v,e)))&&o.appendChild(e.doc.createElement("BR")),a=0,w=l.length;a<w;a++)o.appendChild(l[a]);l.length>0&&(o.lastChild.nodeType===1&&i(o.lastChild,e)||(b||o.lastChild!==s.lastChild)&&o.appendChild(e.doc.createElement("BR")))}else o.appendChild(s.firstChild);k=!1}return y=n.lang.array(o.childNodes).get(),p(o,c,e),y}function ot(t,i,r){var u=t&&n.dom.domNode(t).prev({nodeTypes:[1,3],ignoreBlankTexts:!0});e(i)&&i.parentNode.removeChild(i);e(t)&&(!u||u.nodeType!==1||r.win.getComputedStyle(u).display!=="block")&&t.parentNode.removeChild(t)}function st(n,t,i){var r;n&&a(n)&&(n=n.previousSibling);t&&a(t)&&(t=t.nextSibling);r=n&&n.previousSibling;n&&(n.nodeType!==1||i.win.getComputedStyle(n).display!=="block"&&!e(n))&&n.parentNode&&n.parentNode.insertBefore(i.doc.createElement("br"),n.nextSibling);t&&(t.nodeType!==1||i.win.getComputedStyle(t).display!=="block")&&t.parentNode&&t.parentNode.insertBefore(i.doc.createElement("br"),t)}function lt(i,r,e,s){var it=r?g(r):null,l=i.cloneRange(),rt=l.startContainer,k=f(l.startContainer,l.startOffset),a=f(l.endContainer,l.endOffset),ut=l.startContainer===k&&k.nodeType===3&&!ht(k,l.startOffset)?k:n.dom.domNode(k).prev({nodeTypes:[1,3],ignoreBlankTexts:!0}),d=l.endContainer.nodeType===1&&l.endContainer.childNodes[l.endOffset]===a&&(a.nodeType===1||!w(a,l.endOffset)&&!n.dom.domNode(a).is.rangyBookmark())||l.endContainer===a&&a.nodeType===3&&!w(a,l.endOffset)?a:n.dom.domNode(a).next({nodeTypes:[1,3],ignoreBlankTexts:!0}),c=l.extractContents(),b=s.doc.createDocumentFragment(),et=it?n.dom.getParentElement(rt,it,null,s.element):null,st=!e||!r||r.nodeName==="BLOCKQUOTE"&&e==="BLOCKQUOTE",lt=et||y(rt,s.element,st),nt,v,tt;if(n.dom.domNode(d).is.rangyBookmark()&&(a=d,d=a.nextSibling),ct(c),r&&r.nodeName==="BLOCKQUOTE")tt=o(null,r,s),tt.appendChild(c),b.appendChild(tt),v=[tt];else{if(c.firstChild)while(c.firstChild)if(c.firstChild.nodeType==1&&c.firstChild.matches(t))o(c.firstChild,r,s),c.firstChild.matches(u)&&h(c.firstChild),b.appendChild(c.firstChild);else{for(nt=o(null,ft(r,e,s),s);c.firstChild&&(c.firstChild.nodeType!==1||!c.firstChild.matches(t));)c.firstChild.nodeType==1&&nt.matches(u)&&h(c.firstChild),nt.appendChild(c.firstChild);b.appendChild(nt)}else b.appendChild(o(null,r,s));v=n.lang.array(b.childNodes).get()}return p(b,l,s,lt),ot(ut,d,s),v.length>0&&(typeof v[v.length-1].lastChild=="undefined"||n.dom.domNode(v[v.length-1].lastChild).is.rangyBookmark())&&v[v.length-1].appendChild(s.doc.createElement("br")),v}function at(i,r){var u=n.dom.getParentElement(i,{query:t},null,r.element);return u?u.nodeName:null}function b(t,i){var f=n.dom.getParentElement(t.selection.getOwnRanges()[0].startContainer,{query:u+", "+(i?i.toLowerCase():"div")},null,t.element),r;f?(r=t.selection.createRange(),r.selectNode(f),t.selection.setSelection(r)):t.isEmpty()||t.selection.selectLine()}function k(n,t){var r=t.selection.createRange(),i=n[n.length-1],u=i.nodeType===1&&i.childNodes?i.childNodes.length|0:i.length||0;r.setStart(n[0],0);r.setEnd(i,u);r.select()}function c(n,t,i){for(var r=t.selection.getOwnRanges(),f=[],e,r=ut(r),u=r.length;u--;)rt(r[u],t),e=at(r[u].startContainer,t),f=n==="remove"?f.concat(et(r[u],e,t)):f.concat(lt(r[u],i,e,t));return f}function l(n){return typeof n=="string"&&(n={nodeName:n.toUpperCase()}),n}function vt(t){var i;return t.selection.isCollapsed()&&(i=t.selection.getNodesNearCaret(),i&&i.caretNode&&(n.dom.domNode(i.caretNode).is.lineBreak()||i.caretNode.nodeType===3&&i.textOffset===0&&(!i.prevNode||n.dom.domNode(i.prevNode).is.lineBreak())||i.caretNode.nodeType===1&&i.caretNode.classList.contains("rangySelectionBoundary")&&(!i.prevNode||n.dom.domNode(i.prevNode).is.lineBreak()||n.dom.domNode(i.prevNode).is.block())&&(!i.nextNode||n.dom.domNode(i.nextNode).is.lineBreak()||n.dom.domNode(i.nextNode).is.block())))?!0:!1}var r=n.dom,u="h1, h2, h3, h4, h5, h6, p, pre",t="h1, h2, h3, h4, h5, h6, p, pre, div, blockquote",d="b, big, i, small, tt, abbr, acronym, cite, code, dfn, em, kbd, strong, samp, var, a, bdo, br, q, span, sub, sup, button, label, textarea, input, select, u",ht=function(n,t){var i=n.data?n.data.slice(0,t):"";return/^\s*$/.test(i)},w=function(n,t){var i=n.data?n.data.slice(t):"";return/^\s*$/.test(i)},ct=function(n){if(n){while(n.firstChild&&n.firstChild.nodeType===3&&/^\s*$/.test(n.firstChild.data)&&n.lastChild!==n.firstChild)n.removeChild(n.firstChild);while(n.lastChild&&n.lastChild.nodeType===3&&/^\s*$/.test(n.lastChild.data)&&n.lastChild!==n.firstChild)n.removeChild(n.lastChild);n.firstChild&&n.firstChild.nodeType===1&&n.firstChild.nodeName==="BR"&&n.lastChild!==n.firstChild&&n.removeChild(n.firstChild);n.lastChild&&n.lastChild.nodeType===1&&n.lastChild.nodeName==="BR"&&n.lastChild!==n.firstChild&&n.removeChild(n.lastChild)}};n.commands.formatBlock={exec:function(n,t,i){var r,u,f,e,o;if(i=l(i),r=[],i&&i.toggle&&(f=this.state(n,t,i)),f)for(u=rangy.saveSelection(n.win),e=0,o=f.length;e<o;e++)it(f[e],i,n);else n.selection.isCollapsed()&&(u=rangy.saveSelection(n.win),vt(n)?n.selection.selectLine():b(n,i&&i.nodeName?i.nodeName.toUpperCase():undefined)),r=i?c("apply",n,i):c("remove",n);r=v(n,r);u?rangy.restoreSelection(u):k(r,n)},remove:function(n,t,i){i=l(i);var r,u;n.selection.isCollapsed()&&(u=rangy.saveSelection(n.win),b(n,i&&i.nodeName?i.nodeName.toUpperCase():undefined));r=c("remove",n);r=v(n,r);u?rangy.restoreSelection(u):k(r,n)},state:function(i,u,f){var e,h,o,s,c;for(f=l(f),e=i.selection.filterElements(function(i){return n.dom.domNode(i).test(f||{query:t})}.bind(this)),h=i.selection.getSelectedOwnNodes(),s=0,c=h.length;s<c;s++)o=r.getParentElement(h[s],f||{query:t},null,i.element),o&&e.indexOf(o)===-1&&e.push(o);return e.length===0?!1:e}}}(wysihtml),function(n){function a(n){return/^\s*$/.test(n.className)}function v(n){return!n.getAttribute("style")||/^\s*$/.test(n.getAttribute("style"))}function rt(t){var i=n.dom.getAttributes(t);return n.lang.object(i).isEmpty()}function y(t,i){var f,e,r,u;return t.nodeType!==1||i.nodeType!==1?!1:t.nodeName!==i.nodeName?!1:(f=t.className.trim().replace(/\s+/g," ").split(" "),e=i.className.trim().replace(/\s+/g," ").split(" "),n.lang.array(f).without(e).length>0)?!1:(r=n.dom.getAttributes(t),u=n.dom.getAttributes(i),r.length!==u.length||!n.lang.object(n.lang.object(r).difference(u)).isEmpty())?!1:!0}function p(t,i){var e=i&&i.nodeName||u,r=t.ownerDocument.createElement(e),f;if(i.classRegExp&&(r.className=r.className.replace(i.classRegExp,"")),i.className&&r.classList.add(i.className),i.styleProperty&&typeof i.styleValue!="undefined"&&(r.style[n.browser.fixStyleKey(i.styleProperty)]=i.styleValue),i.attribute)if(typeof i.attribute=="object")for(f in i.attribute)i.attribute.hasOwnProperty(f)&&r.setAttribute(f,i.attribute[f]);else typeof i.attributeValue!="undefined"&&r.setAttribute(i.attribute,i.attributeValue);return r}function ut(n,t){for(var i in n)if(n.hasOwnProperty(i)&&(typeof t[i]===undefined||t[i]!==n[i]))return!1;return!0}function ft(t,i,r){var f=n.dom.getAttributes(t),e=ut(i,f),o=n.lang.object(f).difference(i),u;if(e&&r!==!1)for(u in i)i.hasOwnProperty(u)&&t.removeAttribute(u);else for(u in i)i.hasOwnProperty(u)&&t.setAttribute(u,i[u])}function f(t,i){var r,f,e;i.className&&(i.toggle!==!1&&t.classList.contains(i.className)?t.classList.remove(i.className):(i.classRegExp&&(t.className=t.className.replace(i.classRegExp,"")),t.classList.add(i.className)),a(t)&&t.removeAttribute("class"));i.styleProperty&&(t.style[n.browser.fixStyleKey(i.styleProperty)]=i.toggle!==!1&&t.style[n.browser.fixStyleKey(i.styleProperty)].trim().replace(/, /g,",")===i.styleValue?"":i.styleValue);v(t)&&t.removeAttribute("style");i.attribute&&(typeof i.attribute=="object"?r=i.attribute:(r={},r[i.attribute]=i.attributeValue||""),ft(t,r,i.toggle));f=i.nodeName?l[i.nodeName.toLowerCase()]||i.nodeName.toLowerCase():null;e=f?n.dom.domNode(t).test({query:f}):!1;(!i.nodeName||i.nodeName===u||e)&&(i.toggle!==!1&&e||!i.nodeName&&t.nodeName===u)&&a(t)&&v(t)&&rt(t)&&n.dom.unwrap(t)}function e(t,i){var r=[];return t.isCollapsed()||(r=r.concat(t.getOwnNodes([3],function(t){return!n.dom.domNode(t).is.emptyTextNode()},i))),r}function i(n,t,i,r){var u=n,f=r?t:et(t);do{if(u.nodeType===1&&ot(u,f))return u;u=u.parentNode}while(u&&u!==i);return null}function et(n){return{nodeName:n.nodeName||null,className:n.classRegExp?null:n.className||null,classRegExp:n.classRegExp||null,styleProperty:n.styleProperty||null}}function ot(t,i){var r,u;return i.nodeName?(u=l[i.nodeName.toLowerCase()]||i.nodeName.toLowerCase(),n.dom.domNode(t).test({query:u})):(r=n.lang.object(i).clone(),r.query=it,n.dom.domNode(t).test(r))}function w(t,i){var r=document.documentElement||document.body,u=r.scrollTop,f=r.scrollLeft,e=rangy.getSelection(t.win);rangy.getSelection(t.win).removeAllRanges();try{rangy.getSelection(t.win).addRange(i)}catch(o){}t.doc.activeElement&&n.dom.contains(t.element,t.doc.activeElement)||(t.element.focus(),r.scrollTop=u,r.scrollLeft=f,rangy.getSelection(t.win).addRange(i))}function b(n,t){var i=rangy.createRange(t.doc),r=n[n.length-1];n[0]&&r&&(i.setStart(n[0],0),i.setEnd(r,r.length),w(t,i))}function k(n,t,i,r){var u=rangy.createRange(n.doc);t&&(u.setStart(t,i),u.setEnd(t,typeof r!="undefined"?r:i),w(n,u))}function t(n,t,r){var u=e(n.selection),c=[],l=!1,s,h,f,o,a;if(n.selection.isInThisEditable()){if(u.length===0&&n.selection.isCollapsed()){if(f=n.selection.getSelection().anchorNode,!f)return{nodes:[],partial:!1};f.nodeType===3&&(u=[f])}for(u.length||(h=n.selection.getOwnRanges()[0],h&&(u=[h.endContainer])),o=0,a=u.length;o<a;o++)s=i(u[o],t,n.element,r),s?c.push(s):l=!0}return{nodes:c,partial:l}}function d(n){var t,i,r,u;return n&&(t=n.anchorNode,i=n.anchorOffset,t&&t.nodeType===3&&i>0&&i<t.data.length)?(r=t.data[i-1],u=t.data[i],/\w/.test(r)&&/\w/.test(u)):!1}function g(t){var i,e,o,u,r,f,s=[];if(t&&(i=t.anchorNode,e=r=f=t.anchorOffset,o=i.ownerDocument,u=rangy.createRange(o),i&&i.nodeType===3)){while(r>0&&/\w/.test(i.data[r-1]))r--;while(f<i.data.length&&/\w/.test(i.data[f]))f++;return u.setStartAndEnd(i,r,f),u.splitBoundaries(),s=u.getNodes([3],function(t){return!n.dom.domNode(t).is.emptyTextNode()}),{wordOffset:e-r,range:u,textNode:s[0]}}return!1}function nt(n,t){while(t.firstChild)n.appendChild(t.firstChild);t.parentNode.removeChild(t)}function tt(n){for(var t=n.length;t--;)n[t]&&n[t].parentNode&&(n[t].nextSibling&&y(n[t],n[t].nextSibling)&&nt(n[t],n[t].nextSibling),n[t].previousSibling&&y(n[t],n[t].previousSibling)&&nt(n[t].previousSibling,n[t]))}function r(n,i,r){i.length>0&&b(i,n);tt(t(n,r).nodes);i.length>0&&b(i,n)}function o(n,i,r,u){k(n,i,r);tt(t(n,u).nodes);k(n,i,r)}function s(n,t){var i=p(n,t);n.parentNode.insertBefore(i,n);i.appendChild(n)}function h(t,r,u){var s=r.element,e=i(t,u,s),o;e&&(o=e.cloneNode(!1),n.dom.domNode(t).escapeParent(e,o),f(o,u))}function st(t,r,u){var e=r.element,f=i(t,u,e);f&&n.dom.domNode(t).escapeParent(f)}function ht(n,t,i){var r=p(n.endContainer,i);n.surroundContents(r);t.selection.selectNode(r)}function ct(u,e,c,l){var k=t(u,l,!0),b=u.selection.getSelection(),v,y,p,a,w;if(e.length){if(k.partial||l.toggle===!1)for(a=e.length;a--;)i(e[a],l,u.element)&&h(e[a],u,l),i(e[a],l,u.element)||s(e[a],l);else for(a=e.length;a--;)h(e[a],u,l);r(u,e,l)}else if(l.toggle!==!1){if(d(b))v=g(b),y=v.textNode,h(v.textNode,u,l),o(u,v.textNode,v.wordOffset,l);else if(y=u.doc.createTextNode(n.INVISIBLE_SPACE),p=c.nodes[0].cloneNode(!1),p.appendChild(y),u.selection.splitElementAtCaret(c.nodes[0],p),f(p,l),r(u,[y],l),w=u.selection.getSelection(),w.anchorNode&&w.focusNode)try{w.collapseToEnd()}catch(nt){}}else for(a=c.nodes.length;a--;)f(c.nodes[a],l)}function lt(t,i,u,f){var s,h,e,c=t.selection.getSelection();if(i.length){for(e=i.length;e--;)st(i[e],t,f);r(t,i,f)}else{for(s=c.anchorNode,h=c.anchorOffset,e=u.nodes.length;e--;)n.dom.unwrap(u.nodes[e]);o(t,s,h,f)}}function at(n,t,i){var u,f,h=n.selection.getSelection(),e;if(t.length){for(f=t.length;f--;)s(t[f],i);r(n,t,i)}else d(h)?(u=g(h),s(u.textNode,i),o(n,u.textNode,u.wordOffset,i)):(e=n.selection.getOwnRanges()[0],e&&ht(e,n,i))}function c(n){return n=typeof n=="string"?{nodeName:n}:n,n.nodeName&&(n.nodeName=n.nodeName.toUpperCase()),n}var u="SPAN",it="b, big, i, small, tt, abbr, acronym, cite, code, dfn, em, kbd, strong, samp, var, a, bdo, br, q, span, sub, sup, button, label, textarea, input, select, u",l={b:"b, strong",strong:"b, strong",em:"em, i",i:"em, i"};n.commands.formatInline={exec:function(n,i,r){r=c(r);n.element.normalize();var u=e(n.selection,!0),f=t(n,r);f.nodes.length>0?ct(n,u,f,r):at(n,u,r);n.element.normalize()},remove:function(n,i,r){r=c(r);n.element.normalize();var f=e(n.selection,!0),u=t(n,r);u.nodes.length>0&&lt(n,f,u,r);n.element.normalize()},state:function(n,i,r){r=c(r);var u=t(n,r,!0).nodes;return u.length===0?!1:u}}}(wysihtml),function(n){n.commands.indentList={exec:function(n){var t=n.selection.getSelectionParentsByTag("LI");return t?this.tryToPushLiLevel(t,n.selection):!1},state:function(){return!1},tryToPushLiLevel:function(t,i){var o,f,u,r,e,s=!1;return i.executeAndRestoreRangy(function(){for(var i=t.length;i--;)r=t[i],o=r.parentNode.nodeName==="OL"?"OL":"UL",f=r.ownerDocument.createElement(o),u=n.dom.domNode(r).prev({nodeTypes:[n.ELEMENT_NODE]}),e=u?u.querySelector("ul, ol"):null,u&&(e?e.appendChild(r):(f.appendChild(r),u.appendChild(f)),s=!0)}),s}}}(wysihtml),function(n){n.commands.insertHTML={exec:function(n,t,i){n.selection.insertHTML(i)},state:function(){return!1}}}(wysihtml),function(n){var t="<br>"+(n.browser.needsSpaceAfterLineBreak()?" ":"");n.commands.insertLineBreak={exec:function(n){n.selection.insertHTML(t)},state:function(){return!1}}}(wysihtml);wysihtml.commands.insertList=function(n){var t=function(n,t){if(n&&n.nodeName){typeof t=="string"&&(t=[t]);for(var i=t.length;i--;)if(n.nodeName===t[i])return!0}return!1},r=function(i,r,u){var f={el:null,other:!1},e,o;return i&&(e=n.dom.getParentElement(i,{query:"li"},!1,u.element),o=r==="UL"?"OL":"UL",t(i,r)?f.el=i:t(i,o)?f={el:i,other:!0}:e&&(t(e.parentNode,r)?f.el=e.parentNode:t(e.parentNode,o)&&(f={el:e.parentNode,other:!0}))),f.el&&!u.element.contains(f.el)&&(f.el=null),f},u=function(t,r,u){var o=r==="UL"?"OL":"UL",f,e;u.selection.executeAndRestoreRangy(function(){var s,h;if(f=i(o,u),f.length)for(s=f.length;s--;)n.dom.renameElement(f[s],r.toLowerCase());else{for(e=i(["OL","UL"],u),h=e.length;h--;)n.dom.resolveList(e[h],u.config.useLineBreaks);e.length===0&&n.dom.resolveList(t,u.config.useLineBreaks)}})},f=function(t,r,u){var f=r==="UL"?"OL":"UL";u.selection.executeAndRestoreRangy(function(){for(var e=[t].concat(i(f,u)),o=e.length;o--;)n.dom.renameElement(e[o],r.toLowerCase())})},i=function(n,i){for(var u=i.selection.getOwnRanges(),r=[],f=u.length;f--;)r=r.concat(u[f].getNodes([1],function(i){return t(i,n)}));return r},e=function(t,i){var u=rangy.saveSelection(i.win),f="_wysihtml-temp-"+(new Date).getTime(),e,o,r,s;i.commands.exec("formatBlock",{nodeName:"div",className:f});r=i.element.querySelector("."+f);s=/\uFEFF/g;r.innerHTML=r.innerHTML.replace(n.INVISIBLE_SPACE_REG_EXP,"");r&&(e=/^(\s|(<br>))+$/i.test(r.innerHTML),o=n.dom.convertToList(r,t.toLowerCase(),i.parent.config.classNames.uneditableContainer),u&&rangy.restoreSelection(u),e&&i.selection.selectNode(o.querySelector("li"),!0))};return{exec:function(t,i,o){var y=t.doc,a=o==="OL"?"insertOrderedList":"insertUnorderedList",s=t.selection.getSelection(),h=s.anchorNode.nodeType===1&&s.anchorNode.firstChild?s.anchorNode.childNodes[s.anchorOffset]:s.anchorNode,c=s.focusNode.nodeType===1&&s.focusNode.firstChild?s.focusNode.childNodes[s.focusOffset]||s.focusNode.lastChild:s.focusNode,v,l;s.isBackwards()&&(h=[c,c=h][0]);n.dom.domNode(c).is.emptyTextNode(!0)&&c&&(c=n.dom.domNode(c).prev({nodeTypes:[1,3],ignoreBlankTexts:!0}));n.dom.domNode(h).is.emptyTextNode(!0)&&h&&(h=n.dom.domNode(h).next({nodeTypes:[1,3],ignoreBlankTexts:!0}));v=h&&c?h===c?h:n.dom.domNode(h).commonAncestor(c,t.element):t.selection.getSelectedNode();l=r(v,o,t);l.el?l.other?f(l.el,o,t):u(l.el,o,t):t.commands.support(a)?y.execCommand(a,!1,null):e(o,t)},state:function(n,t,i){var f=n.selection.getSelectedNode(),u=r(f,i,n);return u.el&&!u.other?u.el:!1}}}(wysihtml),function(n){n.commands.outdentList={exec:function(n){var t=n.selection.getSelectionParentsByTag("LI");return t?this.tryToPullLiLevel(t,n):!1},state:function(){return!1},tryToPullLiLevel:function(t,i){var r,e,o,u,f,s=!1,h=this;return i.selection.executeAndRestoreRangy(function(){for(var l,c=t.length;c--;)if(u=t[c],u.parentNode&&(r=u.parentNode,r.tagName==="OL"||r.tagName==="UL")){if(s=!0,e=n.dom.getParentElement(r.parentNode,{query:"ol, ul"},!1,i.element),o=n.dom.getParentElement(r.parentNode,{query:"li"},!1,i.element),e&&o)u.nextSibling&&(f=h.getAfterList(r,u),u.appendChild(f)),e.insertBefore(u,o.nextSibling);else{for(u.nextSibling&&(f=h.getAfterList(r,u),u.appendChild(f)),l=u.childNodes.length;l--;)r.parentNode.insertBefore(u.childNodes[l],r.nextSibling);r.parentNode.insertBefore(document.createElement("br"),r.nextSibling);u.parentNode.removeChild(u)}r.childNodes.length===0&&r.parentNode.removeChild(r)}}),s},getAfterList:function(n,t){for(var r=n.nodeName,i=document.createElement(r);t.nextSibling;)i.appendChild(t.nextSibling);return i}}}(wysihtml),function(n){n.commands.redo={exec:function(n){return n.undoManager.redo()},state:function(){return!1}}}(wysihtml),function(n){var t={nodeName:"A"};n.commands.removeLink={exec:function(i,r){n.commands.formatInline.remove(i,r,t)},state:function(i,r){return n.commands.formatInline.state(i,r,t)}}}(wysihtml),function(n){n.commands.undo={exec:function(n){return n.undoManager.undo()},state:function(){return!1}}}(wysihtml),function(n){var r=90,f=89,e=8,o=46,s=25,i="data-wysihtml-selection-node",t="data-wysihtml-selection-offset",h='<span id="_wysihtml-undo" class="_wysihtml-temp">'+n.INVISIBLE_SPACE+"<\/span>",c='<span id="_wysihtml-redo" class="_wysihtml-temp">'+n.INVISIBLE_SPACE+"<\/span>",u=n.dom;n.UndoManager=n.lang.Dispatcher.extend({constructor:function(n){this.editor=n;this.composer=n.composer;this.element=this.composer.element;this.position=0;this.historyStr=[];this.historyDom=[];this.transact();this._observe()},_observe:function(){var n=this,i=this.composer.sandbox.getDocument(),t;u.observe(this.element,"keydown",function(t){if(!t.altKey&&(t.ctrlKey||t.metaKey)){var i=t.keyCode,u=i===r&&!t.shiftKey,e=i===r&&t.shiftKey||i===f;u?(n.undo(),t.preventDefault()):e&&(n.redo(),t.preventDefault())}});u.observe(this.element,"keydown",function(i){var r=i.keyCode;r!==t&&(t=r,(r===e||r===o)&&n.transact())});this.editor.on("newword:composer",function(){n.transact()}).on("beforecommand:composer",function(){n.transact()})},transact:function(){var a=this.historyStr[this.position-1],e=this.composer.getValue(!1,!1),v=this.element.offsetWidth>0&&this.element.offsetHeight>0,u,f,h,r,o,c,l;e!==a&&(c=this.historyStr.length=this.historyDom.length=this.position,c>s&&(this.historyStr.shift(),this.historyDom.shift(),this.position--),this.position++,v&&(u=this.composer.selection.getRange(),f=u&&u.startContainer?u.startContainer:this.element,h=u&&u.startOffset?u.startOffset:0,f.nodeType===n.ELEMENT_NODE?r=f:(r=f.parentNode,o=this.getChildNodeIndex(r,f)),r.setAttribute(t,h),typeof o!="undefined"&&r.setAttribute(i,o)),l=this.element.cloneNode(!!e),this.historyDom.push(l),this.historyStr.push(e),r&&(r.removeAttribute(t),r.removeAttribute(i)))},undo:function(){(this.transact(),this.undoPossible())&&(this.set(this.historyDom[--this.position-1]),this.editor.fire("undo:composer"))},redo:function(){this.redoPossible()&&(this.set(this.historyDom[++this.position-1]),this.editor.fire("redo:composer"))},undoPossible:function(){return this.position>1},redoPossible:function(){return this.position<this.historyStr.length},set:function(n){var e,r,u;this.element.innerHTML="";for(var f=0,o=n.childNodes,s=n.childNodes.length;f<s;f++)this.element.appendChild(o[f].cloneNode(!0));n.hasAttribute(t)?(e=n.getAttribute(t),u=n.getAttribute(i),r=this.element):(r=this.element.querySelector("["+t+"]")||this.element,e=r.getAttribute(t),u=r.getAttribute(i),r.removeAttribute(t),r.removeAttribute(i));u!==null&&(r=this.getChildNodeByIndex(r,+u));this.composer.selection.set(r,e)},getChildNodeIndex:function(n,t){for(var i=0,r=n.childNodes,u=r.length;i<u;i++)if(r[i]===t)return i},getChildNodeByIndex:function(n,t){return n.childNodes[t]}})}(wysihtml);wysihtml.views.View=Base.extend({constructor:function(n,t,i){this.parent=n;this.element=t;this.config=i;this.config.noTextarea||this._observeViewChange()},_observeViewChange:function(){var n=this;this.parent.on("beforeload",function(){n.parent.on("change_view",function(t){t===n.name?(n.parent.currentView=n,n.show(),setTimeout(function(){n.focus()},0)):n.hide()})})},focus:function(){if(!this.element||!this.element.ownerDocument||this.element.ownerDocument.querySelector(":focus")!==this.element)try{this.element&&this.element.focus()}catch(n){}},hide:function(){this.element.style.display="none"},show:function(){this.element.style.display=""},disable:function(){this.element.setAttribute("disabled","disabled")},enable:function(){this.element.removeAttribute("disabled")}}),function(n){var t=n.dom,i=n.browser;n.views.Composer=n.views.View.extend({name:"composer",constructor:function(n,t,i){this.base(n,t,i);this.config.noTextarea?this.editableArea=t:this.textarea=this.parent.textarea;this.config.contentEditableMode?this._initContentEditableArea():this._initSandbox()},clear:function(){this.element.innerHTML=i.displaysCaretInEmptyContentEditableCorrectly()?"":"<br>"},getValue:function(t,i){var r=this.isEmpty()?"":n.quirks.getCorrectInnerHTML(this.element);return t!==!1&&(r=this.parent.parse(r,i===!1?!1:!0)),r},setValue:function(n,t){t!==!1&&(n=this.parent.parse(n));try{this.element.innerHTML=n}catch(i){this.element.innerText=n}},cleanUp:function(n){var t;this.selection&&this.selection.isInThisEditable()&&(t=rangy.saveSelection(this.win));this.parent.parse(this.element,undefined,n);t&&rangy.restoreSelection(t)},show:function(){this.editableArea.style.display=this._displayStyle||"";this.config.noTextarea||this.textarea.element.disabled||(this.disable(),this.enable())},hide:function(){this._displayStyle=t.getStyle("display").from(this.editableArea);this._displayStyle==="none"&&(this._displayStyle=null);this.editableArea.style.display="none"},disable:function(){this.parent.fire("disable:composer");this.element.removeAttribute("contentEditable")},enable:function(){this.parent.fire("enable:composer");this.element.setAttribute("contentEditable","true")},focus:function(t){n.browser.doesAsyncFocus()&&this.hasPlaceholderSet()&&this.clear();this.base();var i=this.element.lastChild;t&&i&&this.selection&&(i.nodeName==="BR"?this.selection.setBefore(this.element.lastChild):this.selection.setAfter(this.element.lastChild))},getScrollPos:function(){if(this.doc&&this.win){var n={};return n.y=typeof this.win.pageYOffset!="undefined"?this.win.pageYOffset:(this.doc.documentElement||this.doc.body.parentNode||this.doc.body).scrollTop,n.x=typeof this.win.pageXOffset!="undefined"?this.win.pageXOffset:(this.doc.documentElement||this.doc.body.parentNode||this.doc.body).scrollLeft,n}},setScrollPos:function(n){n&&typeof n.x!="undefined"&&typeof n.y!="undefined"&&this.win.scrollTo(n.x,n.y)},getTextContent:function(){return t.getTextContent(this.element)},hasPlaceholderSet:function(){return this.getTextContent()==(this.config.noTextarea?this.editableArea.getAttribute("data-placeholder"):this.textarea.element.getAttribute("placeholder"))&&this.placeholderSet},isEmpty:function(){var n=this.element.innerHTML.toLowerCase();return/^(\s|<br>|<\/br>|<p>|<\/p>)*$/i.test(n)||n===""||n==="<br>"||n==="<p><\/p>"||n==="<p><br><\/p>"||this.hasPlaceholderSet()},_initContentEditableArea:function(){var n=this;this.config.noTextarea?this.sandbox=new t.ContentEditableArea(function(){n._create()},{className:this.config.classNames.sandbox},this.editableArea):(this.sandbox=new t.ContentEditableArea(function(){n._create()},{className:this.config.classNames.sandbox}),this.editableArea=this.sandbox.getContentEditable(),t.insert(this.editableArea).after(this.textarea.element),this._createWysiwygFormField())},_initSandbox:function(){var i=this,n;this.sandbox=new t.Sandbox(function(){i._create()},{stylesheets:this.config.stylesheets,className:this.config.classNames.sandbox});this.editableArea=this.sandbox.getIframe();n=this.textarea.element;t.insert(this.editableArea).after(n);this._createWysiwygFormField()},_createWysiwygFormField:function(){if(this.textarea.element.form){var n=document.createElement("input");n.type="hidden";n.name="_wysihtml_mode";n.value=1;t.insert(n).after(this.textarea.element)}},_create:function(){var f=this,r,u;this.doc=this.sandbox.getDocument();this.win=this.sandbox.getWindow();this.element=this.config.contentEditableMode?this.sandbox.getContentEditable():this.doc.body;this.config.noTextarea?this.cleanUp():(this.textarea=this.parent.textarea,this.element.innerHTML=this.textarea.getValue(!0,!1));this.selection=new n.Selection(this.parent,this.element,this.config.classNames.uneditableContainer);this.commands=new n.Commands(this.parent);this.config.noTextarea||t.copyAttributes(["className","spellcheck","title","lang","dir","accessKey"]).from(this.textarea.element).to(this.element);this._initAutoLinking();t.addClass(this.element,this.config.classNames.composer);this.config.style&&!this.config.contentEditableMode&&this.style();this.observe();r=this.config.name;r&&(t.addClass(this.element,r),this.config.contentEditableMode||t.addClass(this.editableArea,r));this.enable();!this.config.noTextarea&&this.textarea.element.disabled&&this.disable();u=typeof this.config.placeholder=="string"?this.config.placeholder:this.config.noTextarea?this.editableArea.getAttribute("data-placeholder"):this.textarea.element.getAttribute("placeholder");u&&t.simulatePlaceholder(this.parent,this,u,this.config.classNames.placeholder);this.commands.exec("styleWithCSS",!1);this._initObjectResizing();this._initUndoManager();this._initLineBreaking();this.config.noTextarea||!this.textarea.element.hasAttribute("autofocus")&&document.querySelector(":focus")!=this.textarea.element||i.isIos()||setTimeout(function(){f.focus(!0)},100);i.clearsContentEditableCorrectly()||n.quirks.ensureProperClearing(this);this.initSync&&this.config.sync&&this.initSync();this.config.noTextarea||this.textarea.hide();this.parent.fire("beforeload").fire("load")},_initAutoLinking:function(){var r=this,u=i.canDisableAutoLinking(),f=i.doesAutoLinkingInContentEditable();if(u&&this.commands.exec("AutoUrlDetect",!1,!1),this.config.autoLink){if(!f||f&&u){this.parent.on("newword:composer",function(){var i;if(t.getTextContent(r.element).match(t.autoLink.URL_REG_EXP)){var u=r.selection.getSelectedNode(),f=r.element.querySelectorAll("."+r.config.classNames.uneditableContainer),e=!1;for(i=f.length;i--;)n.dom.contains(f[i],u)&&(e=!0);e||t.autoLink(u,[r.config.classNames.uneditableContainer])}});t.observe(this.element,"blur",function(){t.autoLink(r.element,[r.config.classNames.uneditableContainer])})}var o=this.sandbox.getDocument().getElementsByTagName("a"),s=t.autoLink.URL_REG_EXP,e=function(i){var r=n.lang.string(t.getTextContent(i)).trim();return r.substr(0,4)==="www."&&(r="http://"+r),r};t.observe(this.element,"keydown",function(n){if(o.length){var f=r.selection.getSelectedNode(n.target.ownerDocument),i=t.getParentElement(f,{query:"a"},4),u;i&&(u=e(i),setTimeout(function(){var n=e(i);n!==u&&n.match(s)&&i.setAttribute("href",n)},0))}})}},_initObjectResizing:function(){if(this.commands.exec("enableObjectResizing",!0),i.supportsEvent("resizeend")){var r=["width","height"],f=r.length,u=this.element;t.observe(u,"resizeend",function(t){var e=t.target||t.srcElement,o=e.style,s=0,i;if(e.nodeName==="IMG"){for(;s<f;s++)i=r[s],o[i]&&(e.setAttribute(i,parseInt(o[i],10)),o[i]="");n.quirks.redraw(u)}})}},_initUndoManager:function(){this.undoManager=new n.UndoManager(this.parent)},_initLineBreaking:function(){function u(n){var i=t.getParentElement(n,{query:"p, div"},2);i&&t.contains(r.element,i)&&r.selection.executeAndRestoreRangy(function(){r.config.useLineBreaks?((!i.firstChild||i.firstChild===i.lastChild&&i.firstChild.nodeType===1&&i.firstChild.classList.contains("rangySelectionBoundary"))&&i.appendChild(r.doc.createElement("br")),t.replaceWithChildNodes(i)):i.nodeName!=="P"&&t.renameElement(i,"p")})}var r=this,f="li, p, h1, h2, h3, h4, h5, h6",e="ul, ol, menu";this.config.useLineBreaks||t.observe(this.element,["focus"],function(){r.isEmpty()&&setTimeout(function(){var n=r.doc.createElement("P");r.element.innerHTML="";r.element.appendChild(n);i.displaysCaretInEmptyContentEditableCorrectly()?r.selection.selectNode(n,!0):(n.innerHTML="<br>",r.selection.setBefore(n.firstChild))},0)});t.observe(this.element,"keydown",function(i){var o=i.keyCode,s;if(!i.shiftKey&&!i.ctrlKey&&!i.defaultPrevented&&(o===n.ENTER_KEY||o===n.BACKSPACE_KEY)){if(s=t.getParentElement(r.selection.getSelectedNode(),{query:f},4),s){setTimeout(function(){var i=r.selection.getSelectedNode(),f;if(s.nodeName==="LI"){if(!i)return;f=t.getParentElement(i,{query:e},2);f||u(i)}o===n.ENTER_KEY&&s.nodeName.match(/^H[1-6]$/)&&u(i)},0);return}r.config.useLineBreaks&&o===n.ENTER_KEY&&!n.browser.insertsLineBreaksOnReturn()&&(i.preventDefault(),r.commands.exec("insertLineBreak"))}})}})}(wysihtml),function(n){var t=n.dom,r=document,e=window,f=r.createElement("div"),i=["background-color","color","cursor","font-family","font-size","font-style","font-variant","font-weight","line-height","letter-spacing","text-align","text-decoration","text-indent","text-rendering","word-break","word-wrap","word-spacing"],u=["background-color","border-collapse","border-bottom-color","border-bottom-style","border-bottom-width","border-left-color","border-left-style","border-left-width","border-right-color","border-right-style","border-right-width","border-top-color","border-top-style","border-top-width","clear","display","float","margin-bottom","margin-left","margin-right","margin-top","outline-color","outline-offset","outline-width","outline-style","padding-left","padding-right","padding-top","padding-bottom","position","top","left","right","bottom","z-index","vertical-align","text-align","-webkit-box-sizing","-moz-box-sizing","-ms-box-sizing","box-sizing","-webkit-box-shadow","-moz-box-shadow","-ms-box-shadow","box-shadow","-webkit-border-top-right-radius","-moz-border-radius-topright","border-top-right-radius","-webkit-border-bottom-right-radius","-moz-border-radius-bottomright","border-bottom-right-radius","-webkit-border-bottom-left-radius","-moz-border-radius-bottomleft","border-bottom-left-radius","-webkit-border-top-left-radius","-moz-border-radius-topleft","border-top-left-radius","width","height"],s=["html                 { height: 100%; }","body                 { height: 100%; padding: 1px 0 0 0; margin: -1px 0 0 0; }","body > p:first-child { margin-top: 0; }","._wysihtml-temp     { display: none; }",n.browser.isGecko?"body.placeholder { color: graytext !important; }":"body.placeholder { color: #a9a9a9 !important; }","img:-moz-broken      { -moz-force-broken-image-icon: 1; height: 24px; width: 24px; }"],o=function(n){if(n.setActive)try{n.setActive()}catch(s){}else{var i=n.style,u=r.documentElement.scrollTop||r.body.scrollTop,f=r.documentElement.scrollLeft||r.body.scrollLeft,o={position:i.position,top:i.top,left:i.left,WebkitUserSelect:i.WebkitUserSelect};t.setStyles({position:"absolute",top:"-99999px",left:"-99999px",WebkitUserSelect:"none"}).on(n);n.focus();t.setStyles(o).on(n);e.scrollTo&&e.scrollTo(f,u)}};n.views.Composer.prototype.style=function(){var h=this,l=r.querySelector(":focus"),e=this.textarea.element,a=e.hasAttribute("placeholder"),p=a&&e.getAttribute("placeholder"),v=e.style.display,w=e.disabled,y,c;this.focusStylesHost=f.cloneNode(!1);this.blurStylesHost=f.cloneNode(!1);this.disabledStylesHost=f.cloneNode(!1);a&&e.removeAttribute("placeholder");e===l&&e.blur();e.disabled=!1;e.style.display=y="none";(e.getAttribute("rows")&&t.getStyle("height").from(e)==="auto"||e.getAttribute("cols")&&t.getStyle("width").from(e)==="auto")&&(e.style.display=y=v);t.copyStyles(u).from(e).to(this.editableArea).andTo(this.blurStylesHost);t.copyStyles(i).from(e).to(this.element).andTo(this.blurStylesHost);t.insertCSS(s).into(this.element.ownerDocument);e.disabled=!0;t.copyStyles(u).from(e).to(this.disabledStylesHost);t.copyStyles(i).from(e).to(this.disabledStylesHost);e.disabled=w;e.style.display=v;o(e);e.style.display=y;t.copyStyles(u).from(e).to(this.focusStylesHost);t.copyStyles(i).from(e).to(this.focusStylesHost);e.style.display=v;t.copyStyles(["display"]).from(e).to(this.editableArea);c=n.lang.array(u).without(["display"]);l?o(l):e.blur();a&&e.setAttribute("placeholder",p);this.parent.on("focus:composer",function(){t.copyStyles(c).from(h.focusStylesHost).to(h.editableArea);t.copyStyles(i).from(h.focusStylesHost).to(h.element)});this.parent.on("blur:composer",function(){t.copyStyles(c).from(h.blurStylesHost).to(h.editableArea);t.copyStyles(i).from(h.blurStylesHost).to(h.element)});return this.parent.observe("disable:composer",function(){t.copyStyles(c).from(h.disabledStylesHost).to(h.editableArea);t.copyStyles(i).from(h.disabledStylesHost).to(h.element)}),this.parent.observe("enable:composer",function(){t.copyStyles(c).from(h.blurStylesHost).to(h.editableArea);t.copyStyles(i).from(h.blurStylesHost).to(h.element)}),this}}(wysihtml),function(n){var u=n.dom,t=u.domNode,r=n.browser,e={"66":"bold","73":"italic","85":"underline"},i={addListeners:function(n,t,i){for(var r=0,u=t.length;r<u;r++)n.addEventListener(t[r],i,!1)},removeListeners:function(n,t,i){for(var r=0,u=t.length;r<u;r++)n.removeEventListener(t[r],i,!1)},fixLastBrDeletionInTable:function(t,i){var f,u,r;return t.selection.caretIsInTheEndOfNode()&&(f=t.selection.getSelection(),u=f.anchorNode,u&&u.nodeType===1&&(n.dom.getParentElement(u,{query:"td, th"},!1,t.element)||i)&&(r=u.childNodes[f.anchorOffset],r&&r.nodeType===1&r.nodeName==="BR"))?(r.parentNode.removeChild(r),!0):!1},handleUneditableDeletion:function(n){var t=n.selection.getBeforeSelection(!0),r;if(t&&(t.type==="element"||t.type==="leafnode")&&t.node.nodeType===1&&t.node.classList.contains(n.config.classNames.uneditableContainer)){if(i.fixLastBrDeletionInTable(n,!0))return!0;try{r=new CustomEvent("wysihtml:uneditable:delete",{bubbles:!0,cancelable:!1});t.node.dispatchEvent(r)}catch(u){}return t.node.parentNode.removeChild(t.node),!0}return!1},fixDeleteInTheBeginningOfBlock:function(i){var u=i.selection,r=u.getPreviousNode();if(u.caretIsFirstInSelection(n.browser.usesControlRanges())&&r&&r.nodeType===1&&n.dom.domNode(r).is.block()&&!t(r).test({query:"ol, ul, table, tr, dl"})){if(/^\s*$/.test(r.textContent||r.innerText))return r.parentNode.removeChild(r),!0;if(r.lastChild){var e=r.lastChild,f=u.getSelectedNode(),s=t(r).commonAncestor(f,i.element),o=n.dom.getParentElement(f,{query:"h1, h2, h3, h4, h5, h6, p, pre, div, blockquote"},!1,s||i.element);if(o)return t(o).transferContentTo(r,!0),u.setAfter(e),!0;if(n.browser.usesControlRanges())return f=u.getCaretNode(),t(f).transferContentTo(r,!0),u.setAfter(e),!0}}return!1},fixDeleteInTheBeginningOfLi:function(i){if(n.browser.hasLiDeletingProblem()){var o=i.selection.getSelection(),r=o.anchorNode,e,s=i.selection.caretIsFirstInSelection(),u,f;if(r.nodeType===3&&o.anchorOffset===0&&r===r.parentNode.firstChild&&(r=r.parentNode,s=!0),s&&r&&r.nodeType===1&&r.nodeName==="LI"&&(u=t(r).prev({nodeTypes:[1,3],ignoreBlankTexts:!0}),!u&&r.parentNode&&(r.parentNode.nodeName==="UL"||r.parentNode.nodeName==="OL")&&(u=t(r.parentNode).prev({nodeTypes:[1,3],ignoreBlankTexts:!0}),f=r.parentNode),u))return e=r.firstChild,t(r).transferContentTo(u,!0),f&&f.children.length===0&&f.remove(),e?i.selection.setBefore(e):u&&(u.nodeType===1?u.lastChild?i.selection.setAfter(u.lastChild):i.selection.selectNode(u):i.selection.setAfter(u)),!0}return!1},fixDeleteInTheBeginningOfControlSelection:function(n){var r=n.selection,f=r.getPreviousNode(),i=r.getSelectedNode(),u;return r.caretIsFirstInSelection()?(i.nodeType===3&&(i=i.parentNode),u=i.firstChild,t(i).transferContentTo(f,!0),u&&n.selection.setBefore(u),!0):!1},doLineBreaksModeEnterWithCaret:function(i){var r,f,o=!1,e;if(r=i.selection.getNodesNearCaret(),r&&((r.caretNode||r.nextNode)&&(f=u.getParentElement(r.caretNode||r.nextNode,{query:"p, pre, div, blockquote"},2),f===i.element&&(f=undefined)),f&&r.caretNode))if(t(r.caretNode).is.lineBreak())i.config.doubleLineBreakEscapesBlock&&(o=!0,r.caretNode.parentNode.removeChild(r.caretNode),t(r.nextNode).is.lineBreak()&&r.nextNode.parentNode.removeChild(r.nextNode),e=i.doc.createElement("br"),t(r.nextNode).is.lineBreak()&&r.nextNode===f.lastChild?f.parentNode.insertBefore(e,f.nextSibling):i.selection.splitElementAtCaret(f,e),r.nextNode&&r.nextNode.nodeType===3&&(r.nextNode.data=r.nextNode.data.replace(/^ *[\r\n]+/,"")),i.selection.setBefore(e));else if(r.caretNode.nodeType===3&&n.browser.hasCaretBlockElementIssue()&&r.textOffset===r.caretNode.data.length&&!r.nextNode){o=!0;var c=i.doc.createElement("br"),h=i.doc.createElement("br"),s=i.doc.createDocumentFragment();s.appendChild(c);s.appendChild(h);i.selection.insertNode(s);i.selection.setBefore(h)}return o}},o=function(t,r){var u=r.selection,f=r.element;if(u.isCollapsed()){if(r.isEmpty()&&!r.config.useLineBreaks){t.preventDefault();return}if(i.handleUneditableDeletion(r)){t.preventDefault();return}if(i.fixDeleteInTheBeginningOfLi(r)){t.preventDefault();return}if(i.fixDeleteInTheBeginningOfBlock(r)){t.preventDefault();return}if(i.fixLastBrDeletionInTable(r)){t.preventDefault();return}if(n.browser.usesControlRanges()&&i.fixDeleteInTheBeginningOfControlSelection(r)){t.preventDefault();return}}else u.containsUneditable()&&(t.preventDefault(),u.deleteContents())},s=function(n,t){var e,u,f;!t.config.useLineBreaks||n.shiftKey||n.ctrlKey||(e="p, pre, div, blockquote",t.selection.isCollapsed()&&i.doLineBreaksModeEnterWithCaret(t)&&n.preventDefault());r.hasCaretAtLinkEndInsertionProblems()&&t.selection.caretIsInTheEndOfNode()&&(u=t.selection.getSelectedNode(!0),f=u&&u.nodeType===3?u.parentNode:u,f&&f.closest("a")&&u.nodeType===3&&u===f.lastChild&&t.selection.setAfter(f))},h=function(n,t,i){if(n.selection.isCollapsed()){if(n.selection.caretIsInTheBeginnig("li"))if(i){if(n.commands.exec("outdentList"))return}else if(n.commands.exec("indentList"))return}else n.selection.deleteContents();n.commands.exec("insertHTML","&emsp;")},f=function(){this.domNodeRemovedInterval&&clearInterval(domNodeRemovedInterval);this.parent.fire("destroy:composer")},c=function(n){this.parent.fire("beforeinteraction",n).fire("beforeinteraction:composer",n);setTimeout(function(){this.parent.fire("interaction",n).fire("interaction:composer",n)}.bind(this),0)},l=function(n){this.parent.fire("focus",n).fire("focus:composer",n);setTimeout(function(){this.focusState=this.getValue(!1,!1)}.bind(this),0)},a=function(n){if(this.focusState!==this.getValue(!1,!1)){var t=n;typeof Object.create=="function"&&(t=Object.create(n,{type:{value:"change"}}));this.parent.fire("change",t).fire("change:composer",t)}this.parent.fire("blur",n).fire("blur:composer",n)},v=function(n){this.parent.fire(n.type,n).fire(n.type+":composer",n);n.type==="paste"&&setTimeout(function(){this.parent.fire("newword:composer")}.bind(this),0)},y=function(t){this.config.copyedFromMarking&&(n.browser.supportsModernPaste()&&(t.clipboardData.setData("text/html",this.config.copyedFromMarking+this.selection.getHtml()),t.clipboardData.setData("text/plain",this.selection.getPlainText()),t.preventDefault()),this.parent.fire(t.type,t).fire(t.type+":composer",t))},p=function(t){var i=t.keyCode;(i===n.SPACE_KEY||i===n.ENTER_KEY)&&this.parent.fire("newword:composer")},w=function(t){if(!r.canSelectImagesInContentEditable()){var i=t.target,u=this.element.querySelectorAll("img"),f=this.element.querySelectorAll("."+this.config.classNames.uneditableContainer+" img"),e=n.lang.array(u).without(f);i.nodeName==="IMG"&&n.lang.array(e).contains(i)&&this.selection.selectNode(i)}n.browser.usesControlRanges()&&(this.selection.lastMouseDownPos={x:t.clientX,y:t.clientY},setTimeout(function(){delete this.selection.lastMouseDownPos}.bind(this),0))},b=function(n){var r=n.target,t=this.selection.lastMouseDownPos,i;t&&(i=document.body.createTextRange(),setTimeout(function(){try{i.moveToPoint(t.x,t.y);i.select()}catch(n){}}.bind(this),0))},k=function(t){if(this.config.classNames.uneditableContainer){var i=n.dom.getParentElement(t.target,{query:"."+this.config.classNames.uneditableContainer},!1,this.element);i&&this.selection.setAfter(i)}},d=function(){r.canSelectImagesInContentEditable()||setTimeout(function(){this.selection.getSelection().removeAllRanges()}.bind(this),0)},g=function(t){var r=t.keyCode,f=e[r],i=this.selection.getSelectedNode(!0),c=i&&i.nodeType===3?i.parentNode:i,u;if((t.ctrlKey||t.metaKey)&&!t.altKey&&r===65){this.selection.selectAll();t.preventDefault();return}(t.ctrlKey||t.metaKey)&&!t.altKey&&f&&(this.commands.exec(f),t.preventDefault());r===n.BACKSPACE_KEY&&o(t,this);(r===n.BACKSPACE_KEY||r===n.DELETE_KEY)&&i&&i.nodeName==="IMG"&&(t.preventDefault(),u=i.parentNode,u.removeChild(i),u.nodeName!=="A"||u.firstChild||u.parentNode.removeChild(u),setTimeout(function(){n.quirks.redraw(this.element)}.bind(this),0));this.config.handleTabKey&&r===n.TAB_KEY&&(t.preventDefault(),h(this,this.element,t.shiftKey));r===n.ENTER_KEY&&s(t,this)},nt=function(t){if(t.which!==0&&this.selection.caretIsInTheEndOfNode()){var i=this.selection.getSelectedNode(!0),f=i&&i.nodeType===3?i.parentNode:i,u,e;f&&f.closest("a")&&i===f.lastChild&&(t.which!==32||this.selection.caretIsInTheEndOfNode(!0)&&r.hasCaretAtLinkEndInsertionProblems()?(u=this.doc.createTextNode(n.INVISIBLE_SPACE),this.selection.insertNode(u),this.selection.setBefore(u),setTimeout(function(){u.textContent.length>1?(u.textContent=u.textContent.replace(n.INVISIBLE_SPACE_REG_EXP,""),this.selection.setAfter(u)):u.remove()}.bind(this),0)):t.which===32&&i.nodeType===3&&/[\u00A0 ]$/.test(i.textContent)&&(i.textContent=i.textContent.replace(/[\u00A0 ]$/,""),e=this.doc.createTextNode(" "),f.parentNode.insertBefore(e,f.nextSibling),this.selection.setAfter(e,!1),t.preventDefault()))}},tt=function(){setTimeout(function(){this.doc.querySelector(":focus")!==this.element&&this.focus()}.bind(this),0)},it=function(){setTimeout(function(){this.selection.getSelection().removeAllRanges()}.bind(this),0)};n.views.Composer.prototype.observeActions=i;n.views.Composer.prototype.observe=function(){var o=this,e=this.sandbox.getIframe?this.sandbox.getIframe():this.sandbox.getContentEditable(),s=this.element,t=r.supportsEventsInIframeCorrectly()||this.sandbox.getContentEditable?this.element:this.sandbox.getWindow();this.focusState=this.getValue(!1,!1);this.actions=i;e.addEventListener(["DOMNodeRemoved"],f.bind(this),!1);r.supportsMutationEvents()||(this.domNodeRemovedInterval=setInterval(function(){u.contains(document.documentElement,e)||f.call(this)},250));i.addListeners(t,["drop","paste","mouseup","focus","keyup"],c.bind(this));t.addEventListener("focus",l.bind(this),!1);t.addEventListener("blur",a.bind(this),!1);i.addListeners(this.element,["drop","paste","beforepaste"],v.bind(this),!1);this.element.addEventListener("copy",y.bind(this),!1);this.element.addEventListener("mousedown",w.bind(this),!1);this.element.addEventListener("click",k.bind(this),!1);this.element.addEventListener("drop",d.bind(this),!1);this.element.addEventListener("keyup",p.bind(this),!1);this.element.addEventListener("keydown",g.bind(this),!1);this.element.addEventListener("keypress",nt.bind(this),!1);n.browser.usesControlRanges()&&this.element.addEventListener("mscontrolselect",b.bind(this),!1);this.element.addEventListener("dragenter",function(){this.parent.fire("unset_placeholder")}.bind(this),!1)}}(wysihtml),function(n){var t=400;n.views.Synchronizer=Base.extend({constructor:function(n,t,i){this.editor=n;this.textarea=t;this.composer=i;this._observe()},fromComposerToTextarea:function(t){this.textarea.setValue(n.lang.string(this.composer.getValue(!1,!1)).trim(),t)},fromTextareaToComposer:function(n){var t=this.textarea.getValue(!1,!1);t?this.composer.setValue(t,n):(this.composer.clear(),this.editor.fire("set_placeholder"))},sync:function(n){this.editor.currentView.name==="textarea"?this.fromTextareaToComposer(n):this.fromComposerToTextarea(n)},_observe:function(){var r,i=this,u=this.textarea.element.form,f=function(){r=setInterval(function(){i.fromComposerToTextarea()},t)},e=function(){clearInterval(r);r=null};f();u&&(n.dom.observe(u,"submit",function(){i.sync(!0)}),n.dom.observe(u,"reset",function(){setTimeout(function(){i.fromTextareaToComposer()},0)}));this.editor.on("change_view",function(n){n!=="composer"||r?n==="textarea"&&(i.fromComposerToTextarea(!0),e()):(i.fromTextareaToComposer(!0),f())});this.editor.on("destroy:composer",e)}})}(wysihtml),function(n){n.views.SourceView=Base.extend({constructor:function(n,t){this.editor=n;this.composer=t;this._observe()},switchToTextarea:function(n){var t=this.composer.win.getComputedStyle(this.composer.element),i=parseFloat(t.width),r=Math.max(parseFloat(t.height),100);this.textarea||(this.textarea=this.composer.doc.createElement("textarea"),this.textarea.className="wysihtml-source-view");this.textarea.style.width=i+"px";this.textarea.style.height=r+"px";this.textarea.value=this.editor.getValue(n,!0);this.composer.element.parentNode.insertBefore(this.textarea,this.composer.element);this.editor.currentView="source";this.composer.element.style.display="none"},switchToComposer:function(n){var t=this.textarea.value;t?this.composer.setValue(t,n):(this.composer.clear(),this.editor.fire("set_placeholder"));this.textarea.parentNode.removeChild(this.textarea);this.editor.currentView=this.composer;this.composer.element.style.display=""},_observe:function(){this.editor.on("change_view",function(n){n==="composer"?this.switchToComposer(!0):n==="textarea"&&this.switchToTextarea(!0)}.bind(this))}})}(wysihtml);wysihtml.views.Textarea=wysihtml.views.View.extend({name:"textarea",constructor:function(n,t,i){this.base(n,t,i);this._observe()},clear:function(){this.element.value=""},getValue:function(n){var t=this.isEmpty()?"":this.element.value;return n!==!1&&(t=this.parent.parse(t)),t},setValue:function(n,t){t!==!1&&(n=this.parent.parse(n));this.element.value=n},cleanUp:function(n){var t=this.parent.parse(this.element.value,undefined,n);this.element.value=t},hasPlaceholderSet:function(){var t=wysihtml.browser.supportsPlaceholderAttributeOn(this.element),i=this.element.getAttribute("placeholder")||null,n=this.element.value,r=!n;return t&&r||n===i},isEmpty:function(){return!wysihtml.lang.string(this.element.value).trim()||this.hasPlaceholderSet()},_observe:function(){var t=this.element,n=this.parent,i={focusin:"focus",focusout:"blur"},r=wysihtml.browser.supportsEvent("focusin")?["focusin","focusout","change"]:["focus","blur","change"];n.on("beforeload",function(){wysihtml.dom.observe(t,r,function(t){var r=i[t.type]||t.type;n.fire(r).fire(r+":textarea")});wysihtml.dom.observe(t,["paste","drop"],function(){setTimeout(function(){n.fire("paste").fire("paste:textarea")},0)})})}}),function(n){var t;n.Editor=n.lang.Dispatcher.extend({defaults:{name:t,style:!0,autoLink:!0,handleTabKey:!0,parserRules:{tags:{br:{},span:{},div:{},p:{},b:{},i:{},u:{}},classes:{}},pasteParserRulesets:null,parser:n.dom.parse,useLineBreaks:!0,doubleLineBreakEscapesBlock:!0,stylesheets:[],placeholderText:t,supportTouchDevices:!0,cleanUp:!0,contentEditableMode:!1,classNames:{composer:"wysihtml-editor",body:"wysihtml-supported",sandbox:"wysihtml-sandbox",placeholder:"wysihtml-placeholder",uneditableContainer:"wysihtml-uneditable-container"},copyedFromMarking:'<meta name="copied-from" content="wysihtml">'},constructor:function(t,i){if(this.editableElement=typeof t=="string"?document.getElementById(t):t,this.config=n.lang.object({}).merge(this.defaults).merge(i).get(),this._isCompatible=n.browser.supported(),i&&i.classNames&&n.lang.object(this.config.classNames).merge(i.classNames),this.editableElement.nodeName.toLowerCase()!="textarea"&&(this.config.contentEditableMode=!0,this.config.noTextarea=!0),this.config.noTextarea||(this.textarea=new n.views.Textarea(this,this.editableElement,this.config),this.currentView=this.textarea),!this._isCompatible||!this.config.supportTouchDevices&&n.browser.isTouchDevice()){var r=this;setTimeout(function(){r.fire("beforeload").fire("load")},0);return}n.dom.addClass(document.body,this.config.classNames.body);this.composer=new n.views.Composer(this,this.editableElement,this.config);this.currentView=this.composer;typeof this.config.parser=="function"&&this._initParser();this.on("beforeload",this.handleBeforeLoad)},handleBeforeLoad:function(){this.config.noTextarea?this.sourceView=new n.views.SourceView(this,this.composer):this.synchronizer=new n.views.Synchronizer(this,this.textarea,this.composer);this.runEditorExtenders()},runEditorExtenders:function(){n.editorExtenders.forEach(function(n){n(this)}.bind(this))},isCompatible:function(){return this._isCompatible},clear:function(){return this.currentView.clear(),this},getValue:function(n,t){return this.currentView.getValue(n,t)},setValue:function(n,t){return(this.fire("unset_placeholder"),!n)?this.clear():(this.currentView.setValue(n,t),this)},cleanUp:function(n){this.currentView.cleanUp(n)},focus:function(n){return this.currentView.focus(n),this},disable:function(){return this.currentView.disable(),this},enable:function(){return this.currentView.enable(),this},isEmpty:function(){return this.currentView.isEmpty()},hasPlaceholderSet:function(){return this.currentView.hasPlaceholderSet()},destroy:function(){this.composer&&this.composer.sandbox&&this.composer.sandbox.destroy();this.fire("destroy:composer");this.off()},parse:function(t,i,r){var u=this.config.contentEditableMode?document:this.composer?this.composer.sandbox.getDocument():null,f=this.config.parser(t,{rules:r||this.config.parserRules,cleanUp:this.config.cleanUp,context:u,uneditableClass:this.config.classNames.uneditableContainer,clearInternals:i});return typeof t=="object"&&n.quirks.redraw(t),f},_initParser:function(){var t;if(n.browser.supportsModernPaste())this.on("paste:composer",function(i){i.preventDefault();t=n.dom.getPastedHtml(i);t&&this._cleanAndPaste(t)}.bind(this));else this.on("beforepaste:composer",function(t){t.preventDefault();var i=this.composer.getScrollPos();n.dom.getPastedHtmlWithDiv(this.composer,function(n){n&&this._cleanAndPaste(n);this.composer.setScrollPos(i)}.bind(this))}.bind(this))},_cleanAndPaste:function(t){var i=n.quirks.cleanPastedHTML(t,{referenceNode:this.composer.element,rules:this.config.pasteParserRulesets||[{set:this.config.parserRules}],uneditableClass:this.config.classNames.uneditableContainer});this.composer.selection.deleteContents();this.composer.selection.insertHTML(i)}})}(wysihtml),function(n){var t=n.dom,i="wysihtml-command-dialog-opened",f="input, select, textarea",r="[data-wysihtml-dialog-field]",u="data-wysihtml-dialog-field";n.toolbar.Dialog=n.lang.Dispatcher.extend({constructor:function(n,t){this.link=n;this.container=t},_observe:function(){if(!this._observed){var r=this,u=function(n){var t=r._serialize();r.fire("save",t);r.hide();n.preventDefault();n.stopPropagation()};t.observe(r.link,"click",function(){t.hasClass(r.link,i)&&setTimeout(function(){r.hide()},0)});t.observe(this.container,"keydown",function(t){var i=t.keyCode;i===n.ENTER_KEY&&u(t);i===n.ESCAPE_KEY&&r.cancel()});t.delegate(this.container,"[data-wysihtml-dialog-action=save]","click",u);t.delegate(this.container,"[data-wysihtml-dialog-action=cancel]","click",function(n){r.cancel();n.preventDefault();n.stopPropagation()});this._observed=!0}},_serialize:function(){for(var i={},t=this.container.querySelectorAll(r),f=t.length,n=0;n<f;n++)i[t[n].getAttribute(u)]=t[n].value;return i},_interpolate:function(n){for(var t,f,e,s=document.querySelector(":focus"),o=this.container.querySelectorAll(r),h=o.length,i=0;i<h;i++)(t=o[i],t!==s)&&(n&&t.type==="hidden"||(f=t.getAttribute(u),e=this.elementToChange&&typeof this.elementToChange!="boolean"?this.elementToChange.getAttribute(f)||"":t.defaultValue,t.value=e))},update:function(n){this.elementToChange=n?n:this.elementToChange;this._interpolate()},show:function(n){var r=this.container.querySelector(f);if(this._observe(),this.update(n),t.addClass(this.link,i),this.container.style.display="",this.isOpen=!0,this.fire("show"),r&&!n)try{r.focus()}catch(u){}},_hide:function(){this.elementToChange=null;t.removeClass(this.link,i);this.container.style.display="none";this.isOpen=!1},hide:function(){this._hide();this.fire("hide")},cancel:function(){this._hide();this.fire("cancel")}})}(wysihtml),function(n){var r=n.dom,t="[data-wysihtml-dialog-field]",i="data-wysihtml-dialog-field";n.toolbar.Dialog_bgColorStyle=n.toolbar.Dialog.extend({multiselect:!0,_serialize:function(){for(var u={},r=this.container.querySelectorAll(t),f=r.length,n=0;n<f;n++)u[r[n].getAttribute(i)]=r[n].value;return u},_interpolate:function(r){for(var f,c=document.querySelector(":focus"),o=this.container.querySelectorAll(t),l=o.length,e=0,s=this.elementToChange?n.lang.object(this.elementToChange).isArray()?this.elementToChange[0]:this.elementToChange:null,h=s?s.getAttribute("style"):null,u=h?n.quirks.styleParser.parseColor(h,"background-color"):null;e<l;e++)(f=o[e],f!==c)&&(r&&f.type==="hidden"||f.getAttribute(i)==="color"&&(f.value=u?u[3]&&u[3]!=1?"rgba("+u[0]+","+u[1]+","+u[2]+","+u[3]+");":"rgb("+u[0]+","+u[1]+","+u[2]+");":"rgb(0,0,0);"))}})}(wysihtml),function(n){n.toolbar.Dialog_createTable=n.toolbar.Dialog.extend({show:function(n){this.base(n)}})}(wysihtml),function(n){var t=n.dom;n.toolbar.Dialog_fontSizeStyle=n.toolbar.Dialog.extend({multiselect:!0,_serialize:function(){return{size:this.container.querySelector('[data-wysihtml-dialog-field="size"]').value}},_interpolate:function(){var f=document.querySelector(":focus"),t=this.container.querySelector("[data-wysihtml-dialog-field='size']"),r=this.elementToChange?n.lang.object(this.elementToChange).isArray()?this.elementToChange[0]:this.elementToChange:null,u=r?r.getAttribute("style"):null,i=u?n.quirks.styleParser.parseFontSize(u):null;t&&t!==f&&i&&!/^\s*$/.test(i)&&(t.value=i)}})}(wysihtml),function(n){var t="[data-wysihtml-dialog-field]",i="data-wysihtml-dialog-field";n.toolbar.Dialog_foreColorStyle=n.toolbar.Dialog.extend({multiselect:!0,_serialize:function(){for(var u={},r=this.container.querySelectorAll(t),f=r.length,n=0;n<f;n++)u[r[n].getAttribute(i)]=r[n].value;return u},_interpolate:function(r){for(var u,f,e=n.quirks.styleParser,a=document.querySelector(":focus"),s=this.container.querySelectorAll(t),v=s.length,o=0,h=this.elementToChange?n.lang.object(this.elementToChange).isArray()?this.elementToChange[0]:this.elementToChange:null,c=h?h.getAttribute("style"):null,l=c?e.parseColor(c,"color"):null;o<v;o++)(u=s[o],u!==a)&&(r&&u.type==="hidden"||u.getAttribute(i)==="color"&&(f=(u.dataset.colormode||"rgb").toLowerCase(),f=f==="hex"?"hash":f,u.value=l?e.unparseColor(l,f):e.unparseColor([0,0,0],f)))}})}(wysihtml),function(n){var t=n.dom,u={position:"relative"},i={left:0,margin:0,opacity:0,overflow:"hidden",padding:0,position:"absolute",top:0,zIndex:1},f={cursor:"inherit",fontSize:"50px",height:"50px",marginTop:"-25px",outline:0,padding:0,position:"absolute",right:"-4px",top:"50%"},r={"x-webkit-speech":"",speech:""};n.toolbar.Speech=function(e,o){var s=document.createElement("input"),c,h,l;if(!n.browser.supportsSpeechApiOn(s)){o.style.display="none";return}c=e.editor.textarea.element.getAttribute("lang");c&&(r.lang=c);h=document.createElement("div");n.lang.object(i).merge({width:o.offsetWidth+"px",height:o.offsetHeight+"px"});t.insert(s).into(h);t.insert(h).into(o);t.setStyles(f).on(s);t.setAttributes(r).on(s);t.setStyles(i).on(h);t.setStyles(u).on(o);l="onwebkitspeechchange"in s?"webkitspeechchange":"speechchange";t.observe(s,l,function(){e.execCommand("insertText",s.value);s.value=""});t.observe(s,"click",function(n){t.hasClass(o,"wysihtml-command-disabled")&&n.preventDefault();n.stopPropagation()})}}(wysihtml),function(n){function e(t,i){var r=t.commands.state(i.name,i.value);return!i.dialog.multiselect&&n.lang.object(r).isArray()&&(r=r.length===1?r[0]:!0),r}var r="wysihtml-command-disabled",u="wysihtml-commands-disabled",i="wysihtml-command-active",f="wysihtml-action-active",t=n.dom;n.toolbar.Toolbar=Base.extend({constructor:function(t,e,o){this.editor=t;this.container=typeof e=="string"?document.getElementById(e):e;this.composer=t.composer;this._getLinks("command");this._getLinks("action");this._observe();o&&this.show();t.config.classNameCommandDisabled!=null&&(r=t.config.classNameCommandDisabled);t.config.classNameCommandsDisabled!=null&&(u=t.config.classNameCommandsDisabled);t.config.classNameCommandActive!=null&&(i=t.config.classNameCommandActive);t.config.classNameActionActive!=null&&(f=t.config.classNameActionActive);for(var h=this.container.querySelectorAll("[data-wysihtml-command=insertSpeech]"),c=h.length,s=0;s<c;s++)new n.toolbar.Speech(this,h[s])},_getLinks:function(t){for(var e=this[t+"Links"]=n.lang.array(this.container.querySelectorAll("[data-wysihtml-"+t+"]")).get(),c=e.length,u=0,l=this[t+"Mapping"]={},i,o,r,f,s,h;u<c;u++)i=e[u],r=i.getAttribute("data-wysihtml-"+t),f=i.getAttribute("data-wysihtml-"+t+"-value"),h=i.getAttribute("data-wysihtml-"+t+"-blank-value"),o=this.container.querySelector("[data-wysihtml-"+t+"-group='"+r+"']"),s=this._getDialog(i,r),l[r+":"+f]={link:i,group:o,name:r,value:f,tracksBlankValue:h,dialog:s,state:!1}},_getDialog:function(t,i){var r=this,f=this.container.querySelector("[data-wysihtml-dialog='"+i+"']"),e,u;if(f){e=n.toolbar["Dialog_"+i]?new n.toolbar["Dialog_"+i](t,f):new n.toolbar.Dialog(t,f);e.on("show",function(){u=r.composer.selection.getBookmark();r.editor.fire("show:dialog",{command:i,dialogContainer:f,commandLink:t})});e.on("save",function(n){u&&r.composer.selection.setBookmark(u);r._execCommand(i,n);r.editor.fire("save:dialog",{command:i,dialogContainer:f,commandLink:t});r._hideAllDialogs();r._preventInstantFocus();u=undefined});e.on("cancel",function(){u&&r.composer.selection.setBookmark(u);r.editor.fire("cancel:dialog",{command:i,dialogContainer:f,commandLink:t});u=undefined;r._preventInstantFocus()});e.on("hide",function(){r.editor.fire("hide:dialog",{command:i,dialogContainer:f,commandLink:t});u=undefined})}return e},execCommand:function(n,t){this.commandsDisabled||this._execCommand(n,t)},_execCommand:function(n,t){this.editor.focus(!1);this.composer.commands.exec(n,t);this._updateLinkStates()},execAction:function(n){var t=this.editor;n==="change_view"&&(t.currentView===t.textarea||t.currentView==="source"?t.fire("change_view","composer"):t.fire("change_view","textarea"));n=="showSource"&&t.fire("showSource")},_observe:function(){for(var i=this,o=this.editor,r=this.container,s=this.commandLinks.concat(this.actionLinks),h=s.length,f=0;f<h;f++)if(s[f].nodeName==="A")t.setAttributes({href:"javascript:;",unselectable:"on"}).on(s[f]);else t.setAttributes({unselectable:"on"}).on(s[f]);t.delegate(r,"[data-wysihtml-command], [data-wysihtml-action]","mousedown",function(n){n.preventDefault()});t.delegate(r,"[data-wysihtml-command]","click",function(n){var u,f=this,o=f.getAttribute("data-wysihtml-command"),t=f.getAttribute("data-wysihtml-command-value"),r=i.commandMapping[o+":"+t];t||!r.dialog?i.execCommand(o,t):(u=e(i.composer,r),r.dialog.show(u));n.preventDefault()});t.delegate(r,"[data-wysihtml-action]","click",function(n){var t=this.getAttribute("data-wysihtml-action");i.execAction(t);n.preventDefault()});o.on("interaction:composer",function(){i.preventFocus||i._updateLinkStates()});this._ownerDocumentClick=function(t){n.dom.contains(i.container,t.target)||n.dom.contains(i.composer.element,t.target)||(i._updateLinkStates(),i._preventInstantFocus())};this.container.ownerDocument.addEventListener("click",this._ownerDocumentClick,!1);this.editor.on("destroy:composer",this.destroy.bind(this));if(this.editor.config.handleTables){o.on("tableselect:composer",function(){i.container.querySelectorAll('[data-wysihtml-hiddentools="table"]')[0].style.display=""});o.on("tableunselect:composer",function(){i.container.querySelectorAll('[data-wysihtml-hiddentools="table"]')[0].style.display="none"})}o.on("change_view",function(n){setTimeout(function(){i.commandsDisabled=n!=="composer";i._updateLinkStates();i.commandsDisabled?t.addClass(r,u):t.removeClass(r,u)},0)})},destroy:function(){this.container.ownerDocument.removeEventListener("click",this._ownerDocumentClick,!1)},_hideAllDialogs:function(){var n=this.commandMapping;for(var t in n)n[t].dialog&&n[t].dialog.hide()},_preventInstantFocus:function(){this.preventFocus=!0;setTimeout(function(){this.preventFocus=!1}.bind(this),0)},_updateLinkStates:function(){var s,u,o,n,h,c=this.commandMapping,l=this.composer,a=this.actionMapping;for(s in c)(n=c[s],this.commandsDisabled?(u=!1,t.removeClass(n.link,i),n.group&&t.removeClass(n.group,i),n.dialog&&n.dialog.hide()):(u=this.composer.commands.state(n.name,n.value),t.removeClass(n.link,r),n.group&&t.removeClass(n.group,r)),n.state!==u||n.tracksBlankValue)&&(n.state=u,u?n.tracksBlankValue?t.removeClass(n.link,i):(t.addClass(n.link,i),n.group&&t.addClass(n.group,i),n.dialog&&(typeof n.value=="undefined"||n.value===null)&&(u&&typeof u=="object"?(u=e(l,n),n.state=u,h=n.dialog.container.dataset?n.dialog.container.dataset.showdialogonselection:!1,l.config.showToolbarDialogsOnSelection||h?n.dialog.show(u):n.dialog.update(u)):n.dialog.hide())):n.tracksBlankValue?t.addClass(n.link,i):(t.removeClass(n.link,i),n.group&&t.removeClass(n.group,i),n.dialog&&!n.value&&n.dialog.hide()));for(s in a)o=a[s],o.name==="change_view"&&(o.state=this.editor.currentView===this.editor.textarea||this.editor.currentView==="source",o.state?t.addClass(o.link,f):t.removeClass(o.link,f))},show:function(){this.container.style.display=""},hide:function(){this.container.style.display="none"}});n.Editor.prototype.defaults.toolbar=undefined;n.Editor.prototype.defaults.showToolbarAfterInit=!0;n.Editor.prototype.defaults.showToolbarDialogsOnSelection=!0;n.extendEditor(function(t){if(t.config.toolbar){t.toolbar=new n.toolbar.Toolbar(t,t.config.toolbar,t.config.showToolbarAfterInit);t.on("destroy:composer",function(){t&&t.toolbar&&t.toolbar.destroy()})}})}(wysihtml);wysihtml.commands.alignCenterStyle=function(){var n={styleProperty:"textAlign",styleValue:"center",toggle:!0};return{exec:function(t){return wysihtml.commands.formatBlock.exec(t,"formatBlock",n)},state:function(t){return wysihtml.commands.formatBlock.state(t,"formatBlock",n)}}}();wysihtml.commands.alignJustifyStyle=function(){var n={styleProperty:"textAlign",styleValue:"justify",toggle:!0};return{exec:function(t){return wysihtml.commands.formatBlock.exec(t,"formatBlock",n)},state:function(t){return wysihtml.commands.formatBlock.state(t,"formatBlock",n)}}}();wysihtml.commands.alignLeftStyle=function(){var n={styleProperty:"textAlign",styleValue:"left",toggle:!0};return{exec:function(t){return wysihtml.commands.formatBlock.exec(t,"formatBlock",n)},state:function(t){return wysihtml.commands.formatBlock.state(t,"formatBlock",n)}}}();wysihtml.commands.alignRightStyle=function(){var n={styleProperty:"textAlign",styleValue:"right",toggle:!0};return{exec:function(t){return wysihtml.commands.formatBlock.exec(t,"formatBlock",n)},state:function(t){return wysihtml.commands.formatBlock.state(t,"formatBlock",n)}}}();wysihtml.commands.bgColorStyle=function(){return{exec:function(n,t,i){var r=wysihtml.quirks.styleParser.parseColor("background-color:"+(i.color||i),"background-color"),u;r&&(u=(r[3]===1?"rgb("+[r[0],r[1],r[2]].join(", "):"rgba("+r.join(", "))+")",wysihtml.commands.formatInline.exec(n,t,{styleProperty:"backgroundColor",styleValue:u}))},state:function(n,t,i){var r=i?wysihtml.quirks.styleParser.parseColor("background-color:"+(i.color||i),"background-color"):null,u;return r&&(u=(r[3]===1?"rgb("+[r[0],r[1],r[2]].join(", "):"rgba("+r.join(", "))+")"),wysihtml.commands.formatInline.state(n,t,{styleProperty:"backgroundColor",styleValue:u})},remove:function(n,t){return wysihtml.commands.formatInline.remove(n,t,{styleProperty:"backgroundColor"})},stateValue:function(n,t,i){var r=this.state(n,t),u,f=!1;return(r&&wysihtml.lang.object(r).isArray()&&(r=r[0]),r&&(u=r.getAttribute("style"),u))?(f=wysihtml.quirks.styleParser.parseColor(u,"background-color"),wysihtml.quirks.styleParser.unparseColor(f,i)):!1}}}();wysihtml.commands.bold=function(){var n={nodeName:"B",toggle:!0};return{exec:function(t,i){wysihtml.commands.formatInline.exec(t,i,n)},state:function(t,i){return wysihtml.commands.formatInline.state(t,i,n)}}}();wysihtml.commands.formatCode=function(){return{exec:function(n,t,i){var r=this.state(n)[0],u,f,e;r?n.selection.executeAndRestore(function(){u=r.querySelector("code");wysihtml.dom.replaceWithChildNodes(r);u&&wysihtml.dom.replaceWithChildNodes(u)}):(f=n.selection.getRange(),e=f.extractContents(),r=n.doc.createElement("pre"),u=n.doc.createElement("code"),i&&(u.className=i),r.appendChild(u),u.appendChild(e),f.insertNode(r),n.selection.selectNode(r))},state:function(n){var t=n.selection.getSelectedNode(),i;return t&&t.nodeName&&t.nodeName=="PRE"&&t.firstChild&&t.firstChild.nodeName&&t.firstChild.nodeName=="CODE"?[t]:(i=wysihtml.dom.getParentElement(t,{query:"pre code"}),i?[i.parentNode]:!1)}}}();wysihtml.commands.insertImage=function(){var n="IMG";return{exec:function(t,i,r){var s,u,h,f,e,o;if(r=typeof r=="object"?r:{src:r},s=t.doc,u=this.state(t),u&&!r.src){t.selection.setBefore(u);f=u.parentNode;f.removeChild(u);wysihtml.dom.removeEmptyTextNodes(f);f.nodeName!=="A"||f.firstChild||(t.selection.setAfter(f),f.parentNode.removeChild(f));wysihtml.quirks.redraw(t.element);return}if(u){for(e in r)r.hasOwnProperty(e)&&u.setAttribute(e==="className"?"class":e,r[e]);return}u=s.createElement(n);for(o in r)u.setAttribute(o==="className"?"class":o,r[o]);t.selection.insertNode(u);wysihtml.browser.hasProblemsSettingCaretAfterImg()?(h=s.createTextNode(wysihtml.INVISIBLE_SPACE),t.selection.insertNode(h),t.selection.setAfter(h)):t.selection.setAfter(u)},state:function(t){var f=t.doc,i,r,u;return wysihtml.dom.hasElementWithTagName(f,n)?(i=t.selection.getSelectedNode(),!i)?!1:i.nodeName===n?i:i.nodeType!==wysihtml.ELEMENT_NODE?!1:(r=t.selection.getText(),r=wysihtml.lang.string(r).trim(),r)?!1:(u=t.selection.getNodes(wysihtml.ELEMENT_NODE,function(n){return n.nodeName==="IMG"}),u.length!==1)?!1:u[0]:!1}}}();wysihtml.commands.fontSize=function(){var n=/wysiwyg-font-size-[0-9a-z\-]+/g;return{exec:function(t,i,r){wysihtml.commands.formatInline.exec(t,i,{className:"wysiwyg-font-size-"+r,classRegExp:n,toggle:!0})},state:function(n,t,i){return wysihtml.commands.formatInline.state(n,t,{className:"wysiwyg-font-size-"+i})}}}();wysihtml.commands.fontSizeStyle=function(){return{exec:function(n,t,i){i=i.size||i;/^\s*$/.test(i)||wysihtml.commands.formatInline.exec(n,t,{styleProperty:"fontSize",styleValue:i,toggle:!1})},state:function(n,t,i){return wysihtml.commands.formatInline.state(n,t,{styleProperty:"fontSize",styleValue:i||undefined})},remove:function(n,t){return wysihtml.commands.formatInline.remove(n,t,{styleProperty:"fontSize"})},stateValue:function(n,t){var r,i=this.state(n,t);return(i&&wysihtml.lang.object(i).isArray()&&(i=i[0]),i&&(r=i.getAttribute("style"),r))?wysihtml.quirks.styleParser.parseFontSize(r):!1}}}();wysihtml.commands.foreColor=function(){var n=/wysiwyg-color-[0-9a-z]+/g;return{exec:function(t,i,r){wysihtml.commands.formatInline.exec(t,i,{className:"wysiwyg-color-"+r,classRegExp:n,toggle:!0})},state:function(n,t,i){return wysihtml.commands.formatInline.state(n,t,{className:"wysiwyg-color-"+i})}}}();wysihtml.commands.foreColorStyle=function(){return{exec:function(n,t,i){var r,u;i&&(r=wysihtml.quirks.styleParser.parseColor("color:"+(i.color||i),"color"),r&&(u=(r[3]===1?"rgb("+[r[0],r[1],r[2]].join(", "):"rgba("+r.join(", "))+")",wysihtml.commands.formatInline.exec(n,t,{styleProperty:"color",styleValue:u})))},state:function(n,t,i){var r=i?wysihtml.quirks.styleParser.parseColor("color:"+(i.color||i),"color"):null,u;return r&&(u=(r[3]===1?"rgb("+[r[0],r[1],r[2]].join(", "):"rgba("+r.join(", "))+")"),wysihtml.commands.formatInline.state(n,t,{styleProperty:"color",styleValue:u})},remove:function(n,t){return wysihtml.commands.formatInline.remove(n,t,{styleProperty:"color"})},stateValue:function(n,t,i){var r=this.state(n,t),u,f=!1;return(r&&wysihtml.lang.object(r).isArray()&&(r=r[0]),r&&(u=r.getAttribute("style"),u))?(f=wysihtml.quirks.styleParser.parseColor(u,"color"),wysihtml.quirks.styleParser.unparseColor(f,i)):!1}}}();wysihtml.commands.insertBlockQuote=function(){var n={nodeName:"BLOCKQUOTE",toggle:!0};return{exec:function(t){return wysihtml.commands.formatBlock.exec(t,"formatBlock",n)},state:function(t){return wysihtml.commands.formatBlock.state(t,"formatBlock",n)}}}();wysihtml.commands.insertHorizontalRule=function(){return{exec:function(n){var r=n.selection.getSelectedNode(),i=wysihtml.dom.getParentElement(r,{query:wysihtml.PERMITTED_PHRASING_CONTENT_ONLY},null,n.editableArea),t=document.createElement("hr");i?n.selection.splitElementAtCaret(i,t):n.selection.insertNode(t);t.nextSibling?n.selection.setBefore(t.nextSibling):n.selection.setAfter(t)},state:function(){return!1}}}();wysihtml.commands.insertOrderedList=function(){return{exec:function(n,t){wysihtml.commands.insertList.exec(n,t,"OL")},state:function(n,t){return wysihtml.commands.insertList.state(n,t,"OL")}}}();wysihtml.commands.insertUnorderedList=function(){return{exec:function(n,t){wysihtml.commands.insertList.exec(n,t,"UL")},state:function(n,t){return wysihtml.commands.insertList.state(n,t,"UL")}}}();wysihtml.commands.italic=function(){var n={nodeName:"I",toggle:!0};return{exec:function(t,i){wysihtml.commands.formatInline.exec(t,i,n)},state:function(t,i){return wysihtml.commands.formatInline.state(t,i,n)}}}();wysihtml.commands.justifyCenter=function(){var n={className:"wysiwyg-text-align-center",classRegExp:/wysiwyg-text-align-[0-9a-z]+/g,toggle:!0};return{exec:function(t){return wysihtml.commands.formatBlock.exec(t,"formatBlock",n)},state:function(t){return wysihtml.commands.formatBlock.state(t,"formatBlock",n)}}}();wysihtml.commands.justifyFull=function(){var n={className:"wysiwyg-text-align-justify",classRegExp:/wysiwyg-text-align-[0-9a-z]+/g,toggle:!0};return{exec:function(t){return wysihtml.commands.formatBlock.exec(t,"formatBlock",n)},state:function(t){return wysihtml.commands.formatBlock.state(t,"formatBlock",n)}}}();wysihtml.commands.justifyLeft=function(){var n={className:"wysiwyg-text-align-left",classRegExp:/wysiwyg-text-align-[0-9a-z]+/g,toggle:!0};return{exec:function(t){return wysihtml.commands.formatBlock.exec(t,"formatBlock",n)},state:function(t){return wysihtml.commands.formatBlock.state(t,"formatBlock",n)}}}();wysihtml.commands.justifyRight=function(){var n={className:"wysiwyg-text-align-right",classRegExp:/wysiwyg-text-align-[0-9a-z]+/g,toggle:!0};return{exec:function(t){return wysihtml.commands.formatBlock.exec(t,"formatBlock",n)},state:function(t){return wysihtml.commands.formatBlock.state(t,"formatBlock",n)}}}();wysihtml.commands.subscript=function(){var n={nodeName:"SUB",toggle:!0};return{exec:function(t,i){wysihtml.commands.formatInline.exec(t,i,n)},state:function(t,i){return wysihtml.commands.formatInline.state(t,i,n)}}}();wysihtml.commands.superscript=function(){var n={nodeName:"SUP",toggle:!0};return{exec:function(t,i){wysihtml.commands.formatInline.exec(t,i,n)},state:function(t,i){return wysihtml.commands.formatInline.state(t,i,n)}}}();wysihtml.commands.underline=function(){var n={nodeName:"U",toggle:!0};return{exec:function(t,i){wysihtml.commands.formatInline.exec(t,i,n)},state:function(t,i){return wysihtml.commands.formatInline.state(t,i,n)}}}();wysihtml.commands.addTableCells={exec:function(n,t,i){if(n.tableSelection&&n.tableSelection.start&&n.tableSelection.end){var r=wysihtml.dom.table.orderSelectionEnds(n.tableSelection.start,n.tableSelection.end);i=="before"||i=="above"?wysihtml.dom.table.addCells(r.start,i):(i=="after"||i=="below")&&wysihtml.dom.table.addCells(r.end,i);setTimeout(function(){n.tableSelection.select(r.start,r.end)},0)}},state:function(){return!1}};wysihtml.commands.createTable={exec:function(n,t,i){var u,f,r;if(i&&i.cols&&i.rows&&parseInt(i.cols,10)>0&&parseInt(i.rows,10)>0){for(r=i.tableStyle?'<table style="'+i.tableStyle+'">':"<table>",r+="<tbody>",f=0;f<i.rows;f++){for(r+="<tr>",u=0;u<i.cols;u++)r+="<td><br><\/td>";r+="<\/tr>"}r+="<\/tbody><\/table>";n.commands.exec("insertHTML",r)}},state:function(){return!1}};wysihtml.commands.deleteTableCells={exec:function(n,t,i){if(n.tableSelection&&n.tableSelection.start&&n.tableSelection.end){var e=wysihtml.dom.table.orderSelectionEnds(n.tableSelection.start,n.tableSelection.end),u=wysihtml.dom.table.indexOf(e.start),r,f=n.tableSelection.table;wysihtml.dom.table.removeCells(e.start,i);setTimeout(function(){r=wysihtml.dom.table.findCell(f,u);r||(i=="row"&&(r=wysihtml.dom.table.findCell(f,{row:u.row-1,col:u.col})),i=="column"&&(r=wysihtml.dom.table.findCell(f,{row:u.row,col:u.col-1})));r&&n.tableSelection.select(r,r)},0)}},state:function(){return!1}};wysihtml.commands.mergeTableCells={exec:function(n,t){n.tableSelection&&n.tableSelection.start&&n.tableSelection.end&&(this.state(n,t)?wysihtml.dom.table.unmergeCell(n.tableSelection.start):wysihtml.dom.table.mergeCellsBetween(n.tableSelection.start,n.tableSelection.end))},state:function(n){if(n.tableSelection){var t=n.tableSelection.start,i=n.tableSelection.end;if(t&&i&&t==i&&(wysihtml.dom.getAttribute(t,"colspan")&&parseInt(wysihtml.dom.getAttribute(t,"colspan"),10)>1||wysihtml.dom.getAttribute(t,"rowspan")&&parseInt(wysihtml.dom.getAttribute(t,"rowspan"),10)>1))return[t]}return!1}},function(){function f(n,t){for(var u,f=[],i,r=0,e=n.length;r<e;r++)if(i=n[r].querySelectorAll(t),i)for(u=i.length;u--;f.unshift(i[u]));return f}function r(n){n.parentNode.removeChild(n)}function i(n,t){n.parentNode.insertBefore(t,n.nextSibling)}function e(n,t){for(var i=n.nextSibling;i.nodeType!=1;)if(i=i.nextSibling,!t||t==i.tagName.toLowerCase())return i;return null}var n=wysihtml.dom,u=function(n){this.el=n;this.isColspan=!1;this.isRowspan=!1;this.firstCol=!0;this.lastCol=!0;this.firstRow=!0;this.lastRow=!0;this.isReal=!0;this.spanCollection=[];this.modified=!1},t=function(t,i){t?(this.cell=t,this.table=n.getParentElement(t,{query:"table"})):i&&(this.table=i,this.cell=this.table.querySelectorAll("th, td")[0])};t.prototype={addSpannedCellToMap:function(n,t,i,r,f,e){for(var s,h=[],c=i+(e?parseInt(e,10)-1:0),l=r+(f?parseInt(f,10)-1:0),o=i;o<=c;o++)for(typeof t[o]=="undefined"&&(t[o]=[]),s=r;s<=l;s++)t[o][s]=new u(n),t[o][s].isColspan=f&&parseInt(f,10)>1,t[o][s].isRowspan=e&&parseInt(e,10)>1,t[o][s].firstCol=s==r,t[o][s].lastCol=s==l,t[o][s].firstRow=o==i,t[o][s].lastRow=o==c,t[o][s].isReal=s==r&&o==i,t[o][s].spanCollection=h,h.push(t[o][s])},setCellAsModified:function(n){if(n.modified=!0,n.spanCollection.length>0)for(var t=0,i=n.spanCollection.length;t<i;t++)n.spanCollection[t].modified=!0},setTableMap:function(){for(var r=[],c=this.getTableRows(),l,s,o,f,i,e,h,t=0;t<c.length;t++)for(l=c[t],s=this.getRowCells(l),i=0,typeof r[t]=="undefined"&&(r[t]=[]),o=0;o<s.length;o++){for(f=s[o];typeof r[t][i]!="undefined";)i++;e=n.getAttribute(f,"colspan");h=n.getAttribute(f,"rowspan");e||h?(this.addSpannedCellToMap(f,r,t,i,e,h),i=i+(e?parseInt(e,10):1)):(r[t][i]=new u(f),i++)}return this.map=r,r},getRowCells:function(n){var t=this.table.querySelectorAll("table"),i=t?f(t,"th, td"):[],r=n.querySelectorAll("th, td");return i.length>0?wysihtml.lang.array(r).without(i):r},getTableRows:function(){var n=this.table.querySelectorAll("table"),t=n?f(n,"tr"):[],i=this.table.querySelectorAll("tr");return t.length>0?wysihtml.lang.array(i).without(t):i},getMapIndex:function(n){for(var t,r=this.map.length,u=this.map&&this.map[0]?this.map[0].length:0,i=0;i<r;i++)for(t=0;t<u;t++)if(this.map[i][t].el===n)return{row:i,col:t};return!1},getElementAtIndex:function(n){return(this.setTableMap(),this.map[n.row]&&this.map[n.row][n.col]&&this.map[n.row][n.col].el)?this.map[n.row][n.col].el:null},getMapElsTo:function(n){var r=[],u,f,t,e,i,o;if(this.setTableMap(),this.idx_start=this.getMapIndex(this.cell),this.idx_end=this.getMapIndex(n),(this.idx_start.row>this.idx_end.row||this.idx_start.row==this.idx_end.row&&this.idx_start.col>this.idx_end.col)&&(u=this.idx_start,this.idx_start=this.idx_end,this.idx_end=u),this.idx_start.col>this.idx_end.col&&(f=this.idx_start.col,this.idx_start.col=this.idx_end.col,this.idx_end.col=f),this.idx_start!=null&&this.idx_end!=null)for(t=this.idx_start.row,e=this.idx_end.row;t<=e;t++)for(i=this.idx_start.col,o=this.idx_end.col;i<=o;i++)r.push(this.map[t][i].el);return r},orderSelectionEnds:function(n){var t,i;return this.setTableMap(),this.idx_start=this.getMapIndex(this.cell),this.idx_end=this.getMapIndex(n),(this.idx_start.row>this.idx_end.row||this.idx_start.row==this.idx_end.row&&this.idx_start.col>this.idx_end.col)&&(t=this.idx_start,this.idx_start=this.idx_end,this.idx_end=t),this.idx_start.col>this.idx_end.col&&(i=this.idx_start.col,this.idx_start.col=this.idx_end.col,this.idx_end.col=i),{start:this.map[this.idx_start.row][this.idx_start.col].el,end:this.map[this.idx_end.row][this.idx_end.col].el}},createCells:function(n,t,i){for(var u,f=this.table.ownerDocument,e=f.createDocumentFragment(),r,o=0;o<t;o++){if(r=f.createElement(n),i)for(u in i)i.hasOwnProperty(u)&&r.setAttribute(u,i[u]);r.appendChild(document.createTextNode(" "));e.appendChild(r)}return e},correctColIndexForUnreals:function(n,t){for(var u=this.map[t],r=-1,i=0,f=n;i<n;i++)u[i].isReal&&r++;return r},getLastNewCellOnRow:function(n,t){for(var f=this.getRowCells(n),i,r,u=0,e=f.length;u<e;u++)if(i=f[u],r=this.getMapIndex(i),r===!1||typeof t!="undefined"&&r.row!=t)return i;return null},removeEmptyTable:function(){var n=this.table.querySelectorAll("td, th");return n&&n.length!=0?!1:(r(this.table),!0)},splitRowToCells:function(t){var r,u,f;t.isColspan&&(r=parseInt(n.getAttribute(t.el,"colspan")||1,10),u=t.el.tagName.toLowerCase(),r>1&&(f=this.createCells(u,r-1),i(t.el,f)),t.el.removeAttribute("colspan"))},getRealRowEl:function(t,i){var r=null,f=null,u,e;for(i=i||this.idx,u=0,e=this.map[i.row].length;u<e;u++)if(f=this.map[i.row][u],f.isReal&&(r=n.getParentElement(f.el,{query:"tr"}),r))return r;return r===null&&t&&(r=n.getParentElement(this.map[i.row][i.col].el,{query:"tr"})||null),r},injectRowAt:function(t,r,u,f,e){var o=this.getRealRowEl(!1,{row:t,col:r}),s=this.createCells(f,u),h,c;o?(h=this.correctColIndexForUnreals(r,t),h>=0?i(this.getRowCells(o)[h],s):o.insertBefore(s,o.firstChild)):(c=this.table.ownerDocument.createElement("tr"),c.appendChild(s),i(n.getParentElement(e.el,{query:"tr"}),c))},canMerge:function(n){var r,u,t,f,i,e;for(this.to=n,this.setTableMap(),this.idx_start=this.getMapIndex(this.cell),this.idx_end=this.getMapIndex(this.to),(this.idx_start.row>this.idx_end.row||this.idx_start.row==this.idx_end.row&&this.idx_start.col>this.idx_end.col)&&(r=this.idx_start,this.idx_start=this.idx_end,this.idx_end=r),this.idx_start.col>this.idx_end.col&&(u=this.idx_start.col,this.idx_start.col=this.idx_end.col,this.idx_end.col=u),t=this.idx_start.row,f=this.idx_end.row;t<=f;t++)for(i=this.idx_start.col,e=this.idx_end.col;i<=e;i++)if(this.map[t][i].isColspan||this.map[t][i].isRowspan)return!1;return!0},decreaseCellSpan:function(t,i){var r=parseInt(n.getAttribute(t.el,i),10)-1;r>=1?t.el.setAttribute(i,r):(t.el.removeAttribute(i),i=="colspan"&&(t.isColspan=!1),i=="rowspan"&&(t.isRowspan=!1),t.firstCol=!0,t.lastCol=!0,t.firstRow=!0,t.lastRow=!0,t.isReal=!0)},removeSurplusLines:function(){var t,f,i,e,u,o,s,h;if(this.setTableMap(),this.map){for(i=0,e=this.map.length;i<e;i++){for(t=this.map[i],s=!0,u=0,o=t.length;u<o;u++)if(f=t[u],!(n.getAttribute(f.el,"rowspan")&&parseInt(n.getAttribute(f.el,"rowspan"),10)>1&&f.firstRow!==!0)){s=!1;break}if(s)for(u=0;u<o;u++)this.decreaseCellSpan(t[u],"rowspan")}for(h=this.getTableRows(),i=0,e=h.length;i<e;i++)t=h[i],t.childNodes.length==0&&/^\s*$/.test(t.textContent||t.innerText)&&r(t)}},fillMissingCells:function(){var e=0,o=0,f=null,r,n,t;if(this.setTableMap(),this.map){for(e=this.map.length,r=0;r<e;r++)this.map[r].length>o&&(o=this.map[r].length);for(n=0;n<e;n++)for(t=0;t<o;t++)this.map[n]&&!this.map[n][t]&&t>0&&(this.map[n][t]=new u(this.createCells("td",1)),f=this.map[n][t-1],f&&f.el&&f.el.parent&&i(this.map[n][t-1].el,this.map[n][t].el))}},rectify:function(){return this.removeEmptyTable()?!1:(this.removeSurplusLines(),this.fillMissingCells(),!0)},unmerge:function(){var r,i,u;if(this.rectify()&&(this.setTableMap(),this.idx=this.getMapIndex(this.cell),this.idx)){var t=this.map[this.idx.row][this.idx.col],f=n.getAttribute(t.el,"colspan")?parseInt(n.getAttribute(t.el,"colspan"),10):1,e=t.el.tagName.toLowerCase();if(t.isRowspan){if(r=parseInt(n.getAttribute(t.el,"rowspan"),10),r>1)for(i=1,u=r-1;i<=u;i++)this.injectRowAt(this.idx.row+i,this.idx.col,f,e,t);t.el.removeAttribute("rowspan")}this.splitRowToCells(t)}},merge:function(n){var u,f,t,e,i,o;if(this.rectify())if(this.canMerge(n)){for(u=this.idx_end.row-this.idx_start.row+1,f=this.idx_end.col-this.idx_start.col+1,t=this.idx_start.row,e=this.idx_end.row;t<=e;t++)for(i=this.idx_start.col,o=this.idx_end.col;i<=o;i++)t==this.idx_start.row&&i==this.idx_start.col?(u>1&&this.map[t][i].el.setAttribute("rowspan",u),f>1&&this.map[t][i].el.setAttribute("colspan",f)):(/^\s*<br\/?>\s*$/.test(this.map[t][i].el.innerHTML.toLowerCase())||(this.map[this.idx_start.row][this.idx_start.col].el.innerHTML+=" "+this.map[t][i].el.innerHTML),r(this.map[t][i].el));this.rectify()}else window.console&&console.log("Do not know how to merge allready merged cells.")},collapseCellToNextRow:function(t){var s=this.getMapIndex(t.el),u=s.row+1,f={row:u,col:s.col},r,e,o;u<this.map.length&&(r=this.getRealRowEl(!1,f),r!==null&&(e=this.correctColIndexForUnreals(f.col,f.row),e>=0?i(this.getRowCells(r)[e],t.el):(o=this.getLastNewCellOnRow(r,u),o!==null?i(o,t.el):r.insertBefore(t.el,r.firstChild)),parseInt(n.getAttribute(t.el,"rowspan"),10)>2?t.el.setAttribute("rowspan",parseInt(n.getAttribute(t.el,"rowspan"),10)-1):t.el.removeAttribute("rowspan")))},removeRowCell:function(t){t.isReal?t.isRowspan?this.collapseCellToNextRow(t):r(t.el):parseInt(n.getAttribute(t.el,"rowspan"),10)>2?t.el.setAttribute("rowspan",parseInt(n.getAttribute(t.el,"rowspan"),10)-1):t.el.removeAttribute("rowspan")},getRowElementsByCell:function(){var i=[],t,n,r;if(this.setTableMap(),this.idx=this.getMapIndex(this.cell),this.idx!==!1)for(t=this.map[this.idx.row],n=0,r=t.length;n<r;n++)t[n].isReal&&i.push(t[n].el);return i},getColumnElementsByCell:function(){var t=[],n,i;if(this.setTableMap(),this.idx=this.getMapIndex(this.cell),this.idx!==!1)for(n=0,i=this.map.length;n<i;n++)this.map[n][this.idx.col]&&this.map[n][this.idx.col].isReal&&t.push(this.map[n][this.idx.col].el);return t},removeRow:function(){var u=n.getParentElement(this.cell,{query:"tr"}),i,t,f;if(u){if(this.setTableMap(),this.idx=this.getMapIndex(this.cell),this.idx!==!1)for(i=this.map[this.idx.row],t=0,f=i.length;t<f;t++)i[t].modified||(this.setCellAsModified(i[t]),this.removeRowCell(i[t]));r(u)}},removeColCell:function(t){t.isColspan?parseInt(n.getAttribute(t.el,"colspan"),10)>2?t.el.setAttribute("colspan",parseInt(n.getAttribute(t.el,"colspan"),10)-1):t.el.removeAttribute("colspan"):t.isReal&&r(t.el)},removeColumn:function(){if(this.setTableMap(),this.idx=this.getMapIndex(this.cell),this.idx!==!1)for(var n=0,t=this.map.length;n<t;n++)this.map[n][this.idx.col].modified||(this.setCellAsModified(this.map[n][this.idx.col]),this.removeColCell(this.map[n][this.idx.col]))},remove:function(n){if(this.rectify()){switch(n){case"row":this.removeRow();break;case"column":this.removeColumn()}this.rectify()}},addRow:function(t){var s=this.table.ownerDocument,u,f,r,o,e;if(this.setTableMap(),this.idx=this.getMapIndex(this.cell),t=="below"&&n.getAttribute(this.cell,"rowspan")&&(this.idx.row=this.idx.row+parseInt(n.getAttribute(this.cell,"rowspan"),10)-1),this.idx!==!1){for(u=this.map[this.idx.row],f=s.createElement("tr"),r=0,o=u.length;r<o;r++)u[r].modified||(this.setCellAsModified(u[r]),this.addRowCell(u[r],f,t));switch(t){case"below":i(this.getRealRowEl(!0),f);break;case"above":e=n.getParentElement(this.map[this.idx.row][this.idx.col].el,{query:"tr"});e&&e.parentNode.insertBefore(f,e)}}},addRowCell:function(t,i,r){var u=t.isColspan?{colspan:n.getAttribute(t.el,"colspan")}:null;t.isReal?r!="above"&&t.isRowspan?t.el.setAttribute("rowspan",parseInt(n.getAttribute(t.el,"rowspan"),10)+1):i.appendChild(this.createCells("td",1,u)):r!="above"&&t.isRowspan&&t.lastRow?i.appendChild(this.createCells("td",1,u)):c.isRowspan&&t.el.attr("rowspan",parseInt(n.getAttribute(t.el,"rowspan"),10)+1)},add:function(n){this.rectify()&&((n=="below"||n=="above")&&this.addRow(n),(n=="before"||n=="after")&&this.addColumn(n))},addColCell:function(t,r,u){var f,e=t.el.tagName.toLowerCase();switch(u){case"before":f=!t.isColspan||t.firstCol;break;case"after":f=!t.isColspan||t.lastCol||t.isColspan&&t.el==this.cell}if(f){switch(u){case"before":t.el.parentNode.insertBefore(this.createCells(e,1),t.el);break;case"after":i(t.el,this.createCells(e,1))}t.isRowspan&&this.handleCellAddWithRowspan(t,r+1,u)}else t.el.setAttribute("colspan",parseInt(n.getAttribute(t.el,"colspan"),10)+1)},addColumn:function(t){var u,r,i,f;if(this.setTableMap(),this.idx=this.getMapIndex(this.cell),t=="after"&&n.getAttribute(this.cell,"colspan")&&(this.idx.col=this.idx.col+parseInt(n.getAttribute(this.cell,"colspan"),10)-1),this.idx!==!1)for(i=0,f=this.map.length;i<f;i++)u=this.map[i],u[this.idx.col]&&(r=u[this.idx.col],r.modified||(this.setCellAsModified(r),this.addColCell(r,i,t)))},handleCellAddWithRowspan:function(t,r,u){for(var a=parseInt(n.getAttribute(this.cell,"rowspan"),10)-1,o=n.getParentElement(t.el,{query:"tr"}),h=t.el.tagName.toLowerCase(),f,s,v=this.table.ownerDocument,l,c=0;c<a;c++)if(f=this.correctColIndexForUnreals(this.idx.col,r+c),o=e(o,"tr"),o)if(f>0)switch(u){case"before":s=this.getRowCells(o);f>0&&this.map[r+c][this.idx.col].el!=s[f]&&f==s.length-1?i(s[f],this.createCells(h,1)):s[f].parentNode.insertBefore(this.createCells(h,1),s[f]);break;case"after":i(this.getRowCells(o)[f],this.createCells(h,1))}else o.insertBefore(this.createCells(h,1),o.firstChild);else l=v.createElement("tr"),l.appendChild(this.createCells(h,1)),this.table.appendChild(l)}};n.table={getCellsBetween:function(n,i){var r=new t(n);return r.getMapElsTo(i)},addCells:function(n,i){var r=new t(n);r.add(i)},removeCells:function(n,i){var r=new t(n);r.remove(i)},mergeCellsBetween:function(n,i){var r=new t(n);r.merge(i)},unmergeCell:function(n){var i=new t(n);i.unmerge()},orderSelectionEnds:function(n,i){var r=new t(n);return r.orderSelectionEnds(i)},indexOf:function(n){var i=new t(n);return i.setTableMap(),i.getMapIndex(n)},findCell:function(n,i){var r=new t(null,n);return r.getElementAtIndex(i)},findRowByCell:function(n){var i=new t(n);return i.getRowElementsByCell()},findColumnByCell:function(n){var i=new t(n);return i.getColumnElementsByCell()},canMerge:function(n,i){var r=new t(n);return r.canMerge(i)}}}(),function(){var n=wysihtml.views.Composer.prototype.observe,t=function(){n.call(this);this.config.handleTables&&i.call(this)},i=function(){var n=function(){this.win.removeEventListener("load",n);this.doc.execCommand("enableObjectResizing",!1,"false");this.doc.execCommand("enableInlineTableEditing",!1,"false")}.bind(this),t=function(){n.call(this);this.actions.removeListeners(this.sandbox.getIframe(),["focus","mouseup","mouseover"],t)}.bind(this);this.doc.execCommand&&wysihtml.browser.supportsCommand(this.doc,"enableObjectResizing")&&wysihtml.browser.supportsCommand(this.doc,"enableInlineTableEditing")&&(this.sandbox.getIframe?this.actions.addListeners(this.sandbox.getIframe(),["focus","mouseup","mouseover"],t):this.win.addEventListener("load",n));this.tableSelection=wysihtml.quirks.tableCellsSelection(this.element,this.parent)},r=function(n,t){var l=function(){return n.addEventListener("mousedown",a),i},a=function(t){var i=wysihtml.dom.getParentElement(t.target,{query:"td, th"},!1,n);i&&v(i)},v=function(e){i.start=e;i.end=e;i.cells=[e];i.table=r.getParentElement(i.start,{query:"table"},!1,n);i.table&&(f(),r.addClass(e,u),n.addEventListener("mousemove",o),n.addEventListener("mouseup",s),t.fire("tableselectstart").fire("tableselectstart:composer"))},f=function(){var t,i;if(n&&(t=n.querySelectorAll("."+u),t.length>0))for(i=0;i<t.length;i++)r.removeClass(t[i],u)},e=function(n){for(var t=0;t<n.length;t++)r.addClass(n[t],u)},o=function(u){var s=null,o=r.getParentElement(u.target,{query:"td, th"},!1,n),h;o&&i.table&&i.start&&(s=r.getParentElement(o,{query:"table"},!1,n),s&&s===i.table&&(f(),h=i.end,i.end=o,i.cells=r.table.getCellsBetween(i.start,o),i.cells.length>1&&t.composer.selection.deselect(),e(i.cells),i.end!==h&&t.fire("tableselectchange").fire("tableselectchange:composer")))},s=function(){n.removeEventListener("mousemove",o);n.removeEventListener("mouseup",s);t.fire("tableselect").fire("tableselect:composer");setTimeout(function(){c()},0)},h=function(u){n.ownerDocument.removeEventListener("click",h);r.getParentElement(u.target,{query:"table"},!1,n)!=i.table&&(f(),i.table=null,i.start=null,i.end=null,t.fire("tableunselect").fire("tableunselect:composer"))},c=function(){n.ownerDocument.addEventListener("click",h)},y=function(u,f){i.start=u;i.end=f;i.table=r.getParentElement(i.start,{query:"table"},!1,n);selectedCells=r.table.getCellsBetween(i.start,i.end);e(selectedCells);c();t.fire("tableselect").fire("tableselect:composer")},r=wysihtml.dom,i={table:null,start:null,end:null,cells:null,select:y},u="wysiwyg-tmp-selected-cell";return l()};wysihtml.Editor.prototype.defaults.handleTables=!0;wysihtml.quirks.tableCellsSelection=r;wysihtml.views.Composer.prototype.observe=t}();wysihtmlParserRulesDefaults={blockLevelEl:{keep_styles:{textAlign:/^((left)|(right)|(center)|(justify))$/i,float:1},add_style:{align:"align_text"},check_attributes:{id:"any"}},makeDiv:{rename_tag:"div",one_of_type:{alignment_object:1},remove_action:"unwrap",keep_styles:{textAlign:1,float:1},add_style:{align:"align_text"},check_attributes:{id:"any"}}};wysihtmlParserRules={classes:"any",classes_blacklist:{"Apple-interchange-newline":1,MsoNormal:1,MsoPlainText:1},type_definitions:{alignment_object:{classes:{"wysiwyg-text-align-center":1,"wysiwyg-text-align-justify":1,"wysiwyg-text-align-left":1,"wysiwyg-text-align-right":1,"wysiwyg-float-left":1,"wysiwyg-float-right":1},styles:{float:["left","right"],"text-align":["left","right","center"]}},valid_image_src:{attrs:{src:/^[^data\:]/i}},text_color_object:{styles:{color:!0,"background-color":!0}},text_fontsize_object:{styles:{"font-size":!0}},text_formatting_object:{classes:{"wysiwyg-color-aqua":1,"wysiwyg-color-black":1,"wysiwyg-color-blue":1,"wysiwyg-color-fuchsia":1,"wysiwyg-color-gray":1,"wysiwyg-color-green":1,"wysiwyg-color-lime":1,"wysiwyg-color-maroon":1,"wysiwyg-color-navy":1,"wysiwyg-color-olive":1,"wysiwyg-color-purple":1,"wysiwyg-color-red":1,"wysiwyg-color-silver":1,"wysiwyg-color-teal":1,"wysiwyg-color-white":1,"wysiwyg-color-yellow":1,"wysiwyg-font-size-large":1,"wysiwyg-font-size-larger":1,"wysiwyg-font-size-medium":1,"wysiwyg-font-size-small":1,"wysiwyg-font-size-smaller":1,"wysiwyg-font-size-x-large":1,"wysiwyg-font-size-x-small":1,"wysiwyg-font-size-xx-large":1,"wysiwyg-font-size-xx-small":1}}},comments:1,tags:{tr:{add_style:{align:"align_text"},check_attributes:{id:"any"}},strike:{unwrap:1},form:{unwrap:1},rt:{rename_tag:"span"},code:{},acronym:{rename_tag:"span"},br:{add_class:{clear:"clear_br"}},details:{unwrap:1},h4:wysihtmlParserRulesDefaults.blockLevelEl,em:{},title:{remove:1},multicol:{unwrap:1},figure:{unwrap:1},xmp:{unwrap:1},small:{rename_tag:"span",set_class:"wysiwyg-font-size-smaller"},area:{remove:1},time:{unwrap:1},dir:{rename_tag:"ul"},bdi:{unwrap:1},command:{unwrap:1},ul:{check_attributes:{id:"any"}},progress:{rename_tag:"span"},dfn:{unwrap:1},iframe:{check_attributes:{src:"any",width:"any",height:"any",frameborder:"any",style:"any",id:"any"}},figcaption:{unwrap:1},a:{check_attributes:{href:"href",rel:"any",target:"any",id:"any"}},img:{one_of_type:{valid_image_src:1},check_attributes:{width:"dimension",alt:"alt",src:"src",height:"dimension",id:"any"},add_class:{align:"align_img"}},rb:{unwrap:1},footer:wysihtmlParserRulesDefaults.makeDiv,noframes:{remove:1},abbr:{unwrap:1},u:{},bgsound:{remove:1},sup:{},address:{unwrap:1},basefont:{remove:1},nav:{unwrap:1},h1:wysihtmlParserRulesDefaults.blockLevelEl,head:{unwrap:1},tbody:wysihtmlParserRulesDefaults.blockLevelEl,dd:{unwrap:1},s:{unwrap:1},li:{},td:{check_attributes:{rowspan:"numbers",colspan:"numbers",valign:"any",align:"any",id:"any","class":"any"},keep_styles:{backgroundColor:1,width:1,height:1},add_style:{align:"align_text"}},object:{remove:1},div:{one_of_type:{alignment_object:1},remove_action:"unwrap",keep_styles:{textAlign:1,float:1},add_style:{align:"align_text"},check_attributes:{id:"any",contenteditable:"any"}},option:{remove:1},select:{remove:1},i:{},track:{remove:1},wbr:{remove:1},fieldset:{unwrap:1},big:{rename_tag:"span",set_class:"wysiwyg-font-size-larger"},button:{unwrap:1},noscript:{remove:1},svg:{remove:1},input:{remove:1},table:{keep_styles:{width:1,textAlign:1,float:1},check_attributes:{id:"any"}},keygen:{remove:1},h5:wysihtmlParserRulesDefaults.blockLevelEl,meta:{remove:1},map:{remove:1},isindex:{remove:1},mark:{unwrap:1},caption:wysihtmlParserRulesDefaults.blockLevelEl,tfoot:wysihtmlParserRulesDefaults.blockLevelEl,base:{remove:1},video:{remove:1},strong:{},canvas:{remove:1},output:{unwrap:1},marquee:{unwrap:1},b:{},q:{check_attributes:{cite:"url",id:"any"}},applet:{remove:1},span:{one_of_type:{text_formatting_object:1,text_color_object:1,text_fontsize_object:1},keep_styles:{color:1,backgroundColor:1,fontSize:1},remove_action:"unwrap",check_attributes:{id:"any"}},rp:{unwrap:1},spacer:{remove:1},source:{remove:1},aside:wysihtmlParserRulesDefaults.makeDiv,frame:{remove:1},section:wysihtmlParserRulesDefaults.makeDiv,body:{unwrap:1},ol:{},nobr:{unwrap:1},html:{unwrap:1},summary:{unwrap:1},"var":{unwrap:1},del:{unwrap:1},blockquote:{keep_styles:{textAlign:1,float:1},add_style:{align:"align_text"},check_attributes:{cite:"url",id:"any"}},style:{check_attributes:{type:"any",src:"any",charset:"any"}},device:{remove:1},meter:{unwrap:1},h3:wysihtmlParserRulesDefaults.blockLevelEl,textarea:{unwrap:1},embed:{remove:1},hgroup:{unwrap:1},font:{rename_tag:"span",add_class:{size:"size_font"}},tt:{unwrap:1},noembed:{remove:1},thead:{add_style:{align:"align_text"},check_attributes:{id:"any"}},blink:{unwrap:1},plaintext:{unwrap:1},xml:{remove:1},h6:wysihtmlParserRulesDefaults.blockLevelEl,param:{remove:1},th:{check_attributes:{rowspan:"numbers",colspan:"numbers",valign:"any",align:"any",id:"any"},keep_styles:{backgroundColor:1,width:1,height:1},add_style:{align:"align_text"}},legend:{unwrap:1},hr:{},label:{unwrap:1},dl:{unwrap:1},kbd:{unwrap:1},listing:{unwrap:1},dt:{unwrap:1},nextid:{remove:1},pre:{},center:wysihtmlParserRulesDefaults.makeDiv,audio:{remove:1},datalist:{unwrap:1},samp:{unwrap:1},col:{remove:1},article:wysihtmlParserRulesDefaults.makeDiv,cite:{},link:{remove:1},script:{check_attributes:{type:"any",src:"any",charset:"any"}},bdo:{unwrap:1},menu:{rename_tag:"ul"},colgroup:{remove:1},ruby:{unwrap:1},h2:wysihtmlParserRulesDefaults.blockLevelEl,ins:{unwrap:1},p:wysihtmlParserRulesDefaults.blockLevelEl,sub:{},comment:{remove:1},frameset:{remove:1},optgroup:{unwrap:1},header:wysihtmlParserRulesDefaults.makeDiv}},function(){var t=wysihtml.lang.object(wysihtmlParserRules).clone(!0),n,i;t.comments=!1;t.selectors={"a u":"unwrap"};t.tags.style={remove:1};t.tags.script={remove:1};t.tags.head={remove:1};n=wysihtml.lang.object(t).clone(!0);n.tags.div.one_of_type.alignment_object=1;n.tags.div.remove_action="unwrap";n.tags.div.check_attributes.style=!1;n.tags.div.keep_styles={textAlign:/^((left)|(right)|(center)|(justify))$/i,float:1};n.tags.span.keep_styles=!1;i=wysihtml.lang.object(n).clone(!0);i.classes={};window.wysihtmlParserPasteRulesets=[{condition:/<font face="Times New Roman"|class="?Mso|style="[^"]*\bmso-|style='[^'']*\bmso-|w:WordDocument|class="OutlineElement|id="?docs\-internal\-guid\-/i,set:i},{condition:/<meta name="copied-from" content="wysihtml">/i,set:t},{set:n}]}();